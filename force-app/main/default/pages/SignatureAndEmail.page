<apex:page showHeader="false" sidebar="false" docType="html-5.0" cache="false">
    <head>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"/>
    </head>
    <apex:include pageName="ClaimUtilJS"/>
    <style>
        /** pop up dialog style **/
        
        .bs input[type="checkbox"].cigna-question-checkbox-single {
            display: none;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single ~ label {
            cursor: pointer;
        }
        .bs input[type="checkbox"].cigna-question-checkbox-single + label:before {
            font: normal normal normal 14px/1 FontAwesome;
            display: inline-block;
            content: "\f058";
            height: 20px;
            margin: 0 .25em 0 0;
            padding: 0;
            vertical-align: top;
            width: 20px;
            color: #C8C9C7;
            font-size: 1.2em;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
            color: #39B54A;
            font: normal normal normal 14px/1 FontAwesome;
            content: "\f058";
            font-size: 1.2em;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
            font-weight: bold;
        }
        
        div#overlay, div#overlayPIC{
            display: none;
            z-index: 10;
            background: #D9D9D6;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            text-align: left;
        }
        
        div#specialBox, div#specialBoxPIC {
            display: none;
            position: absolute;
            z-index: 11;
            margin: 150px auto 0px auto;
            width: 80%;
            height: 50%;
            background: #FFF;
            color: #000;
            left: 10%;
            padding:20px;
            border-radius:5px;
        }
        
        #closeOverlay, #closeOverlayPIC {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        #tccontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 90%;
            overflow-y:auto;
        } 
        
        #PICcontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 85%;
            overflow-y:auto;
        } 
        
        .fontWeightNormal label{
            font-weight: normal;
        }
        /** end pop up dialog style **/

        /** signature style **/
        .signature-pad {
            width: 95%;
            height: 300px;
            background-color: #fff;
            border: 1px solid #ddd;
            margin-bottom: 60px;
        }
        
        .signature-pad-body {
            width: 100%;
            height: 300px;
        }
        
        .signature-canvas {
            width: 100%;
            height: 100%;
        }
        
        .signature-pad-footer {
            width: 100%;
            height: 40px;
        }
        /** end signature style **/
        
        /** pop up dialog style **/
        
        .bs input[type="checkbox"].cigna-question-checkbox-single {
            display: none;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single ~ label {
            cursor: pointer;
        }
        .bs input[type="checkbox"].cigna-question-checkbox-single + label:before {
            font: normal normal normal 14px/1 FontAwesome;
            display: inline-block;
            content: "\f058";
            height: 20px;
            margin: 0 .25em 0 0;
            padding: 0;
            vertical-align: top;
            width: 20px;
            color: #C8C9C7;
            font-size: 1.2em;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
            color: #39B54A;
            font: normal normal normal 14px/1 FontAwesome;
            content: "\f058";
            font-size: 1.2em;
        }
        
        .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
            font-weight: bold;
        }
        
        div#overlay, div#overlayPIC{
            display: none;
            z-index: 10;
            background: #D9D9D6;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            text-align: left;
        }
        
        div#specialBox, div#specialBoxPIC {
            display: none;
            position: absolute;
            z-index: 11;
            margin: 150px auto 0px auto;
            width: 80%;
            height: 50%;
            background: #FFF;
            color: #000;
            left: 10%;
            padding:20px;
            border-radius:5px;
        }
        
        #closeOverlay, #closeOverlayPIC {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        #tccontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 90%;
            overflow-y:auto;
        } 
        
        #PICcontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 85%;
            overflow-y:auto;
        } 
        
        .fontWeightNormal label{
            font-weight: normal;
        }
        /** end pop up dialog style **/

        /** signature style **/
        .signature-pad {
            width: 95%;
            height: 300px;
            background-color: #fff;
            border: 1px solid #ddd;
            margin-bottom: 60px;
        }
        
        .signature-pad-body {
            width: 100%;
            height: 300px;
        }
        
        .signature-canvas {
            width: 100%;
            height: 100%;
        }
        
        .signature-pad-footer {
            width: 100%;
            height: 40px;
        }
        /** end signature style **/
    </style>
    <script>
    function signatureCapture() {
        var canvas = document.getElementById("newSignature");
        var context = canvas.getContext("2d");
        canvas.width = 276;
        canvas.height = 180;
        context.fillStyle = "#fff";
        context.strokeStyle = "#444";
        context.lineWidth = 1.5;
        context.lineCap = "round";
        context.fillRect(0, 0, canvas.width, canvas.height);
        var disableSave = true;
        var pixels = [];
        var cpixels = [];
        var xyLast = {};
        var xyAddLast = {};
        var calculate = false;
        {   //functions
            function remove_event_listeners() {
                canvas.removeEventListener('mousemove', on_mousemove, false);
                canvas.removeEventListener('mouseup', on_mouseup, false);
                canvas.removeEventListener('touchmove', on_mousemove, false);
                canvas.removeEventListener('touchend', on_mouseup, false);
                
                document.body.removeEventListener('mouseup', on_mouseup, false);
                document.body.removeEventListener('touchend', on_mouseup, false);
            }
            
            function get_coords(e) {
                var x, y;
                
                if (e.changedTouches && e.changedTouches[0]) {
                    var offsety = canvas.offsetTop || 0;
                    var offsetx = canvas.offsetLeft || 0;
                    
                    x = e.changedTouches[0].pageX - offsetx;
                    y = e.changedTouches[0].pageY - offsety;
                } else if (e.layerX || 0 == e.layerX) {
                    x = e.layerX;
                    y = e.layerY;
                } else if (e.offsetX || 0 == e.offsetX) {
                    x = e.offsetX;
                    y = e.offsetY;
                }
                
                return {
                    x : x, y : y
                };
            };
            
            function on_mousedown(e) {
                e.preventDefault();
                e.stopPropagation();
                
                canvas.addEventListener('mouseup', on_mouseup, false);
                canvas.addEventListener('mousemove', on_mousemove, false);
                canvas.addEventListener('touchend', on_mouseup, false);
                canvas.addEventListener('touchmove', on_mousemove, false);
                document.body.addEventListener('mouseup', on_mouseup, false);
                document.body.addEventListener('touchend', on_mouseup, false);
                
                empty = false;
                var xy = get_coords(e);
                context.beginPath();
                pixels.push('moveStart');
                context.moveTo(xy.x, xy.y);
                pixels.push(xy.x, xy.y);
                xyLast = xy;
            };
            
            function on_mousemove(e, finish) {
                e.preventDefault();
                e.stopPropagation();
                
                var xy = get_coords(e);
                var xyAdd = {
                    x : (xyLast.x + xy.x) / 2,
                    y : (xyLast.y + xy.y) / 2
                };
                
                if (calculate) {
                    var xLast = (xyAddLast.x + xyLast.x + xyAdd.x) / 3;
                    var yLast = (xyAddLast.y + xyLast.y + xyAdd.y) / 3;
                    pixels.push(xLast, yLast);
                } else {
                    calculate = true;
                }
                
                context.quadraticCurveTo(xyLast.x, xyLast.y, xyAdd.x, xyAdd.y);
                pixels.push(xyAdd.x, xyAdd.y);
                context.stroke();
                context.beginPath();
                context.moveTo(xyAdd.x, xyAdd.y);
                xyAddLast = xyAdd;
                xyLast = xy;
                
            };
            
            function on_mouseup(e) {
                remove_event_listeners();
                disableSave = false;
                context.stroke();
                pixels.push('e');
                calculate = false;
            };
        }
        canvas.addEventListener('touchstart', on_mousedown, false);
        canvas.addEventListener('mousedown', on_mousedown, false);
    }
    
    function signatureSave() {
        var canvas = document.getElementById("newSignature");// save canvas image as data url (png format by default)
        var dataURL = canvas.toDataURL("image/png");
        document.getElementById("saveSignature").src = dataURL;
    };
    
    function signatureClear() {
        var canvas = document.getElementById("newSignature");
        var context = canvas.getContext("2d");
        context.clearRect(0, 0, canvas.width, canvas.height);
    }
    </script>
    <apex:define name="additionalLibraries">
        <!-- HKITSFDC-80 BEGIN -->
        <!-- <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.bootstrap_select_1_11_2, 'bootstrap-select-1.11.2/dist/css/bootstrap-select.min.css')}" /> -->
        <!-- HKITSFDC-80 END -->
        <apex:stylesheet value="{!URLFOR($Resource.Cigna_HK_Icons, 'Cigna-HK-Icons.css')}"/>
        <!-- HKITSFDC-80 BEGIN -->
        <!-- <script type="text/javascript" src="{!URLFOR($Resource.bootstrap_select_1_11_2, 'bootstrap-select-1.11.2/dist/js/bootstrap-select.min.js')}"></script> -->
        <!-- HKITSFDC-80 END -->
        <script type="text/javascript" src="{!URLFOR($Resource.jQuery_Validation, 'jquery.validate.min.js')}"></script>
        <script type="text/javascript" src="{!URLFOR($Resource.jQuery_Validation, 'additional-methods.min.js')}" />
        
        <!-- Date Picker -->
         <link rel="stylesheet" href="{!URLFOR($Resource.jQuery_ui, 'jquery-ui/jquery-ui.min.css')}" />
         <!--CR-56_Link_20220214-->
         <script type="text/javascript" src="{!URLFOR($Resource.jQuery_ui, 'jquery-ui/jquery-ui-1.13.min.js')}"></script>
         <script type="text/javascript" src="{!URLFOR($Resource.jQuery_ui, 'jquery-ui/datepicker-zh-TW.js')}"></script>
    </apex:define>
    <div id="canvas">
      <canvas class="roundCorners" id="newSignature" style="position: relative; margin: 0; padding: 0; border: 1px solid #c4caac;"></canvas>
    </div>
    <script>signatureCapture();</script>
    <c:eSignatureCompOriginal emailAddress="test@tqc.com"
                                  displayPICS="true"
                                  displayTC="true"
                                  PICSLink="true"
                                  /> 
        
        <apex:outputPanel id="eSignaturePanelBrk">
            
            
                    
            <script>
                /** pop up dialog**/
                function toggleOverlay(){
                    var overlay = document.getElementById('overlay');
                    var specialBox = document.getElementById('specialBox');
                    overlay.style.opacity = .95;
                    if(overlay.style.display == "block"){
                        overlay.style.display = "none";
                        specialBox.style.display = "none";
                    } else {
                        overlay.style.display = "block";
                        specialBox.style.display = "block";
                    }
                }
                
                
                /**
                function toggleOverlayPIC(){
                    var overlay = document.getElementById('overlayPIC');
                    var specialBox = document.getElementById('specialBoxPIC');
                    overlay.style.opacity = .95;
                    
                    if(overlay.style.display == "block"){
                        overlay.style.display = "none";
                        specialBox.style.display = "none";
                    } else {
                        overlay.style.display = "block";
                        specialBox.style.display = "block";
                    }
                }
                */
                
                
                /** end pop up dialog**/ 
                
                /** override component function **/ 
                
                //Cigna.ESignatureComp.forceResizeCanvas();
                //alert('before refresh esignature');
                //refreshEsignature();
                
                Cigna.ESignatureComp.saveSignature = function(){
                    console.log('to see saveSignature ');
                    chooseSignOnScreen();
                    
                    $("#errNotValidEmail").hide();
                    $("#errEmptySignature").hide();
                    $("#errNotAcceptTNC").hide();
                    
                    if($('#esignature-sign-div #esignature-pics').is(':checked') == false){
                        $("#errNotAcceptTNC").show();
                        /**
                        $("html,body").animate(
                            { scrollTop: $("#errNotAcceptTNC").offset().top },
                            "slow",
                            function(){
                                $("#errNotAcceptTNC").focus();
                            }
                        );
                        */
                        scrollTopFocus('#errNotAcceptTNC');
                        
                        return;
                    } else {
                        $("#errNotAcceptTNC").hide();
                    }
                    
                    if(Cigna.ESignatureComp.isEmptyCanvas(1)){
                        $("#errEmptySignature").show();
                        scrollTopFocus('#errEmptySignature');
                        return;
                    } else {
                        $("#errEmptySignature").hide();
                    }
                    
                    submitEsignature(Cigna.ESignatureComp.getSignatureImage());
                }
                                
                /** Send Email button */
                Cigna.ESignatureComp.sendEmail = function(){
                    chooseEsignature();
                    console.log('to see sendEmail ');
                    
                    $("#errEmptySignature").hide();
                    $("#errNotAcceptTNC").hide();
                    
                    console.log('enter send email');
                    if (Cigna.ESignatureComp.getEmailAddress() == '' || Cigna.ESignatureComp.getEmailAddress() == null 
                        || !Cigna.ValidationUtil.isValidEmail(Cigna.ESignatureComp.getEmailAddress())){
                        $("#errNotValidEmail").show();
                        scrollTopFocus('#errNotValidEmail');
                        return;
                    }
                    else{
                        $("#errNotValidEmail").hide();
                    }
                    sendEmailSignature(Cigna.ESignatureComp.getEmailAddress());
                    console.log('EmailAddress:' + Cigna.ESignatureComp.getEmailAddress());
                }
                                
                /** end override component function **/ 
                
                if (Cigna.Util.isSalesforce1() && Cigna.Util.isBrokerPortal()) {
                    $('.nextStepBtnPaddingIn8').show();
                }
                
                
                
            </script>
        </apex:outputPanel>
</apex:page>