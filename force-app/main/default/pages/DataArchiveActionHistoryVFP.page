<apex:page sidebar="false" controller="DataArchiveActionHistoryCtrl" tabStyle="Admin_Center__tab" >   
    <script type="text/javascript" src="{!URLFOR($Resource.DD_Demo, 'js/jquery.min.js')}"></script>    
    <script>
       $(document).ready(function(){
          getActionHistoryList();     
        });       
    </script>
    
   <apex:form id="theForm">           
       <apex:actionFunction action="{!getActionHistoryList}" name="getActionHistoryList"  status="loader-icon" reRender="dataArchivePageBlock" />
       <apex:actionFunction name="previous" namespace="actionHistorySearch" action="{!prevPage}" status="loader-icon" reRender="dataArchivePageBlock"/>
       <apex:actionFunction name="next" namespace="actionHistorySearch" action="{!nextPage}" status="loader-icon" reRender="dataArchivePageBlock"/>
       <apex:actionStatus id="loader-icon">
           <apex:facet name="start">
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 1000; background-color: black;">
                     &nbsp;
                 </div>
                <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 50%">
                    <div style="display: inline-block; padding: 2px; background-color: #fff; width: 125px;">
                        <img src="/img/loading.gif" style="float: left; margin: 8px;" />
                        <span style="display: inline-block; padding: 10px 0px;">Please Wait...</span>
                    </div>
                 </div>
            </apex:facet>
        </apex:actionStatus>         
       
        <apex:pageBlock id="dataArchivePageBlock" mode="maindetail" title="Action History of Archived Data">
            <div style="height:10px;"></div>
            <apex:pageMessages id="pageMessage" />               
            <apex:pageBlockSection id="itemListPageBlock" columns="1" collapsible="">               
                <apex:outputPanel >
                   <apex:outputText value="Filtered by:" style="font-weight:bold;"></apex:outputText>
                   <apex:outputLabel >&nbsp;&nbsp;</apex:outputLabel>
                   <apex:selectList value="{!department}" size="1" style="width:100px;">
                       <apex:selectoption itemLabel="Department" itemValue="" itemDisabled="true"></apex:selectoption>                                
                       <apex:selectOptions value="{!departmentOptions}"></apex:selectOptions>
                       <apex:actionSupport event="onchange" status="loader-icon" action="{!getActionHistoryByDepartment}" reRender="dataArchivePageBlock"/>
                   </apex:selectList>                                     
                </apex:outputPanel>
                <apex:pageBlockTable value="{!actionHistoryList}" var="ah">
                    <apex:column headerValue="Last Action Date/Time">                        
                        <apex:outputText value="{!ah.Remark__c}">
                        </apex:outputText>
                    </apex:column>
                    <apex:column headerValue="By">{!ah.lastModifiedBy.Name}</apex:column>
                    <apex:column headerValue="Department">{!ah.data_archive_detail__r.data_archive__r.Department__c}</apex:column>
                    <apex:column headerValue="Category" >{!ah.data_archive_detail__r.Category__c}</apex:column>         
                    <apex:column headerValue="Action">{!ah.Action__c}</apex:column>
                    
                    <apex:facet name="footer">                       
                        <div style="text-align:right;{!IF(actionHistoryList.size=0, 'display:none;', '')}">
                            <span> Page {!currentPage} of {!totalPage} &nbsp;</span>                            
                            <span><a href="javascript:void(0);" onclick="actionHistorySearch.previous()">&lt;&lt; Previous Page </a></span>    
                            <span> &nbsp; | &nbsp;</span>                        
                            <span><a href="javascript:void(0);" onclick="actionHistorySearch.next()">Next Page &gt;&gt;</a></span>
                        </div>
                    </apex:facet>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>

    </apex:form>
    
</apex:page>