<apex:page standardController="Task" extensions="CustomClickToDialController" showHeader="true" action="{!checkAutoClickToDial}">
	<head>
		<script>
			// $(document).ready(function(){
			// 	console.log('click to dial start: ',$("[id$='click-to-dial-poc']"));
            //     //$("[id$='click-to-dial-poc']").onClick=function(){
            //     //console.log('Click the img'
            //     //}
			// 	$("[id$='click-to-dial-poc']").click();
			// 	console.log('click to dial end');
			// });

		</script>
	</head>

	<apex:define name="additionalLibraries">
		<apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js" />
		<apex:stylesheet value="{!URLFOR($Resource.Cigna_HK_Icons, 'Cigna-HK-Icons.css')}"/>
    <apex:includeScript value="/support/console/53.0/integration.js"/>
	</apex:define>

	<!-- <apex:detail title="true" showChatter="true" inlineEdit="false"></apex:detail> -->
	<apex:define name="body">
		<apex:detail title="false" inlineEdit="false"></apex:detail>
		<!-- <apex:detail subject="{!task.Id}" relatedList="false" title="false"/> -->
	    <!-- <apex:outputLabel id="mobilePhone">Term Code POC</apex:outputLabel>
	    <apex:outputField value="{!task.Term_Code__c}" ></apex:outputField>
	    <support:clickToDial id="click-to-dial-poc" number="{!currentTask.Term_Code__c}" entityId="{!currentTask.Id}" params="{!json}" /> -->
		
	</apex:define>
	<script src="/support/api/26.0/interaction.js" type="text/javascript"></script>
	<script type="text/javascript">
		var autoClickToDial = {!autoClickToDial};
		let autoClicktoDialCallBack = function () {
			if (!autoClickToDial) {
				return null;
			}

			
			console.log('term code'+ {!Task.Term_Code__c});
			sendCTIMessage('/CLICK_TO_DIAL?DN=' + encodeURIComponent('{!Task.Term_Code__c}') + '&ID={!Task.Id}&ENTITY_NAME=Task&OBJECT_NAME=' + encodeURIComponent('null') + '&DISPLAY_NAME=' + encodeURIComponent('Task'));


			// const maskPhoneLabelArr = ['Term Code'];

			// // get all label elements
			// const labelEles = document.querySelectorAll("td.labelCol");

			// // console.log('labelEles:', labelEles);
			// for (let i = 0; i < labelEles.length; i++) {
			// 	const currentEle = labelEles[i];

			// 	let labelTxt = currentEle.innerText;
			// 	// console.log('labelTxt:' + labelTxt);
			// 	if (maskPhoneLabelArr.indexOf(labelTxt) != -1) {

			// 		// value element
			// 		let valueEle = currentEle.nextElementSibling;
			// 		let valueText = valueEle.innerText;

			// 		if (valueText && valueText.trim()) {

			// 			let valueInnerHtml = valueEle.innerHTML;
			// 			console.log('find term code valueInnerHtml:' + valueInnerHtml);
			// 			if (maskPhoneLabelArr.indexOf(labelTxt) != -1 && valueInnerHtml.indexOf("<img") != -1) {
			// 				const imgEles = valueEle.querySelectorAll("img");
			// 				// let phoneTextValue = valueEle.textContent;
			// 				// valueText = phoneTextValue.substring(0, phoneTextValue.length / 2);
			// 				console.log('imgEles:' + imgEles);
			// 				for (let j = 0; j < imgEles.length; j++) {
			// 					const currentImg = imgEles[j];
			// 					console.log(currentImg);
			// 					console.log(currentImg.title);
			// 					if(currentImg.title=="Click to dial"){
			// 						currentImg.click();
			// 						console.log("Click the img with title Click to dial");
			// 						return null;
			// 					}
			// 				}
			// 			}
			// 		}

			// 	}
			// }
		}


		// callback when DOM is ready
		document.addEventListener("DOMContentLoaded", autoClicktoDialCallBack());
	</script>
</apex:page>