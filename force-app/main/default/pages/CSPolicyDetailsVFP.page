<apex:page docType="html-5.0" id="CSPolicyDetail" showHeader="true" title="Policy Detail" Controller="CSPolicyDetailsController">

    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><!----JR1774---->
        <style>
            .block-header {
                color: #000 !important;
                font-size: 14px !important;
                font-weight: bold !important;
                font-family: Arial, Helvetica, sans-serif !important;
                padding-left: 3px !important;
            }
            
            .block-header_link {
                font-family: Arial, Helvetica, sans-serif !important;
                text-decoration: underline;
                line-height: 1.5em;
            }
            
            .policy-detail-summary {
                width: 100% !important;
                padding: 0 !important;
            }
            
            .policy-detail-policy {
                padding: 0;
                width: 98%;
            }
            
            .column-header {
                display: table-cell;
                font-weight: bold !important;
                padding: 3px 10px !important;
                text-align: right;
                font-size: 100%;
                font-weight: bold;
                font-family: Arial, Helvetica, sans-serif;
                width: 18% !important;
                border-bottom: 1px solid #ececec;
                color: #4a4a56;
            }
            
            .column-content {
                display: table-cell;
                padding-top: 2px;
                padding-right: 2px;
                padding-bottom: 2px;
                padding-left: 10px;
                text-align: left;
                color: #000;
                font-size: 100%;
                width: 82% !important;
                border-bottom: 1px solid #ececec;
            }
            
            .column-header-two {
                display: table-cell;
                font-weight: bold !important;
                padding: 3px 10px !important;
                text-align: right;
                font-size: 100%;
                font-weight: bold;
                font-family: Arial, Helvetica, sans-serif;
                width: 18% !important;
                border-bottom: 1px solid #ececec;
                color: #4a4a56;
            }
            
            .column-content-two {
                display: table-cell;
                padding-top: 2px;
                padding-right: 16px;
                padding-bottom: 2px;
                padding-left: 10px;
                text-align: left;
                color: #000;
                font-size: 100%;
                width: 34% !important;
                border-bottom: 1px solid #ececec;
            }
            
            .policy-detail-table {
                display: table;
            }
            
            .policy-detail-table-row {
                display: table-row;
            }
            
            .onclick-pointer {
                cursor: pointer;
            }
            
            .chart-center-div {
                float: none !important;
                margin-left: auto !important;
                margin-right: auto !important;
            }
            
            .tab-header {
                text-decoration: underline;
            }
            
            .txt-filename{
                cursor:pointer;
            }
            
            .planListPanelHeader {
                background-color: transparent;
                border-bottom: 2px solid #e1e1e1;
                border-top: 2px solid #e1e1e1;
                padding: 32px 0 8px 0;
            }
            
            .planListPanelHeader:first-child {
                border-top: none;
                padding: 8px 0;
            }
            
            .titleDiv {
                margin-top: 8px;
                font-size: 14px;
                padding: 8px 16px;
            }
            
            .subTitleDiv {
                font-size: 13px;
                padding: 8px 38px;
            }
            
            .titleLeft{
                display:inline-block;
                width:28%;
                padding-right:12px;
            }
            
            .titleRight{
                width: 60%;
                overflow: hidden;
                text-overflow:ellipsis;
                white-space: nowrap;
            }
            
            .content-left {
                display: inline-block;
                box-sizing: border-box;
                width: 30%;
                padding: 8px 64px;
                color: #696969;
            }
            
            .content-right {
                display: inline-block;
                width: 60%;
                padding: 8px 0;
                color: #696969;
            }
            
            .doc-filename{
                text-decoration:underline;
                padding: 10px 0px;
            }
            
            .FundBonusPanel{ margin-bottom:8px }
            .FundBonusPanel-row{ padding:8px 2px }
            .FundBonusPanel-label{display:inline-block;width:10%}
            .FundBonusPanel-value{margin-left:4%;display:inline-block}
            .FundBonusPanel-table{margin-top:8px;border:2px solid #e1e1e1}
            .FundBonusPanel-value > .value{margin-left:8px}
        </style>
    </head>

    <apex:define name="additionalLibraries">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <apex:stylesheet value="{!$Setup.Portal_Settings__c.Typography_Font_URL__c}" />
        <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.DD_Demo, 'css/bootstrap_ns.css')}" />
        <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.DD_Demo, 'css/font-awesome.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.Cigna_HK_Icons, 'Cigna-HK-Icons.css')}" />
        <apex:includeScript value="/support/console/33.0/integration.js" />
        <!--<script type="text/javascript" src="{!URLFOR($Resource.DD_Demo, 'js/Chart.min.js')}"></script>--><!--Remove HKITSFDC-28-->
        <script type="text/javascript" src="{!URLFOR($Resource.DD_Demo, 'js/jquery.min.js')}"></script>
        <apex:include pageName="CignaUtilJS" />
    </apex:define>

    <script>
        $(document).ready(function() {

            var isCS = sforce.console.isInConsole();
            $('[id$="ConsoleStatus"]').val(isCS);
            $(".policyDetailPanel").hide();
            PolicyDetailAF.getPolicyInfomation();
            $("#policyInformationPanelDiv").show();

            $(".tab-header").click(function(event) {

                $(".policyDetailPanel").hide();

                if(this.id == 'CoverageInformationTab') {
                    PolicyDetailAF.getPolicyPersonCoverageBasic();
                    $("#coverageInfoPanelDiv").show();
                } else if(this.id == 'PaymentInformationTab') {
                    PolicyDetailAF.getPolicyPayment();
                    $("#paymentInfoPanelDiv").show();
                } else if(this.id == 'ClaimHistoryTab') {
                    console.log('Claim History Tab click ============= '+{!isGroup});
                    PolicyDetailAF.getPolicyClaimHistoryPortal();
                    $("#claimHistoryPanelDiv").show();
                } else if(this.id == 'PolicyChangeHistoryTab') {
                    PolicyDetailAF.getPolicyChangeList();
                    $("#policyChangeHistoryPanelDiv").show();
                } else if(this.id == 'RemainingClinicVisitsTab') {
                    PolicyDetailAF.getClinicVisitCount();
                    $("#remainClinicVisitPanelDiv").show();
                } else if(this.id == 'InformationTab') {
                    PolicyDetailAF.getPolicyInfomation();
                    $("#policyInformationPanelDiv").show();
                } else if(this.id == 'FundPortfolioTab') {
                    PolicyDetailAF.getChartData();
                    $("#fundPorfolioPanelDiv").show();
                } else if(this.id == 'BenefitScheduleTab') {
                    PolicyDetailAF.getBenefitSchedule();
                    $("#benefitSchedulePanelDiv").show();
                } else if(this.id == 'PremiumSettlementHistoryTab') {
                    PolicyDetailAF.getPremiumSettlement();
                    $("#premiumSettlementPanelDiv").show();
                } else if(this.id == 'MemberListTab') {
                    PolicyDetailAF.getMemberList();
                    $("#memberListPanelDiv").show();
                } else if(this.id == 'RemainingHospitalVisitsTab') {
                    PolicyDetailAF.getHospitalVisitCount();
                    $("#remainingHospitalVisitsPanelDiv").show();
                } else if(this.id == 'FundBonusTab'){
                    PolicyDetailAF.getFundBonusDetails();               
                    $("#FundBonusPanelDiv").show();
                }else if(this.id == 'PolicyReplacementTab') {//jack add for policy replacement
                    PolicyDetailAF.getPolicyReplacement();
                    $("#policyReplacementPanelDiv").show();
                }else if(this.id == 'UwMessageTab') {// added by Ardbert JOBR-283 2022.12.15
                    console.log("enter load uw message list start.");
                    PolicyDetailAF.LoadUWMessageList();
                    console.log("enter load uw message list end.");
                    $("#UwMessagePanelDiv").show();
                }
            });
            // JR1774 - [[
            document.getElementById('{!$Component.account_masked_number}').blur(); 
            // ]] - JR1774
        });
        
        //Added for async download by Connor start
        function openDocument(){
            console.log('###start openDocument');
            var el=document.getElementById('open-attachment-link');
            if (Cigna.Util.isIOS() && Cigna.Util.isSalesforce1() && Cigna.Util.isBrokerPortal()) {
                el.target = "";
            }    
            el.click();
            $('input[type="hidden"][id$="is-document-download-complete"]').val(false);                                
        }
        
        
        function documentDetector(){
            var isComplete = $('input[type="hidden"][id$="is-document-download-complete"]').val();
            console.log('###isComplete='+isComplete );
            if(isComplete=='false'){
                console.log('###false');
                setTimeout(checkIsDocumentDownloadComplete, 3000);              
            }else{
                finishLoading();
                console.log('###true');
                openDocument();
            }
            
        }
        
        function showLoading() {
            $('#download-loader').fadeIn(100);
            
        }
        
        function finishLoading(){
            $('#download-loader').fadeOut(100);
            
        }
        //Added for async download by Connor end

        // Added for TMUwMessage by Ardbert JOBR-283 2022.12.15 start
        function openCreateTab() {
            if(sforce.console.isInConsole()) {
                sforce.console.getFocusedPrimaryTabId(function(result) {
                    if(result.success) {
                        sforce.console.openSubtab(result.id, '/apex/TMCreateUWMessageVFP?trackingid=' + $(".trackingId").val(), true,
                            'Message with underwriters', null, null, null);
                    } else {
                        console.log('/////////' + result);
                    }
                });
            }
        }

        function openDetailTab() {
            if(sforce.console.isInConsole()) {
                sforce.console.getFocusedPrimaryTabId(function(result) {
                    if(result.success) {
                        sforce.console.openSubtab(result.id, '/apex/TMUWMessageDetailVFP?messageid=' + $(".messageId").val(), true,
                            'Read Detail Messgae', null, null, null);
                    } else {
                        console.log('/////////' + result);
                    }
                });
            }
        }

        function refreshTab() {
            console.log("enter load uw message list start.");
            PolicyDetailAF.LoadUWMessageList();
            console.log("enter load uw message list end.");
            $("#UwMessagePanelDiv").show();
            // if(sforce.console.isInConsole()) {
            //     sforce.console.getEnclosingTabId(function(result) {
            //         sforce.console.refreshSubtabById(result.id, false);
            //     });
            // }
        }
        
        function getDoc(){
            var txnName = $('input[type="hidden"][id$="fileURL"]').val();
            if(txnName != null && txnName != ''){
                window.open(txnName);
            }
        }
        
        // var eventHandler = function(result) {
        //     LoadUWMessageList();
        // }

        // sforce.console.onFocusedSubtab(eventHandler);
        // Added for TMUwMessage by Ardbert JOBR-283 2022.12.15 end
    </script>
    <apex:form >
        <apex:outputPanel id="param-panel">
            <apex:inputText id="param-policy-planName" value="{!policy.planName}" Style="height:0px;width:0px;border:0px !important;webkit-appearance: none;" tabindex="-1" />
        </apex:outputPanel>
        
        <!-- Added for async download by Connor start --> 
        <apex:actionFunction action="{!getDoc2}" 
                             name="getDoc2"  
                             reRender="open-attachment-link-panel"
                             oncomplete="documentDetector();"
                             namespace="PolicyDetailAF">
            <apex:param assignTo="{!targetAttachmentKey}" value="" name="targetAttachmentKey"/>
        </apex:actionFunction>
            
        <apex:actionFunction action="{!checkIsDocumentDownloadComplete}"
                             name="checkIsDocumentDownloadComplete"
                             reRender="is-document-download-param-panel"
                             oncomplete="documentDetector();" />
                             
        <!----JR1774 - [[---->
        <apex:actionFunction action="{!validateCreditCardNumber}"
                             name="validateCreditCardNumber"
                             reRender="paymentInfoPanel_credit-card-validate-result-panel,is-credit-card-number-valid"
                             oncomplete="afterCreditCardNumValidated();" />
        <!----]] - JR1774---->                     
        
        <apex:actionFunction name="LoadUWMessageList" action="{!LoadUWMessageList}" namespace="PolicyDetailAF" status="loader-icon" reRender="MessageList" />
        <apex:actionFunction action="{!downloadFile}" name="downloadFile" namespace="PolicyDetailAF" status="loader-icon" reRender="fileURL" oncomplete="getDoc();">
            <apex:param name="selectedDocId" assignTo="{!selectedDocId}" value=""/>
        </apex:actionFunction>
        <apex:outputPanel id="open-attachment-link-panel">
            <!-- 20230921 - minghua - PI-129 Vulnerability follow up request - Pentest (FND-61951) High -->
            <!-- <a href="{!$Setup.Portal_Settings__c.File_Download_URL__c}{!selectedDowlAttId}" target="_blank" id="open-attachment-link" style="display:none;" value = 'test'/> -->
            <a href="{!$Setup.Portal_Settings__c.Standard_File_Download_Url__c}{!selectedDowlAttId}" target="_blank" id="open-attachment-link" style="display:none;" value = 'test'/>
        </apex:outputPanel>

        <apex:outputPanel id="is-document-download-param-panel">
            <apex:inputHidden value="{!isDownloadComplete}" id="is-document-download-complete"/>
        </apex:outputPanel>
        <!-- Added for async download by Connor end -->

        <!-- Added by Connor CR-47 start --> 
        <apex:actionFunction action="{!toggleDocState}" 
                             name="toggleDocState"  
                             reRender="policyDocTable,corDocTable,curGroupDocTable"
                             oncomplete="finishLoading();"
                             namespace="PolicyDetailAF">
            <apex:param assignTo="{!attKeyVisibility}" value="" name="attKeyVisibility"/>
            <apex:param assignTo="{!docNameVisibility}" value="" name="docNameVisibility"/>
            <apex:param assignTo="{!docListVisibility}" value="" name="docListVisibility"/>
        </apex:actionFunction>
        <apex:inputHidden value="{!customerAccountId}" id="customerAccountId-for-claim-page"/>
        <!-- Added by Connor CR-47 end --> 

        
        <!--information -->
        <apex:actionFunction action="{!getPolicyInfomation}" name="getPolicyInfomation" reRender="policyInformationPanel,IncentiveAndOthersPanel,error-message-panel,param-panel" status="loader-icon" oncomplete="checkInfo()" namespace="PolicyDetailAF" />

        <!--converage -->
        <apex:actionFunction action="{!getPolicyPersonCoverageBasic}" name="getPolicyPersonCoverageBasic" reRender="coverageInfoPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <!--payment-->
        <apex:actionFunction action="{!getPolicyPaymentInformation}" name="getPolicyPayment" reRender="paymentInfoPanel,error-message-panel" status="loader-icon" oncomplete="filterAccount()" namespace="PolicyDetailAF" />

        <!--policy change-->
        <apex:actionFunction action="{!getPolicyChangeList}" name="getPolicyChangeList" reRender="policyChangeHistoryPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <!--claim history -->
        <apex:actionFunction action="{!getPolicyClaimHistory}" name="getPolicyClaimHistory" reRender="claimHistoryPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />
        <!-- add by kit -->
        <apex:actionFunction action="{!getPolicyClaimHistoryPortal}" name="getPolicyClaimHistoryPortal" oncomplete="PolicyDetailAF.getPolicyClaimHistory()" status="loader-icon" reRender="customerAccountId-for-claim-page" namespace="PolicyDetailAF"  />
        <!-- reRender customerAccountId added by Connor CR-47 -->

        <apex:actionFunction action="{!getClinicVisitCount}" name="getClinicVisitCount" reRender="remainClinicVisitPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />
        <!--add by lu weizheng at 2018/04/24-->
        <apex:actionFunction action="{!getHospitalVisitCount}" name="getHospitalVisitCount" reRender="remainingHospitalVisitsPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <apex:actionFunction action="{!getChartData}" name="getChartData" reRender="fundPorfolioPanel" status="loader-icon" namespace="PolicyDetailAF" />

        <apex:actionFunction action="{!getBenefitSchedule}" name="getBenefitSchedule" reRender="benefitSchedulePanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <apex:actionFunction action="{!getPremiumSettlement}" name="getPremiumSettlement" reRender="premiumSettlementPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <apex:actionFunction action="{!getMemberList}" name="getMemberList" reRender="memberListPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />
        
        <!-- add by kit for CR Fund / Bonus Details for individual policy 2018/07/09 --> 
        <apex:actionFunction action="{!getFundBonusDetails}" name="getFundBonusDetails" reRender="FundBonusPanelDiv,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />
        
        <!-- JR-1785 -->
        <!--<apex:actionFunction action="{!recordAuditTrail}" name="recordAuditTrail">
            <apex:param name="targetAccountId" assignTo="{!targetAccountId}" value=""/>
            <apex:param name="targetPolNo" assignTo="{!targetPolNo}" value=""/>
        </apex:actionFunction>--><!--temp Emanuel 20240215-->

        <!--Policy Replacement jack add -->
        <apex:actionFunction action="{!getPolicyReplacement}" name="getPolicyReplacement" reRender="policyReplacementPanel,error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />

        <!-- Rancho_JOBR57_20211115 -->
        <apex:actionFunction action="{!resendWelcomeEmail}" name="resendWelcomeEmail" reRender="error-message-panel" status="loader-icon" namespace="PolicyDetailAF" />
        
        <!-- 20221216 - minghua - JOBR-285 Health Migration -->
        <apex:actionFunction name="cancelPolicy" action="{!cancelPolicy}" reRender="policyInformationPanel" status="loader-icon"></apex:actionFunction>

        <apex:outputPanel id="policyDetailTabs" rendered="{!isPolicyRecordFound }">
            <table align="center" cellspacing="10">
                <tr>
                    <td id="InformationTab" class="tab-header onclick-pointer" style="border-right:#000000 1px solid;padding-right:10px">
                        <a href="javascript:void(0);">{!$Label.Pol_Policy_Information}</a>
                    </td>
                    <td style="{!IF(isILAS,'','display:none')};border-right:#000000 1px solid;padding-right:10px" id="FundPortfolioTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Fund_Portfolio}</a>
                    </td>
                    <td style="{!IF(isILAS || fields2['group'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="FundBonusTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">Fund / Bonus Details</a>
                    </td>
                    <td style="{!IF(fields2['group'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="CoverageInformationTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Coverage_Information}</a>
                    </td>
                    <td style="{!IF(fields2['group'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="PaymentInformationTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Payment_Information}</a>
                    </td>
                    <td id="ClaimHistoryTab" class="tab-header onclick-pointer" style="border-right:#000000 1px solid;padding-right:10px">
                        <a href="javascript:void(0);">{!$Label.Pol_Claim_History}</a>
                    </td>
                    <td style="{!IF(fields2['group'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="PolicyChangeHistoryTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);"> {!$Label.Pol_Policy_Change_History} </a>
                    </td>
                    <td style="{!IF(fields2['group'][policyType],'display:none','')};" id="PolicyReplacementTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!transField['Policy_Replacement']}</a>
                    </td><!--jack add for policy replacement || policy.isLifePolicy == false -->
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="PremiumSettlementHistoryTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Premium_Settlement}</a>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="MemberListTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Member_List}</a>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="BenefitScheduleTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Benefit_Schedule}</a>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px" id="RemainingClinicVisitsTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Remaining_Clinic_Visits} </a>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};" id="RemainingHospitalVisitsTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_Remaining_Hospital_Visits} </a>
                    </td>
                    <td style="{!IF(isTM,'','display:none')};border-left:#000000 1px solid;padding-left:10px" id="UwMessageTab" class="tab-header onclick-pointer">
                        <a href="javascript:void(0);">{!$Label.Pol_UwMessage}</a>
                    </td><!--JOBR-283 added by Adbert 2022.12.15 -->
                    <!--
                    <td style="border-left:#000000 1px solid;padding-left:10px" id="Knowledge">
                        <a href="javascript:void(0);" onclick="openNewTab_Knowledge();">{!$Label.Pol_Knowledge} </a>
                    </td>
                    -->
                </tr>
            </table>
        </apex:outputPanel>

        <apex:outputPanel rendered="{!!isPolicyRecordFound }">
            <table align="center" cellspacing="10">
                <tr>
                    <td style="border-right:#000000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Policy_Information}</span>
                    </td>
                    <td style="border-right:#000000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Claim_History}</span>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Premium_Settlement}</span>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Member_List}</span>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#000000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Benefit_Schedule}</span>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};border-right:#00000 1px solid;padding-right:10px">
                        <span>{!$Label.Pol_Remaining_Clinic_Visits} </span>
                    </td>
                    <td style="{!IF(fields2['individual'][policyType],'display:none','')};">
                        <span>{!$Label.Pol_Remaining_Hospital_Visits} </span>
                    </td>
                    <td style="border-left:#000000 1px solid;padding-left:10px">
                        <span>{!$Label.Pol_Knowledge} </span>
                    </td>
                </tr>
            </table>
        </apex:outputPanel>

        <script>
            function IncentiveAndOthers(policyNumber) {
                if(policyNumber != null && policyNumber != '') {
                    if(sforce.console.isInConsole()) {
                        var rnd = Math.floor(Math.random() * 1000000000000);
                        sforce.console.openPrimaryTab(null, '/apex/IncentiveAndOtherInfoVFP?policyNumber=' + policyNumber + '', true, 'Incentives And Others', null, 'Incentives And Others');
                        sforce.console.setCustomConsoleComponentVisible(false);
                    } else {
                        var url = "/apex/IncentiveAndOtherInfoVFP?policyNumber=" + policyNumber;
                        sforce.one.navigateToURL(url, false);
                    }
                }
            }

            //change by kit 2018/05/30
            function openClaimDetailPage(claimNo, policyType, policyNumber, certNumber, sourceType) {
                var customerAccountId = $('input[type="hidden"][id$="customerAccountId-for-claim-page"]').val(); //customerAccountId added by Connor CR-47
                if(claimNo != null && claimNo != '') {
                    if(sforce.console.isInConsole()) {
                        var rnd = Math.floor(Math.random() * 1000000000000);
                        sforce.console.openPrimaryTab(null, '/apex/CSClaimDetailsVFP?claimNo=' + claimNo + '&policyType={!policyType}' + '&policyNumber={!policyNumber}' + '&certNumber=' + certNumber + '&sourceType=' + sourceType+'&customerAccountId='+customerAccountId, true, claimNo, null, claimNo);
                        //customerAccountId added by Connor CR-47
                        sforce.console.setCustomConsoleComponentVisible(false);
                    } else {
                        var url = "/apex/CSClaimDetailsVFP?claimNo=" + claimNo + '&policyType={!policyType}' + '&policyNumber={!policyNumber}' + '&certNumber=' + certNumber + '&sourceType=' + sourceType+'&customerAccountId='+customerAccountId;
                        //customerAccountId added by Connor CR-47
                        sforce.one.navigateToURL(url, false);
                    }
                }
            }

            function openCustomerProfilePage(accountId,polNo) {
                //recordAuditTrail(accountId,polNo);//temp Emanuel 20240215
                if(accountId != null && accountId != '') {
                    if(sforce.console.isInConsole()) {
                        var rnd = Math.floor(Math.random() * 1000000000000);
                        sforce.console.openPrimaryTab(null, '/' + accountId + '?pageRnd=' + rnd, true, 'Customer Profile', null, 'Customer Profile');
                        sforce.console.setCustomConsoleComponentVisible(false);
                    } else {
                        var url = "/" + accountId;
                        sforce.one.navigateToURL(url, true);
                    }
                }
            }

            function openGroupPolicyCorDocPage(policyNumber, certNumber) {
                if(policyNumber != null && policyNumber != '') {
                    if(sforce.console.isInConsole()) {
                        var rnd = Math.floor(Math.random() * 1000000000000);
                        sforce.console.openPrimaryTab(null, '/apex/CSGroupPolicyCorrespondencesVFP?policyNumber={!policyNumber}' + '&certNumber=' + certNumber, true, certNumber, null, certNumber);
                        sforce.console.setCustomConsoleComponentVisible(false);
                    } else {
                        var url = '/apex/CSGroupPolicyCorrespondencesVFP?policyNumber={!policyNumber}' + '&certNumber=' + certNumber;
                        sforce.one.navigateToURL(url, false);
                    }
                }
            }

            function openNewTab_Knowledge() {
                var target = $("input[id$='param-policy-planName']").val();
                if(sforce.console.isInConsole()) {
                    var rnd = Math.floor(Math.random() * 1000000000000);
                    sforce.console.openPrimaryTab(null, '_ui/knowledge/ui/KnowledgeHome?pageRnd=' + rnd + '&search=' + target, true, 'Knowledge', null, 'Knowledge');
                    sforce.console.setCustomConsoleComponentVisible(false);
                } else {
                    //change by kit
                    var currentURL = window.location.href;
                    var urlJson = {"componentDef":"forceSearch:search","attributes":{"term":"elite","scopeMap":{"color":"F2CF5B","icon":"https://cignahk--P2dev.cs57.my.salesforce.com/img/icon/t4v35/standard/article_120.png","nameField":"Title","label":"Knowledge Article Version","disambiguationFieldType":"STRING","name":"KnowledgeArticleVersion","cacheable":"Y","disambiguationField":"ArticleNumber","id":"KnowledgeArticleVersion","labelPlural":"Articles","entity":"KnowledgeArticleVersion"},"context":{"disableSpellCorrection":false,"permsAndPrefs":{"SearchUi.searchUIPilotFeatureEnabled":false,"Search.crossObjectsAutoSuggestEnabled":true,"Search.maskSearchInfoInLogs":false,"SearchUi.orgHasAccessToSearchTermHistory":false,"SearchResultsLVM.lvmEnabledForSearchResultsOn":true,"SearchUi.searchUIInteractionLoggingEnabled":false,"MySearch.userCanHaveMySearchBestResult":false}}},"state":{}};
                    urlJson.attributes.term = target;
                    debugger
                    var targetURL;
                    //lightning
                    if(currentURL.indexOf('lightning') > 0) {
                        targetURL = 'https://cignahk--p2dev.lightning.force.com/one/one.app#'  + window.btoa(JSON.stringify(urlJson));
                    }
                    //classic
                    else {
                        targetURL = "_ui/knowledge/ui/KnowledgeHome?search=" + target;
                    }
                    sforce.one.navigateToURL(targetURL, false);
                }
            }

            //check the Info(add by kit)
            function checkInfo() {
                //calculateAge
                let age = Cigna.Util.calculateAge($('.dateOfBirth').text());
                if(age) {
                    $('#age').text('(' + age + ')');
                }

                if(!$('#sourceSystem').text()) {
                    return
                }
                if($('#sourceSystem').text() === 'SYSTEM6') {
                    $('#capsilRef').text('');
                    $('#ipasRef1').text('');
                    $('#ipasRef2').text('');
                    $('#ipasRef3').text('');
                    $('#ipasRef4').text('');
                    $('#ipasRef5').text('');
                    $('#ipasRef6').text('');
                    $('#ipasRef7').text('');
                } else if($('#sourceSystem').text() === 'IPAS') {
                    $('#capsilRef').text('');
                    $('#s6Ref1').text('');
                    $('#s6Ref2').text('');
                    $('#s6Ref3').text('');
                } else if($('#sourceSystem').text() === 'CAPSIL') {
                    $('#ipasRef1').text('');
                    $('#ipasRef2').text('');
                    $('#ipasRef3').text('');
                    $('#ipasRef4').text('');
                    $('#ipasRef5').text('');
                    $('#ipasRef6').text('');
                    $('#ipasRef7').text('');
                    $('#s6Ref1').text('');
                    $('#s6Ref2').text('');
                    $('#s6Ref3').text('');
                }
            }

            //filter accountNo 
            function filterAccount() {
                let account = $('#accountNumber').text();
                if(!account || account.length < 8) {
                    return
                }
                if(account.length === 8) {
                    $('#accountNumber').text('********');
                }
                //account.length is even 
                if(account.length % 2 === 0) {
                    let str = account.substring(0, account.length / 2 - 4) + "********" + account.substring(account.length / 2 + 4, account.length);
                    $('#accountNumber').text(str);
                } else {
                    let str = account.substring(0, (account.length + 1) / 2 - 4) + "********" + account.substring((account.length + 1) / 2 + 4, account.length);
                    $('#accountNumber').text(str);
                }
            }

            // Rancho_JOBR57_20211115: add confirm for resend welcome email
            function confirmResendWelcomeEmail() {
                var con = confirm('Are you confirm to resend the welcome email?');
                if(con){
                    PolicyDetailAF.resendWelcomeEmail();
                    console.log('Resend Welcome Email Action Done.');
                }
            }
        </script>
        <apex:actionStatus id="loader-icon">
            <apex:facet name="start">
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 1000; background-color: black;">
                     
                </div>
                <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 50%">
                    <div style="display: inline-block; padding: 2px; background-color: #fff; width: 125px;">
                        <img src="/img/loading.gif" style="float: left; margin: 8px;" />
                        <span style="display: inline-block; padding: 10px 0px;">Loading...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionStatus>
        <apex:outputPanel id="error-message-panel">
            <apex:pageMessages escape="false"></apex:pageMessages>
        </apex:outputPanel>
        <!----Policy Information Start---->
        <apex:outputPanel id="IncentiveAndOthersPanel" layout="block">
            <div class="policy-detail-policy policy-detail-table" id="IncentiveAndOthersDiv">
                <div class="policy-detail-table-row">
                    <div class="column-header">
                        <apex:outputPanel layout="block">
                            <div class="onclick-pointer block-header_link" style="text-align:left;text-decoration:underline">
                                <a href="javascript:void(0);" onclick="IncentiveAndOthers('{!policy.policyNumber}');">{!$Label.Incentives_And_Others}</a>
                            </div>
                        </apex:outputPanel>
                    </div>
                    <div class="column-content">
                    </div>
                </div>
            </div>
        </apex:outputPanel>
        <apex:outputPanel id="policyInformationPanel" layout="block">
            <div class="policyDetailPanel" id="policyInformationPanelDiv">
                <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                    <div class="bs col-sm-12" style="padding:0;">
                        <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                            <Label class="block-header">{!$Label.Pol_Policy_Information}</Label>
                        </div>
                    </div>
                </div>

                <apex:outputPanel rendered="{!policyType != 'Group'}">
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Policy_No}
                            </div>
                            <div class="column-content-two">
                                {!policy.policyNumber}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Policy_Effective_Date}
                            </div>
                            <div class="column-content-two">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!policy.effDateInDate}" />
                                </apex:OutputText>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Product_Name}
                            </div>
                            <div class="column-content-two">
                                {!policy.marketingName}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Product_Code}
                            </div>
                            <div class="column-content-two">
                                {!policy.productCode}{!policy.rateScale}
                            </div>
                        </div>
                    </div>
                      <!-- BEGIN https://jira.express-scripts.com/browse/HKITSFDC-8 (PT!=group)-->
                    <div id="conditionElite" style="{!IF(CONTAINS(LOWER(policy.marketingName), 'elite'), '', 'display: none;')}">
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                </div>
                                <div class="column-content-two"> 
                                </div>
                                <div class="column-header-two">
                                  {!$Label.Pol_Renewal_Segment}
                                </div>
                                <div class="column-content-two">
                                  {!policy.renewalSegment} 
                                </div>
                            </div>
                        </div>
                         <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                </div>
                                <div class="column-content-two">
                                </div>
                                <!-- Final Segment -->
                                 <div class="column-header-two">
                                    {!$Label.Pol_Actual_Segment} 
                                </div>
                                <div class="column-content-two">
                                   {!policy.actualSegment} 
                                </div>       
                            </div>
                        </div>
                         <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                   
                                </div>
                                <div class="column-content-two">
                                     
                                </div>
                                 <div class="column-header-two">
                                 {!$Label.Pol_Internal_Product_Name} 
                                </div>
                                <div class="column-content-two">
                                 {!policy.internalProductName} 
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END https://jira.express-scripts.com/browse/HKITSFDC-8 -->
                    
                    <!-- BEGIN https://jira.express-scripts.com/browse/HKITSFDC-15 display: none;-->
                      <!--HKITSFDC-267 Remove NCD from upper part of policy information
                    <apex:outputPanel id="ncDInfo">
                    <div id="policy-detail-payment-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_NCD_Eligibility} 111</Label>
                            </div>
                        </div>
                    </div>
                    <div id="conditionNCD" >
                       <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                
                                <div class="column-header-two">
                                  {!$Label.Pol_NCD_Eligibility}
                                </div>
                                <div class="column-content-two">
                                  {!policy.nCDEligibility } 
                                </div>
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table" style="{!IF(policy.nCDUpdateDate=='','display: none;','')}">
                            <div class="policy-detail-table-row">
                               
                              
                                 <div class="column-header-two">
                                    {!$Label.Pol_NCD_Update_Date} 
                                </div>
                                <div class="column-content-two">
                                   {!policy.nCDUpdateDate} 
                                </div>       
                            </div>
                        </div>
                     
                       </apex:outputPanel>
                       
                    <!-- END HKITSFDC-267 -->
              
                    <!-- END https://jira.express-scripts.com/browse/HKITSFDC-15  -->

                    <!-- AM project rate scale name -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['Rate_Scale_Name']}
                            </div>
                            <div class="column-content-two">
                                {!policy.rateScaleName}
                            </div>
                            <div class="column-header-two">
                            </div>
                            <div class="column-content-two">
                            </div>
                        </div>
                    </div>
                    <!-- AM project rate scale name -->

                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Policy_Status}
                            </div>
                            <div class="column-content-two">
                                {!policy.policyStatusDisplayName }
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Payment_Mode}
                            </div>
                            <div class="column-content-two">
                                {!payment.paymentMode}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Currency}
                            </div>
                            <div class="column-content-two">
                                {!policy.currencyCodeDesc}
                            </div>
                            <!-- Rancho_JOBR381_20240722 - remove annual premium -->
                            <!-- <div class="column-header-two">
                                {!$Label.Pol_Modal_Premium}
                            </div> -->
                            <!-- <div class="column-content-two"> -->
                                <!-- Rancho_JOBR367_20240513 - update premium display -->
                                <!-- <apex:outputPanel rendered="{!renewalEligible && policy.renewalNoticeInd == 'Y'}">
                                    {!transField['RenewalNotice']}
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!!(renewalEligible && policy.renewalNoticeInd == 'Y')}">
                                    <apex:outputText value="{!IF(policy.paymentAmt == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                        <apex:param value="{!policy.paymentAmt}" />
                                    </apex:outputText>
                                </apex:outputPanel>
                            </div> -->
                            <div class="column-header-two">
                                {!transField['Levy']}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(policy.nextLevy == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!policy.nextLevy}" />
                                </apex:outputText>
                            </div>
                        </div>
                    </div>

                    <!-- Rancho_JOBR381_20240722 - remove annual premium -->
                    <!-- 20200610 - minghua - levyII -->
                    <!-- <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['Levy']}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(policy.nextLevy == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!policy.nextLevy}" />
                                </apex:outputText>
                            </div> -->
                            <!-- <div class="column-header-two">
                                {!transField['Levy_Next_Premium_Including_Levy']}
                            </div> -->
                            <!-- <div class="column-content-two"> -->
                                <!-- Rancho_JOBR367_20240513 - update premium display -->
                                <!-- <apex:outputPanel rendered="{!renewalEligible && policy.renewalNoticeInd == 'Y'}">
                                    {!transField['RenewalNotice']}
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!!(renewalEligible && policy.renewalNoticeInd == 'Y')}">
                                    <apex:outputText value="{!IF(policy.modalPremiumIncludeLevy == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                        <apex:param value="{!policy.modalPremiumIncludeLevy}" />
                                    </apex:outputText>
                                </apex:outputPanel>
                            </div> -->
                        <!-- </div>
                    </div> -->

                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Paid_to_Date}
                            </div>
                            <div class="column-content-two">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!payment.paidToDateInDate}" />
                                </apex:OutputText>
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Company}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.organization.fullname}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Contact_Person}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.fullname}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Broker_Contact_No}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.businessPhoneNo}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Code}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.brokerAgentCode}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Name}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.fullname}
                            </div>
                        </div>
                    </div>

                    <!-- add by kit -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Source_System}
                            </div>
                            <div class="column-content-two" id="sourceSystem">
                                {!policy.sourceSystem}
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_1}
                            </div>
                            <div class="column-content-two" id="ipasRef1">
                                {!IF(showReference && policy.referenceList.size >= 1,policy.referenceList[0].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.CAPSIL_Ref}
                            </div>
                            <div class="column-content-two" id="capsilRef">

                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_2}
                            </div>
                            <div class="column-content-two" id="ipasRef2">
                                {!IF(showReference && policy.referenceList.size >= 2,policy.referenceList[1].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.S6_Ref_1}
                            </div>
                            <div class="column-content-two" id="s6Ref1">
                                {!IF(showReference && policy.referenceList.size >= 1,policy.referenceList[0].referenceDesc,'')}
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_3}
                            </div>
                            <div class="column-content-two" id="ipasRef3">
                                {!IF(showReference && policy.referenceList.size >= 3,policy.referenceList[2].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.S6_Ref_2}
                            </div>
                            <div class="column-content-two" id="s6Ref2">
                                {!IF(showReference && policy.referenceList.size >= 2,policy.referenceList[1].referenceDesc,'')}
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_4}
                            </div>
                            <div class="column-content-two" id="ipasRef4">
                                {!IF(showReference && policy.referenceList.size >= 4,policy.referenceList[3].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.S6_Ref_3}
                            </div>
                            <div class="column-content-two" id="s6Ref3">
                                {!IF(showReference && policy.referenceList.size >= 3,policy.referenceList[2].referenceDesc,'')}
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_5}
                            </div>
                            <div class="column-content-two" id="ipasRef5">
                                {!IF(showReference && policy.referenceList.size >= 5,policy.referenceList[4].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table" style="text-align:right">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two" style="{!IF(isILAS,'','display: none;')}">
                                <!-- 20200306 - minghua - ILAS -->
                                {!$Label.ILAS_Application_Date}
                            </div>
                            <div class="column-header-two" style="{!IF(isILAS,'display: none;','')}">
                            </div>
                            <div class="column-content-two" style="{!IF(isILAS,'','display: none;')}">
                                <!-- 20200306 - minghua - ILAS -->
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                    <apex:Param value="{!policy.applicationDate}" />
                                </apex:OutputText>
                            </div>
                            <div class="column-content-two" style="{!IF(isILAS,'display: none;','')}">
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_6}
                            </div>
                            <div class="column-content-two" id="ipasRef6">
                                {!IF(showReference && policy.referenceList.size >= 6,policy.referenceList[5].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table" style="text-align:right">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                            </div>
                            <div class="column-content-two">
                            </div>
                            <div class="column-header-two">
                                {!$Label.IPAS_Ref_7}
                            </div>
                            <div class="column-content-two" id="ipasRef7">
                                {!IF(showReference && policy.referenceList.size >= 7,policy.referenceList[6].referenceDesc,'')}
                            </div>
                        </div>
                    </div>
                    <!-- end add by kit -->
                    <apex:outputPanel layout="block" rendered="{! isDMB}">
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                    Offer Cash Reward indicator
                                </div>
                                <div class="column-content-two">
                                    <apex:outputPanel rendered="{!policy.cashRewardInd}">
                                        <img width="21" height="16" title="Checked" class="checkImg" alt="Checked" src="/img/checkbox_checked.gif" />
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!!policy.cashRewardInd}">
                                        <img width="21" height="16" title="Not Checked" class="checkImg" alt="Not Checked" src="/img/checkbox_unchecked.gif" />
                                    </apex:outputPanel>
                                </div>

                                <div class="column-header-two">
                                    Offer for Date(of Offer cash reward)
                                </div>
                                <div class="column-content-two">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!policy.cashRewardDate}" />
                                    </apex:OutputText>
                                </div>
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header">
                                    Type of Diabetes
                                </div>
                                <div class="column-content">
                                    {!policy.diabetesTypeCode}
                                </div>
                            </div>
                        </div>
                    </apex:outputPanel>

                    <!-- Hardcopy Indicator added start-->
                    <apex:outputPanel layout="block">
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                    {!$Label.Hardcopy_Medical_Card_Indicator}
                                </div>
                                <div class="column-content-two">
                                    {!policy.medCardIndicator}
                                </div>
                                <!-- add by lu weizheng at 20180516 -->
                                <div class="column-header-two">
                                    {!$Label.Pol_SellerName}
                                </div>
                                <div class="column-content-two">
                                    {!tmName}
                                </div>
                                <!-- end add by lu weizheng at 20180516 -->
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table">
                            <!-- 20220829 - minghua - JOBR-152 Health Migration -->
                            <div class="policy-detail-table-row"> <!-- policy-detail-policy policy-detail-table -->
                                <div class="column-header-two">
                                    {!$Label.Pol_Campaign_Code}
                                </div>
                                <div class="column-content-two">
                                    {!policy.campaignCode}
                                </div>
                                <!-- 20220829 - minghua - JOBR-152 Health Migration -->
                                <div class="column-header-two">
                                    {!transField['Health_Migration']}                                
                                </div>
                                <div class="column-content-two">
                                    <apex:outputText value="{!if(policy.sourceCode=='C', 'Yes', 'No')}"/>
                                </div>
                            </div>
                        </div>
                    </apex:outputPanel>
                    <!-- Hardcopy Indicator added end -->
                    <!-- 20221216 - minghua - JOBR-285 Health Migration -->
                    <div class="policy-detail-policy policy-detail-table" style="text-align:right">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['Health_Migration_Cancel_Policy']}
                            </div>
                            <div class="column-content-two">
                                <apex:inputCheckbox onclick="cancelPolicy()" value="{!policy.isDisplayTooltip}"/>
                            </div>
                            <div class="column-header-two">
                                <!-- 20230106 - minghua - JOBR-296 Indicator for L policies wrongly set up as G -->
                                <!--{!transField['G_Policy_Migration']}--><!--Temp Emanuel 20240215-->
                            </div>
                            <div class="column-content-two">
                                <!-- 20230106 - minghua - JOBR-296 Indicator for L policies wrongly set up as G -->
                                <!--<apex:selectList size="1" value="{!gPolicyOption}" onChange="cancelPolicy()">
                                    <apex:selectOptions value="{!GPolicyOptions}"></apex:selectOptions>
                                </apex:selectList>--><!--Temp Emanuel 20240215-->
                            </div>
                        </div>
                    </div>
                  
                </apex:outputPanel>
                <!--Group-->
                <apex:outputPanel rendered="{!policyType == 'Group'}">
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Policy_No}
                            </div>
                            <div class="column-content-two">
                                {!policy.policyNumber}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Plan_Type}
                            </div>
                            <div class="column-content-two">
                                {!policy.marketingName}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Policy_Period}
                            </div>
                            <div class="column-content-two">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!policy.effDateInDate}" />
                                </apex:OutputText>
                                 {!$Label.Pol_to} 
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!policy.termDateInDate}" />
                                </apex:OutputText>
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Currency}
                            </div>
                            <div class="column-content-two">
                                {!policy.currencyCodeDesc}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Payment_Mode}
                            </div>
                            <div class="column-content-two">
                                {!payment.paymentMode}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Company}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.organization.fullname}
                            </div>

                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Contact_Person}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.fullname}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Broker_Contact_No}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.businessPhoneNo}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Code}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.brokerAgentCode}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Broker_Name}
                            </div>
                            <div class="column-content-two">
                                {!policy.broker.organization.fullname}
                            </div>
                        </div>
                    </div>
                    <!-- Hardcopy Indicator added start-->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Hardcopy_Medical_Card_Indicator}
                            </div>
                            <div class="column-content-two">
                                {!policy.medCardIndicator}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Hardcopy_Letter_Indicator}
                            </div>
                            <div class="column-content-two">
                                {!policy.letterIndicator}
                            </div>
                        </div>
                    </div>
                    <!-- Hardcopy Indicator added end -->
                    <!-- add by lu weizheng at 20180516 -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_SellerName}
                            </div>
                            <div class="column-content-two">
                                {!policy.sellerName}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Campaign_Code}
                            </div>
                            <div class="column-content-two">
                                {!policy.campaignCode}
                            </div>
                        </div>
                    </div>
                    <!-- end add by lu weizheng at 20180516 -->
                    <!-- CS Member Level Jack add-->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['ARCorrespondenceAddress']}
                            </div>
                            <div class="column-content-two">
                                {!ARCorrespondenceAddress}
                            </div>
                            <div class="column-header-two">
                                {!transField['ARCorrespondencePostAddress']}
                            </div>
                            <div class="column-content-two">
                                {!ARCorrespondencePostAddress}
                            </div>
                        </div>
                    </div>
                    <!-- CS Member Level Jack add-->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['ClaimCorrespondenceAdress']}
                            </div>
                            <div class="column-content-two">
                                {!ClaimCorrespondenceAddress}
                            </div>
                            <div class="column-header-two">
                                {!transField['ClaimCorrespondencePostAdress']}
                            </div>
                            <div class="column-content-two">
                                {!ClaimCorrespondencePostAddress}
                            </div>
                        </div>
                    </div>
                    <!-- chris-2020-7-15 -PolyEB information-->
                    <!-- junda-2020-9-25 -PolyEB information-->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Product_Code}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].productCode}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].productCode,'')}"/>
                            </div>
                            <div class="column-header-two">
                                {!transField['WalverPreExist']}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].waiverPreExist}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].waiverPreExist,'')}"/>
                            </div>
                        </div>
                    </div>

                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['CardType']}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].eMedicalCardType}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].eMedicalCardType,'')}"/>
                            </div>
                            <!-- 20220829 - minghua - JOBR-152 Health Migration -->
                            <div class="column-header-two">
                                {!transField['Health_Migration']} 
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!if(policy.sourceCode=='C', 'Yes', 'No')}"/>
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>
                <!-- junda-2020-9-25 -end-->
                <!-- BEGIN https://jira.express-scripts.com/browse/HKITSFDC-15 display: none;-->
                    <apex:outputPanel id="ncDInfoNew" >
                    <div id="policy-detail-payment-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_NCD_Eligibility}</Label>
                            </div>
                        </div>
                    </div>
                     <div id="conditionNCD" >
                        <div class="policy-detail-policy policy-detail-table">
                          <!-- BEGIN HKITSFDC-267 -->
                           <!-- <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                  {!$Label.Pol_NCD_Eligibility}
                                </div>
                                <div class="column-content-two">
                                  {!policy.nCDEligibility } 
                                </div>
                                 <div class="column-header-two" style="{!IF(policy.nCDUpdateDate=='','display: none;','')}">
                                    {!$Label.Pol_NCD_Update_Date} 
                                </div>
                                <div class="column-content-two" style="{!IF(policy.nCDUpdateDate=='','display: none;','')}">
                                   {!policy.nCDUpdateDate} 
                                </div>       
                            </div>-->
                     
                       
                       
                        
                            <div class="policy-detail-table-row">
                               
                                <!-- Final Segment -->
                                 <div class="column-header-two">
                                    {!$Label.Pol_NCD_Eligibility}
                                </div>
                                <div class="column-content-two">
                                   {!policy.NcdInd} 
                                </div>       
                           

                      
                                    <!-- Final Segment -->
                                    <div class="column-header-two">
                                        {!$Label.Pol_NCD_Percentage}
                                    </div>
                                    <div class="column-content-two">
                                        {!IF(policy.NcdInd == 'N', '0%', TEXT(ROUND(policy.NcdPercentage, 1)) & '%')}
                                    </div>
                            </div>      
                          </div>
                        </div>
                        </apex:outputPanel>
                       
                    <!-- BEGIN HKITSFDC-22 -->
                 <apex:outputPanel id="retentionEligiblityInfo">
                    <div id="policy-detail-payment-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_Retention_Eligibility_title}</Label>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Current_Insured_Age}
                            </div>
                            <div class="column-content-two"> 
                               {!policy.currentInsuredAge}
                            </div>
                            <div class="column-header-two">
                                <!--BEGIN HKITSFDC-210 -->
                                <!-- {!$Label.Pol_Days_Since_Policy} -->
                                <apex:outputText rendered="{! NOT(ISNULL(policy.daysSincePolicyEffectiveDate))}">{!$Label.Pol_Days_Since_Policy}</apex:outputText>
                                <!--END HKITSFDC-210 -->
                            </div>
                            <div class="column-content-two" id="daysSincePolEffDate">
                               
                                <apex:outputPanel rendered="{!!ISNULL(policy.daysSincePolicyEffectiveDate)}">
                                <apex:variable var="allDays" value="{!IF(ISNULL(policy.daysSincePolicyEffectiveDate), 0, policy.daysSincePolicyEffectiveDate)}" />
                                <apex:variable var="year" value="{!IF(ISNULL(policy.daysSincePolicyEffectiveDate),0, Floor(allDays / 365))}" />
                                <apex:variable var="remainingDays" value="{!IF(ISNULL(policy.daysSincePolicyEffectiveDate),0, MOD(allDays,365))}" />
                                <apex:variable var="month" value="{!IF(ISNULL(policy.daysSincePolicyEffectiveDate),0, Floor(remainingDays / 30) )}" />
                                <apex:variable var="day" value="{!IF(ISNULL(policy.daysSincePolicyEffectiveDate),0, MOD(remainingDays ,30))}" />
                                
                                <apex:outputText >{!year} Y {!month} M {!day} D </apex:outputText>
                                </apex:outputPanel>

                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Total_IP_Claim_Amt}
                            </div>
                            <div class="column-content-two"> 
                                {!policy.totalIpClaimAmt}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Retention_Health_Eligible}
                            </div>
                            <div class="column-content-two">
                                {!policy.retentionHealthEligible}
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>
                    <!-- END HKITSFDC-22 -->
                <!-- chris-2020-7-15 -PolyEB information-->
                <apex:outputPanel id="policyPaymentInfo">
                    <div id="policy-detail-payment-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!transField['ClaimPaymentMethod']}</Label>
                            </div>
                        </div>
                    </div>
                    <!-- junda-2020-9-25 -PolyEB information-->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!transField['PayTo']}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].bankAccount.payMethod}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].bankAccount.payMethod,'')}"/>
                            </div>
                            <div class="column-header-two">
                                {!transField['PolBankCode']}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].bankAccount.bankCode}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].bankAccount.bankCode,'')}"/>
                            </div>
                        </div>
                    </div>

                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                
                            </div>
                            <div class="column-content-two">
                                
                            </div>
                            <div class="column-header-two">
                                {!transField['PolBankAC']}
                            </div>
                            <div class="column-content-two">
                                <!--Nicole_SMT_20210614_{!insuredList[0].bankAccount.accountNumber}-->
                                <apex:outputText value="{!IF(insuredList!=null && insuredList.size>0,insuredList[0].bankAccount.accountNumber,'')}"/>
                            </div>
                        </div>
                    </div>
                    <!-- junda-2020-9-25 -edd-->
                </apex:outputPanel>

                <apex:outputPanel id="policyHolderInformation">
                    <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_Policy_holder_Information}</Label>
                            </div>

                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header">
                                {!$Label.Pol_Policy_Holder}
                            </div>
                            <div class="column-content">
                                {!policy.holder.fullName}
                            </div>
                        </div>
                    </div>
                    <!-- 20210622 Bob Asia Mile -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                Asia Miles Membership No.
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.membership.membershipId}
                            </div>
                            <div class="column-header-two">
                                Asia Miles Membership Name
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.membership.membershipFirstName} {!policy.holder.membership.membershipLastName}
                            </div>
                        </div>
                    </div>
                    <!-- add by Jack on 2021-12-22 for project: IA AML CS part -->
                    <!-- <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$ObjectType.New_Policy__c.Fields.Nationality__c.Label}
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.NationalityDesc}
                            </div>
                            <div class="column-header-two">
                                {!$ObjectType.New_Policy__c.Fields.Place_of_Birth__c.Label}
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.PlaceOfBirthDesc}
                            </div>
                        </div>
                    </div> -->
                    <!-- add by Jack on 2021-12-22 for project: IA AML CS part -->
                    <apex:outputPanel rendered="{!policyType != 'Group'}">
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                    {!$Label.Pol_Gender}
                                </div>
                                <div class="column-content-two">
                                    {!holder.gender}
                                </div>
                                <div class="column-header-two">
                                    {!$Label.Pol_Date_of_Birth}(Age)
                                </div>
                                <div class="column-content-two dateOfBirth">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!holder.birthDateInDate}" />
                                    </apex:OutputText>
                                    <span id="age"></span>
                                </div>
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header">
                                    {!$Label.Pol_Policyholder_ID_Passport_No}
                                </div>
                                <div class="column-content">
                                    <!--Zane_TM Work From Home_20200812-->
                                    <apex:outputPanel rendered="{!!wfh}">{!holder.ssnNumber}</apex:outputPanel>
                                    <apex:outputPanel rendered="{!wfh}">{!holder.ssnNumberMasked}</apex:outputPanel>
                                </div>
                            </div>
                        </div>

                        <!-- 20200306 - minghua - ILAS -->
                        <div class="policy-detail-policy policy-detail-table" style="{!IF(isILAS,'','display: none;')}">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                    {!$Label.ILAS_RPQ_Status}
                                </div>
                                <div class="column-content-two">
                                    {!holder.rPQStatus}
                                </div>
                                <div class="column-header-two">
                                    {!$Label.ILAS_RPQ_Effective_Date}
                                </div>
                                <div class="column-content-two dateOfBirth">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!holder.rPQEffectiveDate}" />
                                    </apex:OutputText>
                                </div>
                            </div>
                        </div>
                        
                    </apex:outputPanel>
                    <script>
                        // HKITSFDC -73 Begin
                        // Createby:lps
                        // HKITSFDC -73 Policy Document(claims history) Display
                        function createLWC(){
                            var isConsole = sforce.console.isInConsole();
                            if (!isConsole && isConsole == false ) {
                                var aid = '{!holder.ssnNumber}';
                                console.log ( 'myVar : ' + aid  + ' customer Id : ' + '{!customeraccountId}' + ' policy number ' + '{!policyNumber}');
                                if ( aid == '' ){
                                    console.log('dont create the LWC first');
                                }
                                else{
                                    $Lightning.use(
                                            "c:upLoadFileAPP",
                                            function() {
                                                //  var recordId = {!customeraccountId}; //  customeraccountId  ID
                                                console.log('id'+ '{!customeraccountId}');
                                                var recordId = '{!customeraccountId}';
                                                var policyNum = '{!policyNumber}';
                                                $Lightning.createComponent(
                                                    "c:upLoadFile", // 
                                                    { recordId: recordId , policyNumber: policyNum }, //  Account Id
                                                    "upLoadFilec", //  div
                                                    function(component) {
                                                        console.log("Component created:", component);
                                                    }
                                                );
                                            }
                                        );
                                }
                             }
                             else {
                                 console.log('Never create LWC in console.');
                             }
                        }
                            console.log( ' document ready ' );
                            createLWC();
                            //HKITSFDC-73 End
                    </script>
                </apex:outputPanel>

                <apex:outputPanel id="policyContactInformation" rendered="{!policyType != 'Group'}">
                    <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_Contact_Information}</Label>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.CS_Mobile}
                            </div>
                            <div class="column-content-two">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}">{!policy.holder.mobileCountryCode}&nbsp;{!policy.holder.mobilePhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!policy.holder.mobileCountryCode}&nbsp;{!policy.holder.mobilePhoneNoMasked}</apex:outputPanel>
                            </div>
                            <div class="column-header-two">
                                {!$Label.CS_Home_Phone}
                            </div>
                            <div class="column-content-two">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!policy.holder.homePhoneCountryCode}&nbsp;{!policy.holder.homePhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!policy.holder.homePhoneCountryCode}&nbsp;{!policy.holder.homePhoneNoMasked}</apex:outputPanel>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.CS_Business_Phone}
                            </div>
                            <div class="column-content-two">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!policy.holder.businessPhoneCountryCode}&nbsp;{!policy.holder.businessPhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}"> {!policy.holder.businessPhoneCountryCode}&nbsp;{!policy.holder.businessPhoneNoMasked}</apex:outputPanel>
                            </div>
                            <div class="column-header-two">
                                {!$Label.CS_Home_Fax}
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.homeFaxNo}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.CS_Business_Fax}
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.businessFaxNo}
                            </div>
                            <div class="column-header-two">
                                {!$Label.CS_Other_Phone}
                            </div>
                            <div class="column-content-two">
                                {!policy.holder.otherPhoneNo}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header">
                                {!$Label.CS_Correspondence_Phone}
                            </div>
                            <div class="column-content">
                                {!policy.holder.correspondencePhoneNo}
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header">
                                {!$Label.Pol_Email}
                            </div>
                            <div class="column-content">
                                {!holder.emailAddress}
                                <!-- Rancho_JOBR57_20211115: add button for resending welcome email to users -->
                                <apex:outputPanel style="padding-left: 20px;">
                                    <button type="button" onclick="confirmResendWelcomeEmail();">Resend Welcome Email</button>
                                </apex:outputPanel>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header">
                                {!$Label.Pol_Correspondence_Address}
                            </div>
                            <div class="column-content">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!policy.holder.fullAddress}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!policy.holder.fullAddressMasked}</apex:outputPanel> 
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>

                <apex:outputPanel id="policyPersonsInsured">
                    <apex:pageBlock title="{!$Label.Pol_Person_s_Insured}">
                        <apex:pageBlockTable value="{!insuredList}" var="insure">
                            <apex:column headerValue="{!$Label.Pol_Person_Insured}">
                                {!insure.fullName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Gender}">
                                {!insure.gender}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Date_of_Birth}">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!insure.birthDateInDate}" />
                                </apex:OutputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Person_Insured_ID_Passport_No}">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!insure.ssnNumber}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!insure.ssnNumberMasked}</apex:outputPanel>
                            </apex:column>
                            <!-- 20210622 Bob Asia Mile -->
                            <apex:column headerValue="Asia Miles Membership No.">
                                {!insure.membership.membershipId}
                            </apex:column>
                            <apex:column headerValue="Asia Miles Membership Name">
                                {!insure.membership.membershipFirstName} {!insure.membership.membershipLastName}
                            </apex:column>
                            <!-- add by Jack on 2021-12-22 for project: IA AML CS part -->
                            <!-- <apex:column headerValue="{!$ObjectType.New_Policy__c.Fields.Nationality__c.Label}">
                                {!insure.NationalityDesc}
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.New_Policy__c.Fields.Place_of_Birth__c.Label}">
                                {!insure.PlaceOfBirthDesc}
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.New_Policy__c.Fields.Residential_Address_Country__c.Label}">
                                {!insure.PlaceOfBirthDesc}
                            </apex:column> -->
                            <!-- add by Jack on 2021-12-22 for project: IA AML CS part -->
                            <!-- CS Member Level Jack add-->
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!transField['OfficeTelNo']}">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!insure.businessPhoneCountryCode}&nbsp;{!insure.businessPhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!insure.businessPhoneCountryCode}&nbsp;{!insure.businessPhoneNoMasked}</apex:outputPanel>
                            </apex:column>
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!transField['ResidentTelNo']}">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!insure.homePhoneCountryCode}&nbsp;{!insure.homePhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!insure.homePhoneCountryCode}&nbsp;{!insure.homePhoneNoMasked}</apex:outputPanel>
                            </apex:column>
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!transField['Mobile']}">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!insure.mobileCountryCode}&nbsp;{!insure.mobilePhoneNo}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!insure.mobileCountryCode}&nbsp;{!insure.mobilePhoneNoMasked}</apex:outputPanel> 
                            </apex:column>
                            <!-- CS Member Level Jack add-->
                            <!-- Hardcopy Indicator added start-->
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!$Label.Hardcopy_Medical_Card_Indicator}">
                                <!--{!insure.medCardIndicator} --> <!--Commented by Connor because of DPSP-1044 -->
                                {!insure.policyList[0].medCardIndicator}
                            </apex:column>
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!$Label.Hardcopy_Letter_Indicator}">
                                <!--{!insure.letterIndicator} -->  <!--Commented by Connor because of DPSP-1044 -->
                                {!insure.policyList[0].letterIndicator}
                            </apex:column>
                            <!-- Hardcopy Indicator added end-->
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!$Label.Pol_Email}">
                                {!insure.emailAddress}
                            </apex:column>
                            <!-- comment by jack for Member Level
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!$Label.Pol_Correspondence_Address}">
                                {!insure.fullAddress}
                                </apex:column-->
                            <!--Jack add Member Level Correspondence FSD-->
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="{!transField['CorrespondenceAddress']}">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!insure.addressLine1}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">************</apex:outputPanel> 
                                <br/>
                                {!insure.addressLine2}<br/>
                                {!insure.addressLine3}<br/>
                                {!insure.addressCountry}
                            </apex:column>
                            <!-- CS Member Level Jack add-->
                            <!-- added by Connor for DDA signature status column-->
                            <apex:column rendered="{!policyType == 'Group'}" headerValue="DDA Signature Status">
                                {!insure.DDASignatureStatus}
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>

                <apex:outputPanel id="policyBneficiaryList" rendered="{!policyType != 'Group'}">
                    <apex:pageBlock title="{!$Label.Pol_Beneficiary_List}">
                        <apex:pageblockTable value="{!beneficiaryList}" var="b">
                            <apex:variable var="personIndex" value="{!0}" />
                            <apex:column rendered="{!fields2['Beneficiary'][policyType]}" headerValue="#">
                                {!personIndex}
                                <apex:variable var="personIndex" value="{!personIndex + 1}" />
                            </apex:column>
                            <apex:column rendered="{!fields2['Beneficiary'][policyType]}" headerValue="{!$Label.Pol_Beneficiary}">
                                {!b.fullName}
                            </apex:column>
                            <!-- HongKong Id add by kit -->
                            <apex:column rendered="{!fields2['Beneficiary'][policyType]}" headerValue="SSN ID">
                                <!--Zane_TM Work From Home__20200812-->
                                <apex:outputPanel rendered="{!!wfh}"> {!b.ssnNumber}</apex:outputPanel>
                                <apex:outputPanel rendered="{!wfh}">{!b.ssnNumberMasked}</apex:outputPanel>
                            </apex:column>
                        </apex:pageblockTable>
                    </apex:pageBlock>
                </apex:outputPanel>

                <apex:outputPanel id="policyDoc" rendered="{!policyDocList.size>0 && (policyType != 'Group')}">
                    <apex:pageBlock title="{!$Label.Pol_Policy_Documents}">
                        <apex:pageBlockSection >
                            <apex:selectList value="{!docSelectedYear}" label="Year" multiselect="false" size="1" onchange="PolicyDetailAF.switchDocList();">
                                <apex:selectOptions value="{!docYearList}" />
                            </apex:selectList>
                        </apex:pageBlockSection>
                        <div id="policyDocumentPanel" class="bs collapse panel-body form-toggle-content">
                            <!--Connor CR-47 Hide/Unhide docs start, removed apex:repeat, transformed into a table-->
                            <apex:pageblockTable id="policyDocTable" value="{!curDocList}" var="myList">
                                <apex:column headerValue="Document Name" style="padding: 5px 2px 4px 5px;">
                                    <!--<apex:commandLink action="{!getDoc2}" target="_blank">
                        {!myList.Description}
                        <apex:param assignTo="{!targetAttachmentKey}" id="targetAttachmentKey" name="targetAttachmentKey" value="{!myList.attachmentKey}" />
                        </apex:commandLink>-->
                                    <!--Nicole_2019.11.17_Download Efulfillment Document Asynchronous-->
                                    <a onclick="showLoading();PolicyDetailAF.getDoc2('{!myList.attachmentKey}') " style="cursor:pointer">{!myList.Description}</a>
                                </apex:column>
                                <apex:column headerValue="Date">
                                    {!myList.createdDateStrDisp}
                                </apex:column>
                                <apex:column headerValue="Action">
                                    <button style="margin-left: 15px;" type="button" onclick="showLoading();PolicyDetailAF.toggleDocState('{!myList.attachmentKey}','{!myList.Description}','PolicyDoc')">{!If(myList.status =='Y','Hide','Show')}</button>
                                </apex:column>
                                <apex:column headerValue="Doc Hidden Date" style="padding: 5px 2px 4px 5px;">
                                    {!myList.hiddenDateStr}
                                </apex:column>
                                <apex:column headerValue="Doc Hidden By" style="padding: 5px 2px 4px 5px;">
                                    {!myList.hiddenBy}
                                </apex:column>
                                <apex:facet name="footer">
                                    <div style="text-align:left;padding: 4px 2px 4px 5px;{!IF(curDocList.size>0, 'display:none;', '')}">
                                        <span>{!$Label.EFM_No_documents}</span>
                                    </div>
                                </apex:facet>
                            </apex:pageblockTable>
                            <!--Connor CR-47 Hide/Unhide docs end-->
                            <!-- Nicole_SMT_20210531 -->
                            <apex:outputPanel rendered="{!curFrontUrl!=null && curBackUrl!=null}">
                                <a 
                                href="/apex/CusEMedicalCardPDF?isPDF=1&front={!curFrontUrl}&back={!curbackUrl}" 
                                style="cursor:pointer">
                                    Emedical Card
                                </a>
                            </apex:outputPanel>
                        </div>
                    </apex:pageBlock>
                </apex:outputPanel>
                <apex:actionFunction action="{!switchDocList}" name="switchDocList" namespace="PolicyDetailAF" reRender="policyDoc" status="loader-icon" />
                <!-- policy corresponednces document -->
                <apex:outputPanel id="policyCorDoc" rendered="{!corDocList.size>0 && (policyType != 'Group')}">
                    <apex:pageBlock title="{!$Label.efulfillment_policy_correspondences}">
                        <apex:pageBlockSection >
                            <apex:selectList value="{!selectedYear}" label="Year" multiselect="false" size="1" onchange="PolicyDetailAF.switchCorList();">
                                <apex:selectOptions value="{!yearList}" />
                            </apex:selectList>
                        </apex:pageBlockSection>
                        <apex:outputPanel layout="block" id="corDocCtn">
                            <apex:pageblockTable id="corDocTable" value="{!curCorDocList}" var="myList">
                                <apex:column headerValue="Document Name">
                                    <!--<apex:commandLink action="{!getDoc2}" target="_blank">
                                        {!myList.Description}
                                        <apex:param assignTo="{!targetAttachmentKey}" id="targetAttachmentKey" name="targetAttachmentKey" value="{!myList.attachmentKey}" />
                                    </apex:commandLink>-->
                                    
                                    <!--Nicole_2019.11.17_Download Efulfillment Document Asynchronous-->
                                    <a onclick="showLoading();PolicyDetailAF.getDoc2('{!myList.attachmentKey}') " style="cursor:pointer">{!myList.Description}</a>
                                </apex:column>
                                <apex:column headerValue="Date">
                                    {!myList.createdDateStrDisp}
                                </apex:column>
                                <!--Connor CR-47 Hide/Unhide docs start-->
                                <apex:column headerValue="Action">
                                    <button style="margin-left: 15px;" type="button" onclick="showLoading();PolicyDetailAF.toggleDocState('{!myList.attachmentKey}','{!myList.Description}','PolicyCorDoc')">{!If(myList.status =='Y','Hide','Show')}</button>
                                </apex:column>
                                <apex:column headerValue="Doc Hidden Date" style="padding: 5px 2px 4px 5px;">
                                    {!myList.hiddenDateStr}
                                </apex:column>
                                <apex:column headerValue="Doc Hidden By" style="padding: 5px 2px 4px 5px;">
                                    {!myList.hiddenBy}
                                </apex:column>
                                <!--Connor CR-47 Hide/Unhide docs end-->
                                <apex:facet name="footer">
                                    <div style="text-align:left;{!IF(curCorDocList.size>0, 'display:none;', '')}">
                                        <span>{!$Label.EFM_No_documents}</span>
                                    </div>
                                </apex:facet>
                            </apex:pageblockTable>
                        </apex:outputPanel>
                    </apex:pageBlock>
                </apex:outputPanel>
                <apex:actionFunction action="{!switchCorList}" name="switchCorList" namespace="PolicyDetailAF" reRender="corDocCtn" status="loader-icon" />
                 <!----Policy Information End---->

        <!-- Header @description
         Createby:lps
        HKITSFDC -73 Policy Document(claims history) Display --> 
    <!--  Lightning  -->
    <apex:includeLightning />
    <!--<apex:outputPanel rendered="{!isCS}&&!sforce.console.isInConsole()">-->
    <apex:outputPanel rendered="{!isCS}">
        <apex:pageBlock title="Manual letter(Not available in MyCigna)">
            <div id="upLoadFilec"></div>
        </apex:pageBlock>
    </apex:outputPanel>    
    <!-- HKITSFDC-73 End   -->
            </div>
        </apex:outputPanel>
       

        <!-- Fund Porfolio Start-->
        <apex:outputPanel id="fundPorfolioPanel">
            <div class="policyDetailPanel" id="fundPorfolioPanelDiv">
                <apex:outputPanel id="totalFundInfo">
                    <div class="bs row" style="{!IF(hideChart,'display:none;','')}">
                        <apex:outputPanel layout="block" styleClass="bs col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-sm-offset-4 chart-center-div " style="padding-right: 0px;padding-left: 0px;">
                            <canvas id="chart-fund-perf" width="100" height="100"></canvas>
                        </apex:outputPanel>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Total_Fund_Value}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(policy.paymentAmt == null ,'','USD')} {0, Number,###,##0.00}">
                                    <apex:param value="{!fundSummary.accountValue}" />
                                </apex:outputText>
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Valuation_Date}
                            </div>
                            <div class="column-content-two">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!fundSummary.valuationDateInDate}" />
                                </apex:OutputText>
                            </div>
                        </div>
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Surrender_Value}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(policy.paymentAmt == null ,'','USD')} {0, Number,###,##0.00}">
                                    <apex:param value="{!fundSummary.surrenderChargeAmt}" /> 
                                </apex:outputText>
                            </div>
                            <div class="column-header-two">
                                {!$Label.Maximum_Withdraw_Amount}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(policy.paymentAmt == null ,'','USD')} {0, Number,###,##0.00}">
                                    <apex:param value="{!fundSummary.maxFundWithdrawalAmt}" />
                                </apex:outputText>
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>

                <apex:outputPanel id="fundPlanInfo">
                    <apex:pageBlock title="{!$Label.Basic_Plan}">
                        <apex:pageBlockTable value="{!basicFundDetails}" var="b">
                            <apex:column rendered="{!b.totValue != 0}">
                                {!b.productFullName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Unit}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.currNumberUnits}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Unit_Price}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Exchange_Rate}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValueBuyRate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="HKD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totalHKDValue}" />
                                </apex:outputText>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>

                    <apex:pageBlock title="{!$Label.Regular_Additional_Contribution}">
                        <apex:pageBlockTable value="{!regularFundDetails}" var="b">
                            <apex:column rendered="{!b.totValue != 0}">
                                {!b.productFullName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Unit}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.currNumberUnits}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Unit_Price}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Exchange_Rate}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValueBuyRate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="HKD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totalHKDValue}" />
                                </apex:outputText>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>

                    <apex:pageBlock title="{!$Label.Single_Additional_Contribution}">
                        <apex:pageBlockTable value="{!singleFundDetails}" var="b">
                            <apex:column rendered="{!b.totValue != 0}">
                                {!b.productFullName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Unit}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.currNumberUnits}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Unit_Price}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="USD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totValue}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Exchange_Rate}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="{0, Number,###,##0.00}">
                                    <apex:param value="{!b.unitValueBuyRate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Total}" rendered="{!b.totValue != 0}">
                                <apex:outputText value="HKD {0, Number,###,##0.00}">
                                    <apex:param value="{!b.totalHKDValue}" />
                                </apex:outputText>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>

                    <apex:pageBlock title="{!$Label.Pol_Fund_Contribution}">
                        <apex:pageblockTable value="{!fundContList}" var="b">
                            <apex:column headerValue="{!$Label.Pol_Fund_Name}">
                                {!b.fundName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Basic_Plan}">
                                {!b.basicPercentageDisplay}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Regular_Additional_Fund_Contribution}">
                                {!b.regularPercentageDisplay}
                            </apex:column>
                        </apex:pageblockTable>
                    </apex:pageBlock>

                    <apex:outputPanel id="fundTxPolicyLevel">
                        <apex:actionFunction action="{!fundTxprevPage}" name="fundTxprevPage" reRender="fundTxPolicyLevel" status="loader-icon" />

                        <apex:actionFunction action="{!fundTxnextPage}" name="fundTxnextPage" reRender="fundTxPolicyLevel" status="loader-icon" />

                        <apex:pageBlock title="{!$Label.Pol_Fund_Transactions}">
                            <apex:pageblockTable value="{!fundTransactionMap[fundTransactionPage]}" var="bb">
                                <apex:column headerValue="{!$Label.Pol_Transaction_Date}">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!bb.initPurchaseDateInDate}" />
                                    </apex:OutputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Fund}">{!bb.productFullName}
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Unit_Purchased_Redeemed}">
                                    <apex:outputText value="{0, Number,###,##0.00}">
                                        <apex:param value="{!bb.payoutUnitValue}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Unit_Price}">
                                    <apex:outputText value="USD {0, Number,###,##0.00}">
                                        <apex:param value="{!bb.unitValue}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Fund_Balance}">
                                    <apex:outputText value="USD {0, Number,###,##0.00}">
                                        <apex:param value="{!bb.totValue}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Exchange_Rate}">
                                    <apex:outputText value="{0, Number,###,##0.00}">
                                        <apex:param value="{!bb.unitValueBuyRate}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Fund_Balance}">
                                    <apex:outputText value="HKD {0, Number,###,##0.00}">
                                        <apex:param value="{!bb.totalHKDValue}" />
                                    </apex:outputText>
                                </apex:column>

                            </apex:pageblockTable>
                            <table align="right" cellspacing="10">
                                <tr>
                                    <td>
                                        <apex:outputText rendered="{!If(fundTransactionTotalPage>1 && fundTransactionhasPrev,true,false)}">
                                            <a href="javascript:void(0);" onclick="fundTxprevPage();">&lt;&lt; Previous Page</a>
                                            <span>|</span>
                                        </apex:outputText>
                                    </td>
                                    <td>

                                        <apex:outputText value=" {!$Label.Page_0_of_1}">
                                            <apex:param value="{!fundTransactionPage}" />
                                            <apex:param value="{!fundTransactionTotalPage}" />
                                        </apex:outputText>

                                    </td>
                                    <td>
                                        <apex:outputText rendered="{!If(fundTransactionTotalPage>1 && fundTransactionhasNext,true,false)}">
                                            <span>|</span>
                                            <a href="javascript:void(0);" onclick="fundTxnextPage();">Next Page &gt;&gt;</a>
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </table>
                        </apex:pageBlock>
                    </apex:outputPanel>
                    <apex:outputPanel id="fundTxCoverageLevel">
                        <apex:actionFunction action="{!fundTxByCoveragePrevPage}" name="fundTxByCoveragePrevPage" reRender="fundTxCoverageLevel" status="loader-icon" />

                        <apex:actionFunction action="{!fundTxByCoverageNextPage}" name="fundTxByCoverageNextPage" reRender="fundTxCoverageLevel" status="loader-icon" />

                        <apex:pageBlock title="{!$Label.Pol_Fund_Transactions_Coverage_Level}">
                            <apex:pageblockSection >
                                <apex:selectList value="{!selectedCoverageNumber}" multiselect="false" size="1" label="{!$Label.Pol_Coverage_No}">
                                    <apex:selectOptions value="{!coverageNumList}" />
                                    <apex:actionSupport status="loader-icon" event="onchange" action="{!searchfundTxByCoverage}" ReRender="fundTxCoverageLevel" /></apex:selectList>
                            </apex:pageblockSection>
                            <apex:pageblockTable value="{!fundTransactionCoverageMap[fundTransactionCoveragePage]}" var="tc">
                                <apex:column headerValue="{!$Label.Pol_Coverage_No}">
                                    {!tc.coverageNumber}
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Transaction_Type}">
                                    {!tc.transactionType}
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Valuation_Date}">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!tc.valuationDateInDate}" />
                                    </apex:OutputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Fund_Code}">
                                    {!tc.productCode}
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_No_of_Units}">
                                    <apex:outputText value="{0, Number,###,##0.00}">
                                        <apex:param value="{!tc.payoutUnitValue}" /></apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Unit_Price}">
                                    <apex:outputText value="USD {0, Number,###,##0.00}">
                                        <apex:param value="{!tc.unitValue}" /></apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Gross_Amount}">
                                    <apex:outputText value="USD {0, Number,###,##0.00}">
                                        <apex:param value="{!tc.grossAmount}" /></apex:outputText>
                                </apex:column>
                                <apex:column headerValue="{!$Label.Pol_Net_Amount}">
                                    <apex:outputText value="USD {0, Number,###,##0.00}">
                                        <apex:param value="{!tc.netAmount}" /></apex:outputText>
                                </apex:column>

                            </apex:pageblockTable>
                            <table align="right" cellspacing="10">
                                <tr>
                                    <td>
                                        <apex:outputText rendered="{!If(fundTransactionCoverageTotalPage>1 && fundTransactionCoveragehasPrev,true,false)}">
                                            <a href="javascript:void(0);" onclick="fundTxByCoveragePrevPage();">&lt;&lt; Previous Page</a>
                                            <span>|</span>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value=" {!$Label.Page_0_of_1}">
                                            <apex:param value="{!fundTransactionCoveragePage}" />
                                            <apex:param value="{!fundTransactionCoverageTotalPage}" />
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText rendered="{!If(fundTransactionCoverageTotalPage>1 && fundTransactionCoveragehasNext,true,false)}">
                                            <span>|</span>
                                            <a href="javascript:void(0);" onclick="fundTxByCoverageNextPage();">Next Page &gt;&gt;</a>
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </table>

                        </apex:pageBlock>
                    </apex:outputPanel>
                </apex:outputPanel>

                <script>
                    function drawChart() {
                        var ChartLabel = new Array();
                        ChartLabel = '{!ChartLabel}';
                        var cLabel = new Array();

                        var j = 0,
                            k = 0;

                        for(var i = 0; i < ChartLabel.length; i++) {
                            if(ChartLabel[i] == ',' || ChartLabel[i] == ']') {
                                if(j == 0) {
                                    for(var g = 1; g < i; g++) {
                                        if(g == 1) {
                                            cLabel[k] = ChartLabel[g];
                                        } else {
                                            cLabel[k] = cLabel[k] + ChartLabel[g];
                                        }
                                    }
                                    k++;
                                    j = i;
                                } else {
                                    for(var g = j + 1; g < i; g++) {
                                        if(g == j + 1) {
                                            cLabel[k] = ChartLabel[g];
                                        } else {
                                            cLabel[k] = cLabel[k] + ChartLabel[g];
                                        }
                                    }
                                    k++;
                                    j = i;
                                }
                            }
                        }

                        var ChartData = new Array();
                        ChartData = '{!ChartData}';
                        var cDate = new Array();
                        j = 0;
                        k = 0;

                        for(var i = 0; i < ChartData.length; i++) {
                            if(ChartData[i] == ',' || ChartData[i] == ']') {
                                if(j == 0) {
                                    for(var g = 1; g < i; g++) {
                                        if(g == 1) {
                                            cDate[k] = ChartData[g];
                                        } else {
                                            cDate[k] = cDate[k] + ChartData[g];
                                        }
                                    }
                                    k++;
                                    j = i;
                                } else {
                                    for(var g = j + 1; g < i; g++) {
                                        if(g == j + 1) {
                                            cDate[k] = ChartData[g];
                                        } else {
                                            cDate[k] = cDate[k] + ChartData[g];
                                        }
                                    }
                                    k++;
                                    j = i;

                                }
                            }
                        }
                        var data = {
                            labels: cLabel,
                            datasets: [{
                                label: 'Unit Price',
                                data: cDate,
                                backgroundColor: [
                                    'rgba(196, 214, 0, 1)',
                                    'rgba(0, 169, 224, 1)',
                                    'rgba(241, 180, 52, 1)',
                                    'rgba(57, 181, 74, 1)',
                                    'rgba(24, 140, 204, 1)',
                                    'rgba(246, 134, 33, 1)',
                                    'rgba(0, 122, 62, 1)',
                                    'rgba(0, 73, 134, 1)',
                                    'rgba(227, 82, 5, 1)'
                                ],
                                borderColor: [
                                    'rgba(196, 214, 0, 1)',
                                    'rgba(0, 169, 224, 1)',
                                    'rgba(241, 180, 52, 1)',
                                    'rgba(57, 181, 74, 1)',
                                    'rgba(24, 140, 204, 1)',
                                    'rgba(246, 134, 33, 1)',
                                    'rgba(0, 122, 62, 1)',
                                    'rgba(0, 73, 134, 1)',
                                    'rgba(227, 82, 5, 1)'
                                ],
                                borderWidth: 1
                            }]
                        };

                        var ctx = $("#chart-fund-perf");
                        var myChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: data,
                            options: {
                                responsive: true,
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        fontSize: 10
                                    }
                                },
                                tooltips: {
                                    callbacks: {
                                        label: function(tooltipItem, data) {
                                            var dataset = data.datasets[tooltipItem.datasetIndex];
                                            var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
                                                return parseInt(previousValue) + parseInt(currentValue);
                                            });
                                            var currentValue = dataset.data[tooltipItem.index];
                                            var precentage = Math.floor(((currentValue / total) * 100) + 0.5);
                                            return precentage + "%: " + currentValue;
                                        }
                                    }
                                }
                            }
                        });
                    }

                    drawChart();
                </script>
            </div>
        </apex:outputPanel>
        <!-- Fund Porfolio End-->

        <!----Coverage Information Start---->
        <apex:outputPanel id="coverageInfoPanel">
            <div class="policyDetailPanel" id="coverageInfoPanelDiv">
                <apex:actionFunction action="{!coverageprevPage}" name="coverageprevPage" reRender="coverageInfoTable" status="loader-icon" />

                <apex:actionFunction action="{!coveragenextPage}" name="coveragenextPage" reRender="coverageInfoTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.Pol_Coverage_Information}" id="coverageInfoTable">
                    <apex:pageBlockTable value="{!coverageMap[coveragePage]}" var="c">
                        <apex:column headerValue="{!$Label.Pol_Benefit}">{!c.benefitMarketingName}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Sum_Insured}">
                            {!IF(c.benefitAmountInNumber == null,'',policy.currencySymbol)}
                            <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                <apex:param value="{!c.benefitAmountInNumber}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Deductible_Amount}" rendered="{!showDeductible}">
                            {!IF(c.deductibleAmount == null,'',policy.currencySymbol)}
                            <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                <apex:param value="{!c.deductibleAmount}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Effective_Date}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.effectiveDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <!-- Rancho_JOBR381_20240722 - remove annual premium -->
                        <!-- <apex:column headerValue="{!$Label.Pol_Modal_Premium}"> -->
                            <!-- Rancho_JOBR367_20240513 - update premium display -->
                            <!-- <apex:outputPanel rendered="{!renewalEligible && c.renewalNoticeInd == 'Y'}">
                                {!transField['RenewalNotice']}
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!!(renewalEligible && c.renewalNoticeInd == 'Y')}">
                                {!IF(c.modalPremium == null,'',policy.currencySymbol)}
                                <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                    <apex:param value="{!c.modalPremium}" />
                                </apex:outputText>
                            </apex:outputPanel>
                        </apex:column> -->
                        <apex:column headerValue="{!$Label.Pol_Additional_Fund_Contribution_Amount}" rendered="{!showAFCcolumns}">
                            <apex:outputPanel rendered="{!BEGINS(c.benefitCode,'AFCR')}">
                                {!policy.currencySymbol}
                                <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                    <apex:param value="{!c.additionalFundContributionAmountInNumber}" />
                                </apex:outputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!BEGINS(c.benefitCode,'AFCS')}">
                                N/A
                            </apex:outputPanel>
                        </apex:column>
                        <!-- Rancho_JOBR381_20240722 - remove annual premium -->
                        <!-- <apex:column headerValue="{!$Label.Pol_Annual_Premium}"> -->
                            <!-- Rancho_JOBR367_20240513 - update premium display -->
                            <!-- <apex:outputPanel rendered="{!renewalEligible && c.renewalNoticeInd == 'Y'}">
                                {!transField['RenewalNotice']}
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!!(renewalEligible && c.renewalNoticeInd == 'Y')}">
                                {!IF(c.annualPremium == null,'',policy.currencySymbol)}
                                <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                    <apex:param value="{!c.annualPremium}" />
                                </apex:outputText>
                            </apex:outputPanel>
                        </apex:column> -->
                        <apex:column headerValue="{!$Label.Pol_Additional_Fund_Contribution_Annual_Amount}" rendered="{!showAFCcolumns}">
                            <apex:outputPanel rendered="{!BEGINS(c.benefitCode,'AFCR')}">
                                <!--SPS-95 AH16493 -->
                                {!policy.currencySymbol}
                                <apex:outputText styleClass="pull-right" value="{0, Number,###,##0.00}">
                                    <apex:param value="{!c.additionalFundContributionAnnualAmountInNumber}" />
                                </apex:outputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!BEGINS(c.benefitCode,'AFCS')}">
                                N/A
                            </apex:outputPanel>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Person_Insured}">
                            {!c.insuredName}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Maturity_Expiry_Date}">
                            <apex:outputPanel rendered="{!c.maturityExpiryDateInDate != null}">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!c.maturityExpiryDateInDate}" />
                                </apex:OutputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!c.maturityExpiryDateInDate == null}">
                                N/A
                            </apex:outputPanel>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Status}">
                            {!c.coverageStatus}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Face_Amount}">
                            {!c.faceAmt}
                        </apex:column>
                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(coverageTotalPage>1 && coveragehasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="coverageprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!coveragePage}" />
                                    <apex:param value="{!coverageTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(coverageTotalPage>1 && coveragehasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="coveragenextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Coverage Information End---->

        <!----Payment Information Start---->
        <apex:outputPanel id="paymentInfoPanel">
            <div class="policyDetailPanel" id="paymentInfoPanelDiv">
                <apex:outputPanel >
                    <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_Payment_Information}</Label>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Payment_Mode}
                            </div>
                            <div class="column-content-two">
                                {!policy.paymentMode}
                            </div>
                            <div class="column-header-two">
                                {!$Label.Pol_Total_Modal_Premium}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(payment.modalPremium == null,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!payment.modalPremium}" />
                                </apex:outputText>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <!-- Rancho_JOBR381_20240722 - remove annual premium -->
                            <!-- <div class="column-header-two">
                                {!$Label.Pol_Total_Annual_Premium}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(payment.annualPremium == null,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!payment.annualPremium}" />
                                </apex:outputText>
                            </div> -->
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!transField['Levy_Total_Modal_Premium_Including_Levy']}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(payment.totalModalPremiumIncludeLevy == null,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!payment.totalModalPremiumIncludeLevy}" />
                                </apex:outputText>
                            </div>
                            <div class="column-header-two">
                                 
                            </div>
                            <div class="column-content-two"> 
                               
                            </div>
                        </div>
                    </div>
                     <!-- BEGIN https://jira.express-scripts.com/browse/HKITSFDC-15 -->
                     <!--HKITSFDC-267 begin-->
                    <div id="conditionNCDPaymentTab" >
                        <!--<div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header-two">
                                 {!$Label.Pol_NCD_Indicator}
                                </div>
                                <div class="column-content-two">
                                  {!policy.NcdInd} 
                                </div>
                                <div class="column-header-two">
                                  {!$Label.Pol_NCD_Eligibility}
                                </div>
                                <div class="column-content-two">
                                  {!payment.nCDEligibility } 
                                </div>
                            </div>-->
                        
                      
                    </div>
                    <!---HKTISFDC-267 End-->
                    <!-- END https://jira.express-scripts.com/browse/HKITSFDC-15  -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Payment_Method}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.paymentMethod}" />
                            </div>
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!$Label.Pol_Account_No}
                            </div>
                            <div class="column-content-two">
                                <div id="accountNumber">
                                    {!payment.accountNumber}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Card_Type}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.CardType}" />
                            </div>
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!$Label.Pol_Debit_Day}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.polDebitDayDisplay}" />
                            </div>
                        </div>
                    </div>
                 <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Payor_ID}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText rendered="{!!wfh}" value="{!payment.CardHolderID }" />
                                <apex:outputText rendered="{!wfh}" value="{!payment.CardHolderIDMasked }" />
                            </div>
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!$Label.Pol_Credit_Card_Expiry_Date}
                            </div>
                            <div class="column-content-two">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!payment.creditCardExpDateInDate}" />
                                </apex:OutputText>
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Autopay_limit}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.AutopayLimit}" />
                            </div>
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!$Label.Pol_Payor}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.fullname}" />
                            </div>
                        </div>
                    </div>
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_Start_Date_of_Automatic_Premium_Payment}
                            </div>
                            <div class="column-content-two">
                                <apex:outputPanel rendered="{!payment.startDateofAutomaticPremiumPaymentInDate != null}">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!payment.startDateofAutomaticPremiumPaymentInDate}" />
                                    </apex:OutputText>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!payment.startDateofAutomaticPremiumPaymentInDate == null}">
                                    N/A
                                </apex:outputPanel>
                            </div>
                            <!-- 20200610 - minghua - levyII -->
                            <div class="column-header-two">
                                {!$Label.Pol_Latest_Autopay_Reject_Date_And_Reason}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!payment.LatestAutopayRejectDateandReason}" />
                            </div>
                        </div>
                    </div>
                    <!----JR1774 - [[---->
                    <div class="policy-detail-policy policy-detail-table" id='credit_card_validation_control_panel'>
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Account_No_Masked_Part}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(payment.accountMaskedNumber == null,'',payment.accountMaskedNumber)}">
                                    <apex:inputText value="{!payment.accountMaskedNumber}" maxlength="8" onkeyup="validateAccMaskedNumberInput(this)" id="account_masked_number" />
                                    <apex:inputHidden value="{!creditCardNumber}" id="full_credit_card_number" />
                                    <div id="jr1774_message_01"><BR /><font style="color: red;">{!$Label.Only_Numeric_Input_Is_Allowed}</font></div>
                                </apex:outputText>
                            </div>
                            <div class="column-header-two" id="display_credit_card_number"></div>
                            <div class="column-content-two">
                                <div id="accountNumberValidateResult">
                                    <apex:outputPanel id="paymentInfoPanel_credit-card-validate-result-panel">
                                    <apex:actionFunction name="passAccountMaskedNumberValueToController" action="{!validateCreditCardNumber}" rerender="paymentInfoPanel_focus_account_masked_number">
                                        <apex:param name="jr1774_p1" value="" assignTo="{!payment.accountMaskedNumber}" />
                                    </apex:actionFunction>
                                    
                                    <apex:actionFunction name="passFullCreditCardNumberValueToController" action="{!validateCreditCardNumber}" rerender="full_credit_card_number">
                                        <apex:param name="jr1774_p2" value="" assignTo="{!creditCardNumber}" />
                                    </apex:actionFunction>
                                    
                                        <apex:outputPanel id="paymentInfoPanel_focus_account_masked_number">
                                            <script>
                                                function moveCursorToEnd(el) {
                                                    el.focus();
                                                    if (typeof el.selectionStart == "number") {
                                                        el.selectionStart = el.selectionEnd = el.value.length;
                                                    } else if (typeof el.createTextRange != "undefined") {
                                                        el.focus();
                                                        var range = el.createTextRange();
                                                        range.collapse(false);
                                                        range.select();
                                                    }
                                                }
                                                moveCursorToEnd(document.getElementById('{!$Component.account_masked_number}'));
                                            </script>
                                        </apex:outputPanel>
                                        <script>
                                                
                                            var szAccountNumber = '{!payment.accountNumber}';
                                            szAccountNumber = $.trim(szAccountNumber);
                                            
                                            var szPaymentMethod = '{!payment.paymentMethod}';
                                            szPaymentMethod = $.trim(szPaymentMethod); 
                                            szPaymentMethod = szPaymentMethod.toUpperCase();
                                            szPaymentMethod = szPaymentMethod.replace(" ", "");    // AH18501
                                            
                                            //if (0 == szAccountNumber.length || 0 != "CREDIT CARD".localeCompare(szPaymentMethod)) {    // AH18501 - Commented
                                            if (0 == szAccountNumber.length || szPaymentMethod.indexOf("CREDITCARD") < 0) {    // AH18501
                                                document.getElementById('{!$Component.account_masked_number}').disabled = true;
                                            }
                                            
                                            function replaceCharOfStringAt(s, n, t) {
                                                // replace the 'n'th character of 's' with 't':
                                                return s.substring(0, n) + t + s.substring(n + 1);
                                            }
                                            
                                            function insertCharToString(s, n, t) {
                                                // insert the 'n'th character of 's' with 't':
                                                return [s.slice(0, n), t, s.slice(n)].join('');
                                            }
                                            
                                            function validateAccMaskedNumberInput(element) {
                                                var value = element.value;
                                                value = value.replace(" ", "");
                                                
                                                if ($.isNumeric(value)) {
                                                    $("#jr1774_message_01").hide();
                                                    
                                                    if (value.length == 8) {
                                                        showLoading();
                                                        setTimeout(validateCreditCardNumber, 3000);  
                                                    } 
                                                } else if (null == value || 0 == value.length) {
                                                    $("#jr1774_message_01").hide();
                                                   
                                                } else {
                                                    $("#jr1774_message_01").show(); 
                                                }
                                                
                                                passAccountMaskedNumberValueToController(value);
                                                console.log('value: '+value);
                                                if (null != value && 0 < value.length) {
                                                    var szCreditCardNumForDisplay = '{!payment.accountNumber}';
                                                    console.log('szCreditCardNumForDisplay: '+szCreditCardNumForDisplay);
                                                    for (i = 0; i < value.length; i++) {
                                                        szCreditCardNumForDisplay = replaceCharOfStringAt(szCreditCardNumForDisplay, i+4, value.charAt(i));
                                                        console.log('index: '+value.charAt(i));
                                                        console.log('szCreditCardNumForDisplay: '+szCreditCardNumForDisplay);
                                                    }
                                                    passFullCreditCardNumberValueToController(szCreditCardNumForDisplay);
                                                    console.log('szCreditCardNumForDisplay: '+szCreditCardNumForDisplay);
                                                   
                                                    //JL-20191202 szCreditCardNumForDisplay = insertCharToString(szCreditCardNumForDisplay, 4, '-');
                                                    //JL-20191202 szCreditCardNumForDisplay = insertCharToString(szCreditCardNumForDisplay, 9, '-');
                                                    //JL-20191202 szCreditCardNumForDisplay = insertCharToString(szCreditCardNumForDisplay, 14, '-');
                                                     
                                                //JL-20191202     $("#display_credit_card_number").html('{!$Label.Credit_Card_Number_To_Be_Validate} - ' + szCreditCardNumForDisplay);
                                                    $("#display_credit_card_number").html('{!$Label.Credit_Card_Number_Validation_Result}'); //JL-20191202
                                                } else {
                                                    $("#display_credit_card_number").html('');
                                                }

                                            }
                                        
                                            function afterCreditCardNumValidated(){
                                                var isValid = '{!isCreditCardNumberValid}';
                                                var isWebServiceSuccess = '{!isWebServiceCallSuccess}';    // AH18454
                                               
                                                if (isWebServiceSuccess=='true'){        // AH18454
                                                    if (isValid=='false'){
                                                        console.log('[CSPolicyDetailsVFP] The credit card number is invalid!');
                                                    }else{
                                                        console.log('[CSPolicyDetailsVFP] The credit card number is valid!');
                                                    }
                                                // AH18454 - [[
                                                } else {
                                                    console.log('[CSPolicyDetailsVFP] The web service for credit card number validation failed!');
                                                }
                                                // ]] - // AH18454
                                                finishLoading();
                                            }
                                        </script>
                                        <apex:messages id="is-credit-card-number-valid" >{!validationResultMessage}</apex:messages>
                                        
                                        
                                    </apex:outputPanel>   
                                    <script>$("#jr1774_message_01").hide();</script> 
                                </div>
                            </div>
                        </div>
                    </div>
                    <!----]] - JR1774---->
                    <!-- 20200610 - minghua - levyII -->
                    <div class="policy-detail-policy policy-detail-table">
                        <div class="policy-detail-table-row">
                            <div class="column-header-two">
                                {!$Label.Pol_End_Date_of_Automatic_Premium_Payment}
                            </div>
                            <div class="column-content-two">
                                <apex:outputPanel rendered="{!payment.endDateofAutomaticPremiumPaymentInDate != null}">
                                    <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                        <apex:Param value="{!payment.endDateofAutomaticPremiumPaymentInDate}" />
                                    </apex:OutputText>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!payment.endDateofAutomaticPremiumPaymentInDate == null}">
                                    N/A
                                </apex:outputPanel>
                            <!-- AM project coupon jack add -->
                            </div><div class="column-header-two">
                                {!transField['Total_Coupon_Used_Amount']}
                            </div>
                            <div class="column-content-two">
                                <apex:outputText value="{!IF(payment.couponUsedAmt == null,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                    <apex:param value="{!payment.couponUsedAmt}" />
                                </apex:outputText>
                            </div>
                            <!-- AM project coupon jack add -->
                        </div>
                    </div>
                    
                       <!--HKITSFDC-267 Begin-->  
                   <apex:outputPanel id="ncDInfoPaymentNew" >
                    <div id="policy-detail-payment-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                        <div class="bs col-sm-12" style="padding:0;">
                            <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                                <Label class="block-header">{!$Label.Pol_NCD_Eligibility}</Label>
                            </div>
                        </div>
                    </div> 
                     <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                             
                                <!-- Final Segment -->
                                 <div class="column-header-two" >
                                    {!$Label.Pol_NCD_Eligibility} 
                                </div>
                                <div class="column-content-two" >
                                   {!policy.NcdInd} 
                                </div>   
                                
                                  <div class="column-header-two">
                                        {!$Label.Pol_NCD_Percentage}
                                    </div>
                                    <div class="column-content-two">
                                        {!IF(policy.NcdInd== 'N', '0%', TEXT(ROUND(policy.NcdPercentage, 1)) & '%')}
                                    </div>    
                            </div>
                            </div>
                            </apex:outputPanel>
                    <!--HKITSFDC-267 End-->
                </apex:outputPanel>
                    
              
                <apex:outputPanel id="transactionHistory">
                    <apex:actionFunction action="{!paymentprevPage}" name="paymentprevPage" reRender="transactionHistoryTable" status="loader-icon" />

                    <apex:actionFunction action="{!paymentnextPage}" name="paymentnextPage" reRender="transactionHistoryTable" status="loader-icon" />

                    <apex:pageBlock title="{!$Label.Pol_Transaction_History}" id="transactionHistoryTable">
                        <apex:pageBlockTable value="{!paymentTranMap[paymentTranPage]}" var="b">
                            <apex:column headerValue="{!$Label.Pol_Transaction_Date}">
                                <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:Param value="{!b.finActivityDateInDate}" />
                                </apex:OutputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Description}">{!b.description}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Bill_Amount}">
                                <!--<apex:outputText styleClass="pull-right" value="{!IF(b.automaticPremiumPayment == null,'',b.currencySymbol)} {0, Number,###,##0.00}">-->
                                <apex:outputText styleClass="pull-right" value="{!b.currencySymbol} {0, Number,###,##0.00}">
                                    <apex:param value="{!b.FinActivityGrossAmt}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Bill_Date}">
                                <apex:outputText styleClass="pull-right" value="{0,date,yyyy/MM/dd}">
                                    <apex:param value="{!b.finActivityDateInDate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Billing_Start_Date}">
                                <apex:outputText styleClass="pull-right" value="{0,date,yyyy/MM/dd}">
                                    <apex:param value="{!b.BillingStartDate}" />
                                </apex:outputText>
                            </apex:column>
                            <!-- 20200610 - minghua - levyII -->
                            <apex:column headerValue="{!transField['Levy_Outstanding_Levy_Indicator']}">
                                <apex:outputText value="{!b.outstandingLevyIndicator}" />
                            </apex:column>

                            <apex:column headerValue="{!$Label.Pol_Period}">
                                <apex:outputText value="{!b.Period}" />
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Status}">
                                <apex:outputText value="{!b.Status}" />
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Autopay_Premium_Reject_Reason}">
                                <apex:outputText value="{!b.rejCodeDesc}" />
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Paid_Date}">
                                <apex:outputText styleClass="pull-right" value="{0,date,yyyy/MM/dd}">
                                    <apex:param value="{!b.PayDate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Currency}">
                                <apex:outputText value="{!b.currencyTypeDesc}" />
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Collector}">
                                <apex:outputText value="{!b.Collector}" />
                            </apex:column>

                        </apex:pageBlockTable>
                        <table align="right" cellspacing="10">
                            <tr>
                                <td>
                                    <apex:outputText rendered="{!If(paymentTranTotalPage<=1 || !paymenthasPrev,false,true)}">
                                        <a href="javascript:void(0);" onclick="paymentprevPage();">&lt;&lt; Previous Page</a>
                                        <span>|</span>
                                    </apex:outputText>
                                </td>
                                <td>
                                    <apex:outputText value=" {!$Label.Page_0_of_1}">
                                        <apex:param value="{!paymentTranPage}" />
                                        <apex:param value="{!paymentTranTotalPage}" />
                                    </apex:outputText>
                                </td>
                                <td>
                                    <apex:outputText rendered="{!If(paymentTranTotalPage>1 && paymenthasNext,true,false)}">
                                        <span>|</span>
                                        <a href="javascript:void(0);" onclick="paymentnextPage();">Next Page &gt;&gt;</a>
                                    </apex:outputText>
                                </td>
                            </tr>
                        </table>
                    </apex:pageBlock>
                </apex:outputPanel>
                <!-- Discount Offered Table -->
                <apex:outputPanel >
                    <apex:pageBlock title="{!$Label.Pol_Discount_Offered}">
                        <apex:pageBlockTable value="{!payment.discountList}" var="discount">
                            <apex:column headerValue="Discount">
                                <apex:outputText value="{!discount.description}"/>
                            </apex:column>
                            <apex:column headerValue="Discount Duration">
                                <apex:outputText value="{!discount.discountDuration}"/>
                            </apex:column>
                            <apex:column headerValue="Discount Percentage">
                                <apex:outputText value="{!discount.discountPercentage}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>
                <!-- Discount Offered Table End -->
                    
                <!-- Coupon Table AM project coupon jack add-->
                <apex:outputPanel >
                    <apex:pageBlock title="{!$ObjectType.Coupon__c.Label}">
                        <apex:pageBlockTable value="{!payment.couponList}" var="coupon">
                            <apex:column headerValue="{!$ObjectType.Coupon__c.Fields.Coupon_Number__c.Label}">
                                <apex:outputText value="{!coupon.sojectCoupon.Coupon_Number__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Coupon__c.Fields.Coupon_Amount__c.Label}">
                                <apex:outputText value="{!coupon.sojectCoupon.Coupon_Amount__c}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>
                <!-- Coupon Table End -->

                <!-- Exclusion Table -->
                <apex:outputPanel >
                    <apex:pageBlock title="{!$Label.Pol_Exclusion_Coverage_Level}">
                        <apex:pageBlockTable value="{!exclusionList4PaymentInfo}" var="exclusion">
                            <apex:column headerValue="Exclusion Sequence No">
                                <apex:outputText value="{!exclusion.ExclusionSeqNo}"/>
                            </apex:column>
                            <!-- Rancho_HKITSFDC352_20250825 - add plan code -->
                            <apex:column headerValue="Plan Code">
                                <apex:outputText value="{!exclusion.planCode}"/>
                            </apex:column>
                            <apex:column headerValue="Exclusion Code">
                                <apex:outputText value="{!exclusion.ExclusionCode}"/>
                            </apex:column>
                            <apex:column headerValue="Exclusion Description">
                                <apex:outputText value="{!exclusion.ExclusionDesc}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>
                <!-- Exclusion Table End -->
                    
                <!-- Loading Table -->
                <apex:outputPanel >
                    <apex:pageBlock title="{!$Label.Pol_Loading_Coverage_Level}">
                        <apex:pageBlockTable value="{!loadingList4PaymentInfo}" var="loading">
                            <apex:column headerValue="Loading Amount">
                                <apex:outputText value="{!loading.loadingAmount}"/>
                            </apex:column>
                            <apex:column headerValue="Loading percentage">
                                <apex:outputText value="{!loading.loadingPercentageStr}"/>
                            </apex:column>
                            <apex:column headerValue="Loading amount duration">
                                <apex:outputText value="{!loading.loadingAmountDuration}"/>
                            </apex:column>
                            <apex:column headerValue="Loading precentage duration">
                                <apex:outputText value="{!loading.loadingPercentageDuration}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>
                <!-- Loading Table End -->
            </div>
        </apex:outputPanel>
        <!----Payment Information End---->

        <!----Claim History Start---->
        <apex:outputPanel id="claimHistoryPanel">
            <div class="policyDetailPanel" id="claimHistoryPanelDiv">
                <apex:actionFunction action="{!claimprevPage}" name="claimprevPage" reRender="claimHisTable" status="loader-icon" />

                <apex:actionFunction action="{!claimnextPage}" name="claimnextPage" reRender="claimHisTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.Pol_Claim_History}" id="claimHisTable">
                    <apex:pageblockSection >
                        <apex:selectList value="{!selectedClaimStatus}" label="{!$Label.Pol_Claims_Status}" multiselect="false" size="1" styleClass="bs form-field-style-select cigna-fg-gray-dark">
                            <apex:selectOptions value="{!claimStatusList}" />
                            <apex:actionSupport event="onchange" status="loader-icon" action="{!searchClaimbyStatus}" reRender="claimHisTable" />
                        </apex:selectList>
                    </apex:pageblockSection>
                    <apex:pageBlockTable value="{!claimMap[claimPage]}" var="c">
                        <apex:column headerValue="{!$Label.Pol_Claim_No}">
                            <a href="javascript:void(0);" onclick="openClaimDetailPage('{!c.claimNumber}','{!policyType}','{!policy.policyNumber}','{!c.certNumber}');">{!c.claimNumber}</a>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Claim_Type}" rendered="{!policyType != 'Group'}">
                            {!c.claimTypeDisplay}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Received_Date}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.submitDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Person_Insured}" rendered="{!policyType != 'Group'}">
                            <apex:outputPanel rendered="{!personInsureId != ''}">
                                <a href="javascript:void(0);" onclick="openCustomerProfilePage('{!personInsureId}','{!policyNumber}');">{!c.policyInsuredName}</a>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!personInsureId == ''}">
                                {!c.policyInsuredName}
                            </apex:outputPanel>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Claim_Status}">{!c.claimStatusDescription}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Claim_Period_From}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.consultationDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Claim_Period_To}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.dischargeDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Paid_Amount}">
                            <!--apex:outputText value="{!policy.currencySymbol} {0, Number,###,##0.00}"-->
                            <apex:outputText value="{!c.currencySymbol} {0, Number,###,##0.00}">
                                <apex:param value="{!c.paidAmount}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Member_Name}" rendered="{!policyType == 'Group'}">

                            {!c.policyInsuredName}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Member_Cert_No}" rendered="{!policyType == 'Group'}">
                            {!c.certNumber}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Type}" rendered="{!policyType == 'Group'}">
                            {!c.benefitTypeDisplay}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Incurred_Amount}" rendered="{!policyType == 'Group'}">
                            <apex:outputText value="{!c.currencySymbol} {0, Number,###,##0.00}">
                                <apex:param value="{!c.incurredAmount}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Payment_Date}" rendered="{!policyType == 'Group'}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.paymentDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Branch}" rendered="{!policyType == 'Group'}">
                            {!c.branchDesc}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Last_Update_Date}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.lastUpdateDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(claimTotalPage>1 && claimhasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="claimprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!claimPage}" />
                                    <apex:param value="{!claimTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(claimTotalPage>1 && claimhasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="claimnextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
            <!-- add by kit -->
            <div class="policyDetailPanel" id="claimHistoryPortalDiv">
                <!-- action -->
                <apex:actionFunction action="{!claimHistroyPrevPage}" name="claimHistroyPrevPage" reRender="claimHisPortalTable" status="loader-icon" />

                <apex:actionFunction action="{!claimHistroyNextPage}" name="claimHistroyNextPage" reRender="claimHisPortalTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.CP_Claims_Histories_Portal}" id="claimHisPortalTable">
                    <!-- Rancho_PI140_20231204 - avoid error collection exceeds 1000 -->
                    <apex:pageBlockTable value="{!curClaimList}" var="item">
                        <apex:column headerValue="{!$Label.Policy_No}" width="10%">
                            <apex:outputText value="">
                                <div>{!item.Policy__c}</div>
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Claim_Detial}" width="10%">
                            <apex:outputText value="">
                                <div class="onclick-pointer" style="text-decoration:underline" onclick="openClaimDetailPage('{!item.Name}','{!policyType}','{!item.Policy__c}',null ,'Portal')">View</div>
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Claim_Type}(Portal)" width="20%">
                            <apex:outputText value="{!item.Claim_Type__c}"></apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Person_Insured}" width="10%">
                            <apex:outputText value="">
                                <div class="onclick-pointer" style="text-decoration:underline">{!item.Person_Insured_Name__c}</div>
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Submission_Date}" width="30%">
                            <apex:outputText value="{0, Date, yyyy/MM/dd}">
                                <apex:param value="{!item.Submission_Date__c}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Claim_Histroy_Status}" width="20%">
                            <apex:outputText value="Submitted"></apex:outputText>
                        </apex:column>
                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!HasPrevious_Histroy}">
                                    <a href="javascript:void(0);" onclick="claimHistroyPrevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!CurrentPage_Histroy}" />
                                    <apex:param value="{!TotalPage_Histroy}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!HasNext_Histroy}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="claimHistroyNextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Claim History End---->

        <!-----Policy Change History Start---->
        <apex:outputPanel id="policyChangeHistoryPanel">
            <div class="policyDetailPanel" id="policyChangeHistoryPanelDiv">
                <apex:actionFunction action="{!policyChangeprevPage}" name="policyChangeprevPage" reRender="policyChangeHistoryTable" status="loader-icon" />
                <apex:actionFunction action="{!policyChangenextPage}" name="policyChangenextPage" reRender="policyChangeHistoryTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.Pol_Policy_Change_History}" id="policyChangeHistoryTable">
                    <apex:pageblockSection >
                        <apex:selectList value="{!selectedpolicyChangeStatus}" multiselect="false" size="1" label="{!$Label.Pol_Status}">
                            <apex:selectOptions value="{!policyChangeStatusList}" />
                            <apex:actionSupport status="loader-icon" event="onchange" action="{!searchPolicyChangebyStatus}" ReRender="policyChangeHistoryTable" />
                        </apex:selectList>
                    </apex:pageblockSection>
                    <apex:pageBlockTable value="{!policyChangeMap[policyChangePage]}" var="c">
                        <apex:column headerValue="{!$Label.Pol_Policy_Change_Request_ID}">{!c.requestID}
                        </apex:column>
                        <!-- Rancho_HKITSFDC193_20250409 - update policy change type label -->
                        <apex:column headerValue="{!$Label.Pol_Policy_Change_Type_Appian}">{!c.workType}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Policy_Change_Sub_Type}">{!c.workItem}
                        </apex:column>
                        <!-- Rancho_HKITSFDC193_20250409 - add work item -->
                        <apex:column headerValue="{!$Label.Pol_Work_Type_EN}">{!c.salesForceWorkType}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Work_Type_TC}">{!c.salesForceWorkTypeTC}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Status}">
                            <!-- Rancho_PI69_20220609 - align the status label with broker portal -->
                            <!-- <apex:outputText value="{! IF(c.requestStatus == 'Processing', 'Work-In-Progress', '')}" />
                            <apex:outputText value="{! IF(c.requestStatus == 'Request Completed', 'Request Completed', '')}" />
                            <apex:outputText value="{! IF(c.requestStatus == 'Processed', 'Request Closed', '')}" />
                            <apex:outputText value="{! IF(c.requestStatus == 'Pending Information', 'Request Terminated', '')}" /> -->
                            <apex:outputText value="{! IF(CONTAINS(c.requestStatus, 'Processing') || CONTAINS(c.requestStatus, 'Pending'), $Label.Processing, (IF(CONTAINS(c.requestStatus, 'Completed') || CONTAINS(c.requestStatus, 'Processed'), $Label.Completed, c.requestStatus)))}" />
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Received_Date}">
                            <apex:outputText value=" {0,date,yyyy/MM/dd}">
                                <apex:param value="{!c.submittedDateTime}" />
                            </apex:outputText>
                        </apex:column>
                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(policyChangeTotalPage>1 && policyChangehasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="policyChangeprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>

                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!policyChangePage}" />
                                    <apex:param value="{!policyChangeTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(policyChangeTotalPage>1 && policyChangehasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="policyChangenextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!-----Policy Change History End---->

        <!----Member List Start---->
        <apex:outputPanel id="memberListPanel">
            <div class="policyDetailPanel" id="memberListPanelDiv">
                <apex:actionFunction action="{!memberprevPage}" name="memberprevPage" reRender="memberListTable" status="loader-icon" />

                <apex:actionFunction action="{!membernextPage}" name="membernextPage" reRender="memberListTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.Pol_Member_List}" id="memberListTable">

                    <div style="overflow-x:scroll;">
                        <apex:pageblockSection >
                            <apex:selectList value="{!selectedMemberBranch}" multiselect="false" size="1" label="{!$Label.Pol_Branch}">
                                <apex:selectOptions value="{!branchList}" />
                                <apex:actionSupport event="onchange" action="{!searchMemberListbybranch}" status="loader-icon" reRender="memberListTable" />
                            </apex:selectList>
                        </apex:pageblockSection>
                        <apex:pageBlockTable value="{!memberMap[memberPage]}" var="m">
                            <apex:column headerValue="{!$Label.Pol_Member_Cert_No}">
                                <a href="javascript:void(0);" onclick="openGroupPolicyCorDocPage('{!policyNumber}','{!m.certificateNo}');">{!m.certificateNo}</a>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Member_Name}">
                                <apex:outputPanel rendered="{!ssnAccountidMap[m.ssnNumber] != '' && ssnAccountidMap[m.ssnNumber] != null}">
                                    <a href="javascript:void(0);" onclick="openCustomerProfilePage('{!ssnAccountidMap[m.ssnNumber]}','{!policyNumber}');">{!m.fullName}</a>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!ssnAccountidMap[m.ssnNumber] == '' || ssnAccountidMap[m.ssnNumber] == null}">
                                    {!m.fullName}
                                </apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Relation}">{!m.insurableInterestReason}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Plan}">{!m.planNumber}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Effective_Date}">
                                <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false">
                                    <apex:param value="{!m.effectiveDate}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Member_Status}">
                                {!m.memberStatusDesc }
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Benefit_Type}">
                                {!m.GroupMedicalBenefitStr }
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Life_Sum_Assured}">
                                <apex:outputText value="{!IF(m.lifeSumAssuredInNumber == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}" escape="false">
                                    <apex:param value="{!m.lifeSumAssuredInNumber}" />
                                </apex:outputText>
                            </apex:column>

                            <apex:column headerValue="{!$Label.Pol_TPD_Sum_Assured}">
                                <apex:outputText value="{!IF(m.TPDSumAssuredInNumber == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}" escape="false">
                                    <apex:param value="{!m.TPDSumAssuredInNumber}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_AD_D_Sum_Assured}">
                                <apex:outputText value="{!IF(m.addSumAssuredInNumber == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}" escape="false">
                                    <apex:param value="{!m.addSumAssuredInNumber}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_LTD_Sum_Assured}">
                                <apex:outputText value="{!IF(m.LTDSumAssuredInNumber == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}" escape="false">
                                    <apex:param value="{!m.LTDSumAssuredInNumber}" />
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_CIB_Sum_Assured}">
                                <apex:outputText value="{!IF(m.CIBSumAssuredInNumber == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}" escape="false">
                                    <apex:param value="{!m.CIBSumAssuredInNumber}" />
                                </apex:outputText>
                            </apex:column>

                            <apex:column headerValue="{!$Label.Pol_Branch}" style="white-space:nowrap;">
                                {!m.branchDesc}
                            </apex:column>

                            <apex:column headerValue="{!$Label.Pol_Plan_Name}">
                                {!m.planName}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_eMedical_Card}">
                                {!m.eMedicalCardType}
                            </apex:column>

                            <!-- Hardcopy Indicator added start-->
                            <apex:column headerValue="{!$Label.Hardcopy_Medical_Card_Indicator}">
                                {!m.medCardIndicator}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Hardcopy_Letter_Indicator}">
                                {!m.letterIndicator}
                            </apex:column>
                            <!-- Hardcopy Indicator added end-->

                        </apex:pageBlockTable>
                    </div>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(memberTotalPage>1 && memberhasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="memberprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>

                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!memberPage}" />
                                    <apex:param value="{!memberTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(memberTotalPage>1 && memberhasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="membernextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Member List End---->

        <!----Premium Settlement Start---->
        <apex:outputPanel id="premiumSettlementPanel">
            <div class="policyDetailPanel" id="premiumSettlementPanelDiv">
                <apex:actionFunction action="{!settlementprevPage}" name="settlementprevPage" reRender="premiumSettlementTable" status="loader-icon" />

                <apex:actionFunction action="{!settlementnextPage}" name="settlementnextPage" reRender="premiumSettlementTable" status="loader-icon" />

                <apex:pageBlock title="{!$Label.Pol_Premium_Settlement}" id="premiumSettlementTable">
                    <apex:pageBlockSection >
                        <apex:selectList value="{!selectedPremiumBranch}" multiselect="false" size="1" label="{!$Label.Pol_Branch}">
                            <apex:selectOptions value="{!branchList}" />
                            <apex:actionSupport event="onchange" action="{!searchPremiumSettlementbybranch}" status="loader-icon" reRender="premiumSettlementTable" />
                        </apex:selectList>
                    </apex:pageBlockSection>
                    <apex:pageBlockTable value="{!settlementMap[settlementPage]}" var="c">
                        <apex:column headerValue="{!$Label.Pol_Invoice_No}">
                            {!c.invoiceNumber}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Issue_Date}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.finActivityDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Invoice_Amount}">
                            <apex:outputText value="{!IF(c.FinActivityGrossAmt == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.FinActivityGrossAmt}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Settled_Amount}">
                            <apex:outputText value="{!IF(c.paymentAmt == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.paymentAmt}" />
                            </apex:outputText>
                        </apex:column>

                        <!-- 20200610 - minghua - levyII -->
                        <!-- <apex:column headerValue="{!transField['Levy']}">
                            <apex:outputText value="{!IF(c.levy == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.levy}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!transField['Levy_Total_Premium_Including_Levy']}">
                            <apex:outputText value="{!IF(c.outstandingLevyIndicator == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.outstandingLevyIndicator}" />
                            </apex:outputText>
                        </apex:column> -->
                        
                        <apex:column headerValue="{!$Label.Pol_Settled_Date}">
                            <apex:OutputText value="{0,date,yyyy/MM/dd}" escape="false">
                                <apex:Param value="{!c.paymentStatusDateInDate}" />
                            </apex:OutputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Unsettle_Balance}">
                            <apex:outputText value="{!IF(c.unsettleBalance == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.unsettleBalance}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Commission_Amount}">
                            <apex:outputText value="{!IF(c.commissionAmt == null ,'',policy.currencySymbol)} {0, Number,###,##0.00}">
                                <apex:param value="{!c.commissionAmt}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Branch}">
                            {!c.branchDesc}
                        </apex:column>

                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(settlementTotalPage>1 && settlementhasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="settlementprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>
                            </td>
                            <td>

                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!settlementPage}" />
                                    <apex:param value="{!settlementTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(settlementTotalPage>1 && settlementhasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="settlementnextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Premium Settlement End---->

        <!----Benefit Schedule Start---->
        <apex:outputPanel id="benefitSchedulePanel">
            <div class="policyDetailPanel" id="benefitSchedulePanelDiv">
                <apex:pageBlock title="{!$Label.Pol_Policy_Information}" mode="detial">
                    <apex:pageBlockSection columns="1">
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header">
                                    {!$Label.Pol_Plan_Type}
                                </div>
                                <div class="column-content">
                                    {!policy.marketingName}
                                </div>
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header">
                                    {!$Label.Pol_Policy_Holder}
                                </div>
                                <div class="column-content">
                                    {!policy.holder.fullName}
                                </div>
                            </div>
                        </div>
                        <div class="policy-detail-policy policy-detail-table">
                            <div class="policy-detail-table-row">
                                <div class="column-header">
                                    {!$Label.Pol_Benefit_Currency}
                                </div>
                                <div class="column-content">
                                    {!policy.currencyCodeDesc}
                                </div>
                            </div>
                        </div>
                    </apex:pageBlockSection>
                </apex:pageBlock>
                <apex:pageBlock id="benefitScheduleDetailPanel">
                    <apex:variable value="{!1}" var="rowNum" />
                    <apex:repeat value="{!userPlanList}" var="key">
                        <div class="planListPanelHeader" style="margin-top:8px">
                            <Label class="block-header">{!key.insurableInterestReason} : {!key.fullName}</Label>
                        </div>
                        <div id="benefit-plan">
                            <!--efulfillment enhanced added start-->
                            <apex:pageBlock rendered="{!targetCertNo!='' && key !=null && groupDocMap[key.certificateNo]!=null}">
                                <apex:pageblockTable id="curGroupDocTable" value="{!groupDocMap[key.certificateNo]}" var="myList">
                                    <apex:column headerValue="Document Name">
                                        <!--<apex:commandLink action="{!getDoc2}" target="_blank">
                                            {!myList.Description}
                                            <apex:param assignTo="{!targetAttachmentKey}" id="targetAttachmentKey" name="targetAttachmentKey" value="{!myList.attachmentKey}" />
                                        </apex:commandLink>-->
                                        <!--Nicole_2019.11.17_Download Efulfillment Document Asynchronous-->
                                      <a onclick="showLoading();PolicyDetailAF.getDoc2('{!myList.attachmentKey}') " style="cursor:pointer">{!myList.Description}</a>
                                    </apex:column>
                                    <apex:column headerValue="Date">
                                        {!myList.createdDateStrDisp}
                                    </apex:column>
                                    <!--Connor CR-47 Hide/Unhide docs start-->
                                    <apex:column headerValue="Action">
                                        <button style="margin-left: 15px;" type="button" onclick="showLoading();PolicyDetailAF.toggleDocState('{!myList.attachmentKey}','{!myList.Description}','GroupDoc')">{!If(myList.status =='Y','Hide','Show')}</button>
                                    </apex:column>
                                    <apex:column headerValue="Doc Hidden Date" style="padding: 5px 2px 4px 5px;">
                                        {!myList.hiddenDateStr}
                                    </apex:column>
                                    <apex:column headerValue="Doc Hidden By" style="padding: 5px 2px 4px 5px;">
                                        {!myList.hiddenBy}
                                    </apex:column>
                                    <!--Connor CR-47 Hide/Unhide docs end-->
                                </apex:pageblockTable>
                            </apex:pageBlock>
                            <!--efulfillment enhanced added end-->
                            <apex:variable value="{!'new'}" var="lastCode" />
                            <!-- <apex:repeat value="{!planMap[targetCertNo]}" var="c">add by Jack on 2022-01-18 for project: UAT issue display only the targetCertNo not all people in list -->
                            <apex:repeat value="{!planMap[key.certificateNo]}" var="c"><!--add by Jack on 2022-01-18 for project: UAT issue display only the targetCertNo not all people in list -->
                                <apex:outputpanel rendered="{!!(c.benefitName == lastCode)}" layout="block" styleClass="titleDiv">
                                    <b>{!c.benefitDesc}</b>
                                </apex:outputpanel>
                                <!--<apex:outputPanel rendered="{!c.benefitItemIdentity != 'Y'}" layout="block" styleClass="subTitleDiv">
                                    <b>{!c.benefitDetailItemDesc}</b>
                                </apex:outputPanel> -->
                                <apex:outputPanel rendered="{!c.benefitItemIdentity != 'Y'}" layout="block" styleClass="subTitleDiv">
                                    <b class="titleLeft">{!c.benefitDetailItemDesc}</b>
                                    <b class="titleRight">
                                        <apex:outputText value="{!if(c.benefitLevelDesc != null && trim(c.benefitLevelDesc) != '',c.benefitLevelDesc, '')}"></apex:outputText>
                                    </b>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!c.benefitItemIdentity == 'Y' && c.isDisplay}">
                                    <span class="content-left">{!c.benefitDetailItemDesc}</span>
                                    <span class="content-right">{!c.BenefitLevelDesc}</span>
                                </apex:outputPanel>
                                <apex:variable value="{!c.benefitName}" var="lastCode" />
                            </apex:repeat>
                        </div>
                        <apex:variable var="rowNum" value="{!rowNum + 1}" />
                    </apex:repeat>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Benefit Schedule End---->

        <!----Remaining Clinic Visits Tab Start---->
        <apex:outputPanel id="remainClinicVisitPanel">
            <div class="policyDetailPanel" id="remainClinicVisitPanelDiv">
                <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                    <div class="bs col-sm-12" style="padding:0;">
                        <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                            <Label class="block-header">{!$Label.Pol_Remaining_Clinic_Visits}</Label>
                        </div>
                    </div>
                </div>
                <div class="policy-detail-policy policy-detail-table">
                    <div class="policy-detail-table-row">
                        <div class="column-header">
                            {!$Label.Pol_Overall_Outpatient_Maximum_No_of_Visits_Per_Policy_Year}
                        </div>
                        <div class="column-content">
                            <apex:outputText value="{!clinicVisitSummary.overallOutpatientMaximumNo}" />
                        </div>
                    </div>
                </div>
                <div class="policy-detail-policy policy-detail-table">
                    <div class="policy-detail-table-row">
                        <div class="column-header">
                            {!$Label.Pol_Total_Visited}
                        </div>
                        <div class="column-content">
                            <apex:outputText value="{!clinicVisitSummary.totalVisitedCount}" />
                        </div>
                    </div>
                </div>
                <div class="policy-detail-policy policy-detail-table">
                    <div class="policy-detail-table-row">
                        <div class="column-header">
                            {!$Label.Pol_Total_Remaining_Visit_Balance}
                        </div>
                        <div class="column-content">
                            <apex:outputText value="{!clinicVisitSummary.totalRemainingVisitBalance}" />
                        </div>
                    </div>
                </div>

                <apex:pageBlock title="{!$Label.Pol_Benefit_Details}" id="remainClinicVisitTable">
                    <apex:actionFunction action="{!benefitprevPage}" name="benefitprevPage" reRender="remainClinicVisitTable" status="loader-icon" />
                    <apex:actionFunction action="{!benefitnextPage}" name="benefitnextPage" reRender="remainClinicVisitTable" status="loader-icon" />

                    <apex:pageBlockTable value="{!benefitMap[benefitPage]}" var="b">
                        <apex:column headerValue="{!$Label.Pol_Benefit_Code}">
                            {!b.benefitDetailItemCode}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Type}">
                            {!b.benefitDetailItemDescription}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Maximum_No_of_Visits_Per_Policy_Year}">
                            {!b.maxNoofVisitPerYear}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Visited}">
                            {!b.visitedCount}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Visit_Balance}">
                            {!b.benefitVisitBalance}
                        </apex:column>

                        <apex:column headerValue="{!$Label.Pol_Benefit_Amount}">
                            {!b.benefitMaxAmt}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Paid_Amount}">
                            {!b.benefitPaidAmt}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Remaining_Balance}">
                            {!b.benefitAmtBalance}
                        </apex:column>

                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(benefitTotalPage>1 && benefithasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="benefitprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>

                            </td>
                            <td>
                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!benefitPage}" />
                                    <apex:param value="{!benefitTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(benefitTotalPage>1 && benefithasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="benefitnextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Remaining Clinic Visits Tab End---->

        <!--Remaining Hospital Visits Tab Start-->
        <apex:outputpanel id="remainingHospitalVisitsPanel" rendered="{!policyType == 'Group'}">
            <div class="policyDetailPanel" id="remainingHospitalVisitsPanelDiv">
                <apex:pageBlock title="{!$Label.Pol_Benefit_Details}" id="remainingHospitalVisitTable">
                    <!-- add by Jack on 2022-01-18 for project: UAT issue can not go to next page -->
                    <apex:actionFunction action="{!HbenefitprevPage}" name="HbenefitprevPage" reRender="remainingHospitalVisitTable" status="loader-icon" />
                    <apex:actionFunction action="{!HbenefitnextPage}" name="HbenefitnextPage" reRender="remainingHospitalVisitTable" status="loader-icon" />
                    <apex:pageBlockTable value="{!HbenefitMap[HbenefitPage]}" var="b">
                        <apex:column headerValue="{!$Label.Pol_Benefit_Code}">
                            {!b.benefitDetailItemCode}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Type}">
                            {!b.benefitDetailItemDescription}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Maximum_No_of_Visits_Per_Policy_Year}">
                            {!b.maxNoofVisitPerYear}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Visited}">
                            {!b.visitedCount}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Visit_Balance}">
                            {!b.benefitVisitBalance}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Benefit_Amount}">
                            {!b.benefitMaxAmt}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Paid_Amount}">
                            {!b.benefitPaidAmt}
                        </apex:column>
                        <apex:column headerValue="{!$Label.Pol_Remaining_Balance}">
                            {!b.benefitAmtBalance}
                        </apex:column>
                    </apex:pageBlockTable>
                    <table align="right" cellspacing="10">
                        <tr>
                            <td>
                                <apex:outputText rendered="{!If(HbenefitTotalPage>1 && HbenefithasPrev,true,false)}">
                                    <a href="javascript:void(0);" onclick="HbenefitprevPage();">&lt;&lt; Previous Page</a>
                                    <span>|</span>
                                </apex:outputText>

                            </td>
                            <td>
                                <apex:outputText value=" {!$Label.Page_0_of_1}">
                                    <apex:param value="{!HbenefitPage}" />
                                    <apex:param value="{!HbenefitTotalPage}" />
                                </apex:outputText>
                            </td>
                            <td>
                                <apex:outputText rendered="{!If(HbenefitTotalPage>1 && HbenefithasNext,true,false)}">
                                    <span>|</span>
                                    <a href="javascript:void(0);" onclick="HbenefitnextPage();">Next Page &gt;&gt;</a>
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:pageBlock>
            </div>
        </apex:outputpanel>
        <!--Remaining Hospital Visits Tabl End-->
        
        
        <!--Fund/Bonus Details Tab Start-->
        <apex:outputPanel id="FundBonusPanelDiv">
            <div class="policyDetailPanel" id="FundBonusPanelDiv">
                <apex:pageBlock title="Fund / Bonus Details" >
                    <apex:outputPanel styleClass="FundBonusPanel" layout="block" rendered="{!hasFundDetial}">
                        <div class="FundBonusPanel-row">
                            <div class="FundBonusPanel-label">
                               1.{!$Label.Total_Cash_Value}
                            </div>
                            <apex:outputPanel styleClass="FundBonusPanel-value">
                                :
                                <apex:outputText value="{!policyFundList[0].totalCashValue}" rendered="{!policyFundList !=null && policyFundList.size>0}" styleClass="value">
                                </apex:outputText>
                            </apex:outputPanel>
                        </div>
                        <div class="FundBonusPanel-row">
                            <div class="FundBonusPanel-label">
                                2.{!$Label.Surrender_Value}
                            </div>
                            <apex:outputPanel styleClass="FundBonusPanel-value">
                                :
                                <apex:outputText value="{!policyFundList[0].surrenderChargeAmt}" rendered="{!policyFundList !=null && policyFundList.size>0}" styleClass="value">
                                </apex:outputText>
                            </apex:outputPanel>
                        </div>
                        <div class="FundBonusPanel-row">
                            <div class="FundBonusPanel-label">
                                3.{!$Label.Pol_Currency}
                            </div>
                            <apex:outputPanel styleClass="FundBonusPanel-value">
                                 : 
                                <apex:outputText rendered="{!policyFundList !=null && policyFundList.size>0}" value="{!policyFundList[0].currencyType}" styleClass="value"></apex:outputText>                     
                            </apex:outputPanel>
                        </div>
                        <div class="FundBonusPanel-row">
                            <div class="FundBonusPanel-label">
                                4.{!$Label.Total_Declared_Bonus}
                            </div>
                            <apex:outputPanel styleClass="FundBonusPanel-value">
                                :
                                <apex:outputText value="{!policyFundList[0].TotalDeclaredBonus}" rendered="{!policyFundList !=null && policyFundList.size>0}" styleClass="value">
                                </apex:outputText>
                            </apex:outputPanel>
                        </div>
                        <apex:pageBlockTable value="{!policyFundList[0].bonusTransactionList}" var="pf" styleClass="FundBonusPanel-table">
                            <apex:column headerValue="{!$Label.Pol_Tran_Date}">
                                {!pf.transDate}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Currency}">
                                {!pf.currencyType}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Amount}">
                                {!pf.amount}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_ACCT}">
                                {!pf.acct}
                            </apex:column>
                            <apex:column headerValue="{!$Label.Pol_Description}">
                                {!pf.description}
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!!hasFundDetial}" layout="block">There is no Fund / Bonus Detail for this policy</apex:outputPanel>
                </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!--Fund/Bonus Details Tab End-->

        <!----Policy replacement Tab Start---->                
        <apex:outputPanel id="policyReplacementPanel">
                <apex:actionFunction action="{!replacementprevPage}" name="replacementprevPage" reRender="ReplacementInfomationTable" status="loader-icon" />

            <apex:actionFunction action="{!replacementnextPage}" name="replacementnextPage" reRender="ReplacementInfomationTable" status="loader-icon" />
                
            <div class="policyDetailPanel" id="policyReplacementPanelDiv">
                <div id="policy-detail-summary-div" class="bs col-sm-12 policy-detail-summary" style="padding:0;">
                    <div class="bs col-sm-12" style="padding:0;">
                        <div class="bs col-sm-2" style="padding:10px 0 0 0;">
                            <Label class="block-header">{!transField['Policy_Replacement']}</Label>
                        </div>
                    </div>
                </div>
                <div class="policy-detail-policy policy-detail-table">
                    <div class="policy-detail-table-row">
                        <div class="column-header-two">
                            {!transField['Application_Date']}
                        </div>
                        <div class="column-content-two">
                            <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                <apex:Param value="{!policyReplacement.applicationDate}" />
                            </apex:outputText>                            
                        </div>
                    
                        <div class="column-header-two">
                            {!transField['Policy_Replacement_effective_Date']}
                        </div>
                        <div class="column-content-two">
                            <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                <apex:Param value="{!policyReplacement.policyReplacementEffectiveDate}" />
                            </apex:outputText>     
                        </div>
                    </div>
                </div>
                <div class="policy-detail-policy policy-detail-table">
                    <div class="policy-detail-table-row">
                        <div class="column-header-two">
                            {!transField['IFS_PR_Notification_Date']}
                        </div>
                        <div class="column-content-two">
                            <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                <apex:Param value="{!policyReplacement.notificationDate}" />
                            </apex:outputText>  
                        </div>
                    
                        <div class="column-header-two">
                            {!transField['IFS_PR_Reply_Date_from_Customer']}
                        </div>
                        <div class="column-content-two">
                            <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                <apex:Param value="{!policyReplacement.acknowledgementDate}" />
                            </apex:outputText>  
                        </div>
                    </div>
                </div>

                <apex:pageBlock title="{!transField['Replacement_Infomation']}" id="ReplacementInfomationTable">

                    <apex:pageBlockTable value="{!replacementMap[replacementPage]}" var="replacement">
                            <apex:column headerValue="{!transField['Replacement_Policy_Number']}">
                                {!replacement.replacementPolicyNumber}
                            </apex:column>
                            <apex:column headerValue="{!transField['Product_Code']}">
                                {!replacement.productCode}
                            </apex:column>
                            <apex:column headerValue="{!transField['Source_System']}">
                                {!replacement.sourceSystem}
                            </apex:column>
                            <apex:column headerValue="{!transField['Change_Date']}">    
                                <apex:outputText value="{0,date,yyyy/MM/dd}" escape="false" >
                                    <apex:Param value="{!replacement.changeDate}" />
                                </apex:outputText>  
                            </apex:column>
                            <apex:column headerValue="{!transField['Short_Code']}">
                                {!replacement.shortCode}
                            </apex:column>
                            <apex:column headerValue="{!transField['Details']}">
                                {!replacement.details}
                            </apex:column>
                    </apex:pageBlockTable>
                <table align="right" cellspacing="10">
                    <tr>
                        <td>
                            <apex:outputText rendered="{!If(replacementTotalPage<=1 || !replacementhasPrev,false,true)}">
                                <a href="javascript:void(0);" onclick="replacementprevPage();">&lt;&lt; Previous Page</a>
                                <span>|</span>
                            </apex:outputText>
                        </td>
                        <td>
                            <apex:outputText value=" {!$Label.Page_0_of_1}">
                                <apex:param value="{!replacementPage}" />
                                <apex:param value="{!replacementTotalPage}" />
                            </apex:outputText>
                        </td>
                        <td>
                            <apex:outputText rendered="{!If(replacementTotalPage>1 && replacementhasNext,true,false)}">
                                <span>|</span>
                                <a href="javascript:void(0);" onclick="replacementnextPage();">Next Page &gt;&gt;</a>
                            </apex:outputText>
                        </td>
                    </tr>
                </table>
                    </apex:pageBlock>
            </div>
        </apex:outputPanel>
        <!----Policy replacement Tab end---->
        
        <!-- TM UwMessage Tab Start -->
        <apex:outputPanel >
            <div id="UwMessagePanelDiv" class="policyDetailPanel">
                <apex:inputHidden id="fileURL" value="{!docURL}"/>
        
                <apex:pageBlock id="MessageList">
                    <apex:commandButton value="Create" onclick="openCreateTab()" style="margin-left:30%;margin-bottom:8px" oncomplete="refreshTab()" rendered="{!canCreateMessage}"></apex:commandButton>
                    <apex:commandButton value="Refresh" onclick="showLoading();refreshTab()" oncomplete="finishLoading();" style="margin-left:5%;margin-bottom:8px"></apex:commandButton>
                    
                    <apex:pageBlockTable value="{!messageList}" var="item">
                        <apex:column headerValue="Date & Time">
                            <apex:outputText value="{!item.createDate}">
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="Message">
                            <div class="onclick-pointer block-header_link" style="text-decoration:underline">
                                <apex:repeat value="{!item.contentList}" var="con">
                                    <apex:commandLink value="{!con}" reRender="attachments" action="{!showAttachments}">
                                        <apex:param name="showAttachment" value="{!item.messageID}" assignTo="{!messageID}" />
                                    </apex:commandLink>
                                    <br></br>
                                    <!--  <a href="javascript:void(0);" onclick="refreshAttachment('{!item}')">{!item.content}</a>  -->
                                </apex:repeat>
                            </div>
                        </apex:column>
                        <apex:column headerValue="Commenter">
                            <apex:outputText value="{!item.commenter}"></apex:outputText>
                        </apex:column>
                        <apex:column headerValue="Seen">
                            <apex:outputPanel rendered="{!item.isSeen}">
                                <img width="21" height="16" title="Checked" alt="Checked" src="/img/checkbox_checked.gif" />
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!!item.isSeen}">
                                <img width="21" height="16" title="Checked" alt="Checked" src="/img/checkbox_unchecked.gif" />
                            </apex:outputPanel>
                        </apex:column>
                    </apex:pageBlockTable>
                    <!-- Attachment -->
                    <div id="attList">
                        <p style="margin:12px 4px 4px 4px"><b>Attachment</b></p>
                        <apex:pageBlockTable value="{!attachments}" var="a" id="attachments">
                            <apex:column headerValue="Date & Time">
                                <apex:outputLabel value="{!a.CreatedDate}" />
                            </apex:column>
                            <apex:column headerValue="Document Name">
                                <a href="javascript:void(0);" onclick="downloadFile('{!a.documentId}');return false">{!a.fileName}</a>
                            </apex:column>
                        </apex:pageBlockTable>
                    </div>
                    <apex:input value="{!TrackingId}" style="display:none" styleClass="trackingId" />
                </apex:pageBlock>
                <apex:actionFunction action="{!clickSeen}" name="clickCheckBoxs" reRender="MessageList" />
            </div>
        </apex:outputPanel>
        <!--  TM UWMessage Tab End -->
    </apex:form>
    
    <!-- Added for async download by Connor start -->
    <div id="download-loader" style="display:none;"> 
        <div style="position:fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 1000; background-color: black;">
             
        </div>
        <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 50%">
            <div style="display: inline-block; padding: 2px; background-color: #fff; width: 125px;">
                <img src="/img/loading.gif" style="float: left; margin: 8px;" />
                <span style="display: inline-block; padding: 10px 0px;">Loading...</span>
            </div>
        </div>
    </div>
    <!-- Added for async download by Connor end -->
</apex:page>