<!--Please change apex page title-->
<apex:page docType="html-5.0" sidebar="false" showHeader="false" Controller="FundManagementController" title="Fund Management">
<head>  
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"/> 
    <!-- 20200306 - minghua - ILAS -->
    <apex:include pageName="ILASPopup" /> 
    <apex:include pageName="ClaimUtilJS"/>

    <style>
         
        @media 
        only screen and (max-width: 760px),
        (min-device-width: 768px) and (max-device-width: 1024px)  {
        
           .nav-pills:active{
            color: #fff !important;
            background-color: #2E2E2E !important;   
           }
    
            .myTitle
            {
              font-weight: bold;  
            }
            .myTable
            {
                border-top:0px !important;
            }
            .bs .nav-pills>li.active>a, .bs .nav-pills>li.active>a:focus, .bs .nav-pills>li.active>a:hover {
              color: #FFF !important;
              background-color: #2E2E2E !important;
            }
            .bs .nav-pills>li>a:hover {
              color: #FFF !important;
              background-color: #BDBDBD !important;
            }
            .bs .nav-pills>li>a{
              color: #2E2E2E !important;
              background-color: #FFF !important;
            }
    
        }
        
        @media (min-width: 768px) { 
            /** TO BE DELETED */
            .fundName {
                height: 52px;
            }
            
            .withdrawTablePlanName {
                height: 38px;
            }
        }
         
        @media (max-width: 767px) {
            body {
                padding-top: 50px;
            }
            
            div#reallocationSpecialBoxFM {
                display: none;
                position: absolute;
                z-index: 11;
                margin: 100px auto 0px auto;
                width: 90%;
                height: 60%;
                background: #FFF;
                color: #000;
                left: 5%;
                padding: 20px;
                border-radius: 5px;
             }
        }
        @media (min-width: 768px) {
            body {
                padding-top: 50px;
            }
            
            div#reallocationSpecialBoxFM {
                display: none;
                position: absolute;
                z-index: 11;
                margin: 150px auto 0px auto;
                width: 80%;
                height: 60%;
                background: #FFF;
                color: #000;
                left: 10%;
                padding:20px;
                border-radius:5px;
              }
        }
       
        div#reallocationOverlayFM {
            display: none;
            z-index: 10;
            background: #D9D9D6;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            text-align: center;
          }

          #reallocationCloseOverlayFM {
            position: absolute;
            top: 10px;
            right: 10px;
          }
        
          #reallocationtccontentFM {
            padding:10px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 95%;
            overflow-y:auto;
          } 
          
          #esignaturetccontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 90%;
            overflow-y:auto;
          } 
        
          #PICcontent {
            padding:5px;
            color:#000;
            font-size:12px;
            width: 100%;
            height: 85%;
            overflow-y:auto;
          } 
          
          .content-active {
            color:#39B54A;
          }
          
          .fundTable th {
              //font-size:12px;
              padding-bottom:3px !important;
          }
          
          .fundTable td {
              font-family: "Gotham SSm A", "Gotham SSm B", "Microsoft Jhenghei", "LiHei Pro", "Heiti TC", Arial, Helvetica, sans-serif !important;
              padding-top:0 !important;
              padding-bottom:0 !important;
          }
          
          .switchInTable td {
              font-size:14px;
              padding-bottom:3px !important;
              vertical-align: middle !important;
          }
          
          input.amountInputCenter {
              text-align: center;
          }
          
          .fontSize12 {
              font-size:12px;
          }
          
          .fontSize14 {
              font-size:14px;
          }
          
          div.errorDiv {
          }
          
          label.error {
              //font-size:11px;
              font-size:14px;
          }
          
          label.cusError {
              font-size:14px;
              color: red;
          }
          
          .fontWeightNormal label{
              font-weight: normal;
          }
          
          .wrapErrorRow label.error {
               white-space: pre-wrap;      /* CSS3 */   
               white-space: -moz-pre-wrap; /* Firefox */    
               white-space: -pre-wrap;     /* before Opera 7 */   
               white-space: -o-pre-wrap;   /* Opera 7 */    
               word-wrap: break-word;      /* IE */
          }
          
          .wrapErrorRow th {
               vertical-align: top !important;
          }
          
          .grey-bottom {
              border-bottom:2px solid #f2f2f2;
          }
          
          .form-field-text-style {
                height: 34px;
                padding: 6px 12px;
                line-height: 1.42857143 !important;
           }
           
           .cigna-fg-gray-light{
               color: #D9D9D6 !important;
           }

          
          /*
            .bs input[type="checkbox"].cigna-question-checkbox-single {
                display: none;
            }
            
            .bs input[type="checkbox"].cigna-question-checkbox-single ~ label {
                cursor: pointer;
            }
            .bs input[type="checkbox"].cigna-question-checkbox-single + label:before {
                font: normal normal normal 14px/1 FontAwesome;
                display: inline-block;
                content: "\f058";
                height: 20px;
                margin: 0 .25em 0 0;
                padding: 0;
                vertical-align: top;
                width: 20px;
                color: #C8C9C7;
                font-size: 1.2em;
            }
            .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
                color: #39B54A;
                font: normal normal normal 14px/1 FontAwesome;
                content: "\f058";
                font-size: 1.2em;
            }
            .bs input[type="checkbox"].cigna-question-checkbox-single:checked + label:before {
                font-weight: bold;
            }
          
            
            .bs .form-field-style-select {
                  border:0px;
                  border-bottom:1px solid #58595B;
                  //background: transparent;
                  //background-color: #FFFFFF;
                  
                  /* select list arrow without static resource */
                  //background: url(data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy
                  //53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0Ljk1IDEwIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6IzQ0NDt
                  //9PC9zdHlsZT48L2RlZnM+PHRpdGxlPmFycm93czwvdGl0bGU+PHJlY3QgY2xhc3M9ImNscy0xIiB3aWR0aD0iNC45NSIgaGVpZ2h0PSIxMCIvPjxwb2x5
                  //Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxLjQxIDQuNjcgMi40OCAzLjE4IDMuNTQgNC42NyAxLjQxIDQuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzL
                  //TIiIHBvaW50cz0iMy41NCA1LjMzIDIuNDggNi44MiAxLjQxIDUuMzMgMy41NCA1LjMzIi8+PC9zdmc+) no-repeat 98% 50%;
                  
                  background: url('{!$Resource.select_arrow_style}') no-repeat 98% 50%;
                  background-size: 7px 7px;
                  padding-right:20px;
                  -moz-appearance: none; 
                  -webkit-appearance: none; 
                  appearance: none;
                  width: 100%;
                  //box-shadow: none !important;
                  border-radius: 0px;
                  //color: #58595B;
                  height:30px !important;
                  //outline: none;
                  //-webkit-box-shadow: none;
                  //-moz-box-shadow: none;
                  //box-shadow: none;
                  //appearance:none;
                  //-moz-appearance:none; /* Firefox */
                  //-webkit-appearance:none; /* Safari and Chrome */
                  
            }
            */
            
            /* E-Signature */
            /*
            .bs .cigna-form-section-header {
                background: #eee;
                padding-top: 20px;
                padding-bottom: 20px;
                margin-bottom: 15px;
            }
            
            .signature-pad {
                width: 95%;
                height: 350px;
                background-color: #fff;
            }
            
            .signature-pad-body {
                width: 100%;
                height: 300px;
                border: 1px solid #ddd;
            }
            
            .signature-canvas {
                width: 100%;
                height: 100%;
            }
            
            .signature-pad-footer {
                width: 100%;
                height: 40px;
                padding-top: 10px;
            }
            */   
            /*CR-56_Link_20220214*/
            .ui-tooltip {
                background: black !important;
                max-width: 250px !important;
                width: 250px; 
                min-width: 100px;
                color: white !important;
                z-index: 1070;
                display: block;
                text-align: center !important;
                font-size: 12px !important;
                border-radius: 5px !important;
            }  
    </style>
    <apex:define name="additionalLibraries">
         <!--additional css, bootstrap, jquery,js libraries-->
         <!-- <apex:includeScript value="{!URLFOR($Resource.signature_pad_1_5)}" /> -->
         <!-- CR-56_Link_20220214 -->
         <script type="text/javascript" src="{!URLFOR($Resource.jQuery_Validation, 'jquery.validate_new.min.js')}"/>
         <script type="text/javascript" src="{!URLFOR($Resource.jQuery_Validation, 'additional-methods.min.js')}" />
         <apex:outputPanel rendered="{!userLanguage == 'zh_TW'}" layout="none">
             <script type="text/javascript" src="{!URLFOR($Resource.jQuery_Validation, '/localization/messages_zh_TW.min.js')}" />
         </apex:outputPanel>
         
         <apex:stylesheet value="{!URLFOR($Resource.Cigna_HK_Icons, 'Cigna-HK-Icons.css')}"/>
    </apex:define>
        
    <!--for upload attachement-->
    <script type="text/javascript">
        var __sfdcSessionId = '{!GETSESSIONID()}';
        var filesToUpload = '';  
        var uploadedFile = 0;
    </script>
    
    <script src="/soap/ajax/32.0/connection.js" type="text/javascript"></script>
    
    
    <script>
        var reallocationLoaded = false;
        var withdrawLoaded = false;
        var switchShowNext = true;
        var reallocationShowNext = true;
        var withdrawShowNext = true;
        
        var fromWithdraw = false;
        var sendEmailToCustomer = false;
        function setFocusOnLoad() {};
        
        // 20200306 - minghua - ILAS
        var detailsToShow;
        var warningMessageToShow;
        var checkReasonToShow;
        var reasonMessageToShow;
        var privodeReasonMesToShow;
        var loadOldPolicy = false;
        function onlineRPQ(){
          Cigna.Util.navigateToVFP('RPQSubmitVFP?ss={!customerUserId}&nn={!JSINHTMLENCODE(policyHolderSSNEncrypt)}', null, null, true);
        }
        function checkRPQStatus(){
          var showRPQOnlinePanel = $('#showRPQOnlinePanel').val();
          console.log('showRPQOnlinePanel:' + showRPQOnlinePanel );
          if (showRPQOnlinePanel == 'true') {
            $('#fund-risk-choose').hide();
            $('#secondStepback').hide();
            warningMessageToShow.fadeIn();
          }else{
            //show 
          }
        }
        function provideReason(){
          var provideReason = document.getElementById('provideReason');
          if (provideReason.style.display == 'none') {
            clearErrorAllMes();
            privodeReasonMesToShow.show();
          }
        }

        $(document).ready(function(){      
            
            if (Cigna.Util.isCustomerPortal()){
                sforce.connection.serverUrl = "{!$Site.Prefix}/services/Soap/u/32.0";
            }
            
            
            //loadAvailFundListForReallocation('B');
           
           //document.getElementById("AdditionalRegular").style.display="none";
            // 20200306 - minghua - ILAS
            loadOldPolicy = {!showOldPolicy};
            var loadSelectedTab = '{!selectedTab}';
            console.log('loadOldPolicy:'+loadOldPolicy);
            console.log('loadSelectedTab:'+loadSelectedTab);
            if (loadOldPolicy){
              if (loadSelectedTab == 'Reallocation') {
                selectTab($('#Reallocation'));
                displayList(loadSelectedTab);
                loadOldFundReallocation();
              }else if (loadSelectedTab == 'Switching') {
                displayList(loadSelectedTab);
                loadOldFundSwitch();
              }
              console.log('display old request policy');
            }else{
              loadAvailFundList('B'); // init availFundOptions
              displayList('Switching');
            }

            // displayList(loadSelectedTab);

            if (Cigna.Util.isBrokerPortal()) {
                $('#firstbtnsm').text('{!$Label.Next}');    
                $('#firstbtnxstext').text('{!$Label.Next}');   
                $('#brkfirstbtnxstext').text('{!$Label.Next}');   
                $('#confirmbtnsm').text('{!$Label.Return_to_My_Portfolio}');    
                $('#confirmbtnxstext').text('{!$Label.Return_to_My_Portfolio}'); 
                $('#brkconfirmbtnxstext').text('{!$Label.Return_to_My_Portfolio}');
                   
            }
            else if (Cigna.Util.isCustomerPortal()) {
                $('#firstbtnsm').text('{!$Label.Submit}');  
                $('#firstbtnxstext').text('{!$Label.Submit}');  
                $('#confirmbtnsm').text('{!$Label.Return_to_My_Policy}');    
                $('#confirmbtnxstext').text('{!$Label.Return_to_My_Policy}');
            }

            window.nextStep = function (goStep){

                console.log('sendEmailToCustomer:'+sendEmailToCustomer);
                console.log('Entering nextStep');
                var currentStepNum = $('.content-step:visible').data('step');
                
                var nextStepNum = currentStepNum + 1;
                
                if(goStep != null){
                   nextStepNum = goStep;                  
                }
                
                //SubmitFiledValidation();
                
                console.log('fromWithdraw: ' + fromWithdraw);
                
                if(fromWithdraw && goStep==3){
                    

                    console.log('Entering from withdraw to e-signature: ');
                    $('.content-step:visible').fadeOut(function(){
                        if(Cigna.Util.isCustomerPortal()){
                          $('#firstStepDiv').fadeOut();
                          $('#firstStepSubmitDiv').fadeOut();
                        } else {
                          $('#firstStepSubmitDiv').fadeOut();
                          $('#firstStepDiv').fadeOut();
                          $('#brkfirstStepSubmitDiv').fadeOut();
                        }

                        $('.content-step[data-step="' + nextStepNum + '"]').fadeIn();
                        refreshEsignature();
                    });
                    return;
                }
                
                console.log('nextStep: ' + nextStepNum );
                <!-- validation -->
                if (currentStepNum == '1'){

                  // 20200306 - minghua - ILAS
                  if (loadOldPolicy) {
                    $("#dm-consent-Switching").attr("checked",true);
                    $("#dm-consent-Reallocation").attr("checked",true);
                  }

                  if (jQueryValidate() && additionalValidate()){
                      clearErrorMes();
                      //Cigna.Util.navigateToVFP('PolicyChangeSubmitVFP', null, null, true);
                      
                      //rerenderConfirmation();
                      if($('#cusSwitching').is(":visible")){
                          fromWithdraw = false;
                          detailsToShow = $('#fund-switch-details-confirmation');

                          // 20200306 - minghua - ILAS
                          warningMessageToShow = $('#fund-show-warning-message');
                          checkReasonToShow = $('#fund-switch-checkReason');
                          reasonMessageToShow = $('textarea[id$=switchReasonMessage]');
                          privodeReasonMesToShow = $('#provideReason');
                      }
                      else if ($('#cusReallocation').is(":visible")){
                          fromWithdraw = false;
                          detailsToShow = $('#fund-reallocation-details-confirmation');

                          // 20200306 - minghua - ILAS
                          warningMessageToShow = $('#fund-show-warning-message');
                          checkReasonToShow = $('#fund-switch-checkReason');
                          reasonMessageToShow = $('textarea[id$=switchReasonMessage]');
                          privodeReasonMesToShow = $('#provideReason');
                      }
                      else if ($('#cusWithdrawal').is(":visible")){
                          //nextStepNum++;
                          fromWithdraw = true;
                          //detailsToShow = $('#fund-withdrawal-details-confirmation');
                          //$('#detailsconfirmbtnsm').hide();
                          //$('#detailsconfirmbtnxs').hide();
                          if (nextStepNum == 2){
                              if(Cigna.Util.isCustomerPortal()){
                                saveWithdrawalRequest();
                              } else {
                                nextStep(3);
                              }
                              return;
                          }
                      }
                      /*
                      if (Cigna.Util.isCustomerPortal()) {
                          nextStepNum++;
                      }
                      */
                  }
                  else{
                      return;
                  }
                }
                
                if ($('.content-step[data-step="' + nextStepNum + '"]').length > 0) {
                    $('.content-step:visible').fadeOut(function(){
                        $('.content-step[data-step="' + nextStepNum + '"]').fadeIn();
                        if (nextStepNum == '2'){
                            if(Cigna.Util.isCustomerPortal()){
                              $('#secondStepDiv').fadeIn();
                              $('#firstStepDiv').fadeOut();
                              $('#firstStepSubmitDiv').fadeOut();
                            } else {
                              $('#brksecondStepDiv').fadeIn();
                              $('#brkfirstStepSubmitDiv').fadeOut();
                              $('#firstStepSubmitDiv').fadeOut();
                              $('#firstStepDiv').fadeOut();
                            }
                            
                            detailsToShow.fadeIn();

                            // 20200306 - minghua - ILAS
                            if (Cigna.Util.isCustomerPortal()){
                              var showRPQOnlinePanel = $('#showRPQOnlinePanel').val();
                              console.log('showRPQOnlinePanel:' + showRPQOnlinePanel );
                              if (showRPQOnlinePanel == 'true'){
                                warningMessageToShow.fadeIn();
                                var fundreasonCheckbox = $('input[type=hidden][id$=fund-reasonCheckbox]').val();
                                if (fundreasonCheckbox == 'true') {
                                  $("#fund-switch-checkReason").attr("checked",true);
                                }
                                var fundReasonContent = $('input[type=hidden][id$=fund-ReasonContent]').val();
                                if (fundReasonContent != undefined && fundReasonContent != null && fundReasonContent != '') {
                                  $('textarea[id$=switchReasonMessage]').val(fundReasonContent);
                                  $('#provideReason').fadeIn();
                                }

                              }
                            }
                            $('#detailsconfirmbtndiv').show();
                        }
                        if (nextStepNum == '3'){
                            console.log('Before refresh e-signature');
                            if(Cigna.Util.isCustomerPortal()){
                              $('#secondStepDiv').fadeOut();
                            } else {
                              $('#brksecondStepDiv').fadeOut();
                            }
                            refreshEsignature();
                        }

                        if(nextStepNum == '4'){
                          if(Cigna.Util.isCustomerPortal()){
                            $('#finalStepDiv').fadeIn();
                          } else {
                            $('#brkfinalStepDiv').fadeIn();
                            $('#mobile-submit').fadeOut();
                            $('#mobile-sendEmail').fadeOut();
                          }

                          if(sendEmailToCustomer){
                            $('#submitESig').hide();
                            $('#sendESig').show();
                          }
                        }
                    });
                }
            }   
            
            window.previousStep = function(goStep){
                var currentStepNum = $('.content-step:visible').data('step');
                var previousStepNum = currentStepNum - 1;
                
                if(goStep != null){
                   previousStepNum = goStep;                  
                } 
                
                console.log('fromWithdraw:'+fromWithdraw);
                console.log('currentStepNum:'+currentStepNum);
                
                if (currentStepNum > 1){
                
                    if ($('.content-step[data-step="' + previousStepNum + '"]').length > 0) {
                        $('.content-step:visible').fadeOut(function(){
                            if (currentStepNum == '2'){
                                detailsToShow.fadeOut();
                                if(Cigna.Util.isCustomerPortal()){
                                  $('#secondStepDiv').fadeOut();
                                  $('#firstStepDiv').fadeIn();
                                  $('#firstStepSubmitDiv').fadeIn();
                                } else {
                                  $('#brksecondStepDiv').fadeOut();
                                  $('#brkfirstStepSubmitDiv').fadeIn();
                                  $('#firstStepSubmitDiv').fadeIn();
                                }

                            } else if(fromWithdraw && currentStepNum == '3'){
                                previousStepNum = 1;
                                if(Cigna.Util.isCustomerPortal()){
                                  $('#firstStepDiv').fadeIn();
                                  $('#firstStepSubmitDiv').fadeIn();
                                } else {
                                  $('#firstStepSubmitDiv').fadeIn();
                                  $('#brkfirstStepSubmitDiv').fadeIn();
                                }
                            } else if(previousStepNum == '1' && currentStepNum == '3'){ //20200306 - minghua - ILAS
                              if(!Cigna.Util.isCustomerPortal()){
                                $('#brksecondStepDiv').fadeOut();
                                $('#brkfirstStepSubmitDiv').fadeIn();
                                $('#firstStepSubmitDiv').fadeIn();
                              }
                            }else {
                                if(Cigna.Util.isCustomerPortal()){
                                  $('#secondStepDiv').fadeIn();
                                } else {
                                  $('#brksecondStepDiv').fadeIn();
                                }
                            }
                            console.log('previousStepNum:'+previousStepNum);
                            $('.content-step[data-step="' + previousStepNum + '"]').fadeIn();
                        });
                    } 
                } 
                else {
                    Cigna.Util.navigateToVFP('PolicyDetailsPageVFP?policyNumber={!JSINHTMLENCODE(policyNumber)}&policyType=ILAS&SHA256Key={!SHA256Key}', null, null, true)
                }                                    
            }    
            
            
        }); 
        
        var activeTab = 'Switching';
        
        function displayList(status){
            if(status=='Switching'){
                activeTab = 'Switching';

                document.getElementById('cusSwitching').style.display = "block";
                displayTCNext(switchShowNext);
                document.getElementById('cusReallocation').style.display = "none";
                document.getElementById('cusWithdrawal').style.display="none";
                //document.getElementById('BrkallList').style.display = "block";
                //document.getElementById('BrkinprogressList').style.display = "none";
                //document.getElementById('BrkcompletedList').style.display="none";
                
                    document.getElementById('Accept-TC-Switching').style.display = "block";
                    document.getElementById('Accept-TC-Reallocation').style.display = "none";
                    document.getElementById('Accept-TC-Withdrawal').style.display = "none";
                
                $("[id$='selectedTab']").val('Switching');
            }
            
            if(status=='Reallocation'){
                activeTab = 'Reallocation';
                if (!reallocationLoaded && !loadOldPolicy){ //20200306 - minghua - ILAS
                    loadAvailFundListForReallocation('B');
                    reallocationLoaded = true;
                }
                document.getElementById('cusSwitching').style.display = "none";
                document.getElementById('cusReallocation').style.display = "block";
                displayTCNext(reallocationShowNext);
                document.getElementById('cusWithdrawal').style.display="none";
                //document.getElementById('BrkallList').style.display = "none";
                //document.getElementById('BrkinprogressList').style.display = "block";
                //document.getElementById('BrkcompletedList').style.display="none";
                
                    document.getElementById('Accept-TC-Switching').style.display = "none";
                    document.getElementById('Accept-TC-Reallocation').style.display = "block";
                    document.getElementById('Accept-TC-Withdrawal').style.display = "none";
                
                $("[id$='selectedTab']").val('Reallocation');
            }
            
            if(status=='Withdrawal'){
                activeTab = 'Withdrawal';
                if (!withdrawLoaded ){
                    loadMaximumForWithdraw();
                    withdrawLoaded = true;
                }
                
                document.getElementById('cusSwitching').style.display = "none";
                document.getElementById('cusReallocation').style.display = "none";
                document.getElementById('cusWithdrawal').style.display="block";
                displayTCNext(withdrawShowNext);
                //document.getElementById('BrkallList').style.display = "none";
                //document.getElementById('BrkinprogressList').style.display = "none";
                //document.getElementById('BrkcompletedList').style.display="block";
                
                    document.getElementById('Accept-TC-Switching').style.display = "none";
                    document.getElementById('Accept-TC-Reallocation').style.display = "none";
                    document.getElementById('Accept-TC-Withdrawal').style.display = "block";
               
                $("[id$='selectedTab']").val('Withdrawal');
            }
        
        }
        
        function displayTCNext(show){
            if (show){
                $('#acceptTCDiv').show();
                if(Cigna.Util.isCustomerPortal()){
                    $('#firstStepSubmitDiv').show();
                    $('#firstStepDiv').show();
                } else {
                    $('#firstStepSubmitDiv').show();
                    $('#brkfirstStepSubmitDiv').show();
                }
            }
            else{
                $('#acceptTCDiv').hide();
                if(Cigna.Util.isCustomerPortal()){
                    $('#firstStepSubmitDiv').hide();
                } else {
                    $('#firstStepSubmitDiv').hide();
                    $('#brkfirstStepSubmitDiv').hide();
                }
            }
        }
        
        function selectTab(item){
              $(item).siblings().removeClass('active-bar-tab');
              $(item).siblings().addClass('inactive-bar-tab');
              $(item).removeClass('inactive-bar-tab');
              $(item).addClass('active-bar-tab');
        }
        
        function selectedSingle(item){
             $(item).siblings().removeClass('cigna-fg-blue-medium');
             $(item).siblings().addClass('cigna-fg-gray-light');
             $(item).removeClass('cigna-fg-gray-light');
             $(item).addClass('cigna-fg-blue-medium');
             //$(item).addClass('cigna-fg-orange-medium');
        }
        
        function bindWithdrawalElementEvent(){
            //update withdrawType
            //CR-56_Link_20220214
            $("#withdraw-select-type").on("change",function(){
                $("[id$='withdrawalType']").val( $(this).val() );
            });
            
            //update currency iso code
            $("#withdraw-select-currency-to-withdraw").on("change",function(){
                $("[id$='currencyCode']").val( $(this).val() );
            });
            
            //update payment method
            $("#withdraw-select-payment").on("change",function(){
                $("[id$='withdrawPaymentMethod']").val( $(this).val() );
            });
            
            //update delivery method
            $("#withdraw-select-delivery").on("change",function(){
                $("[id$='withdrawDeliveryMethod']").val( $(this).val() );
            });
            
            //update chequeCurrency
            $("#withdraw-select-currency").on("change",function(){
                $("[id$='chequeCurrency']").val( $(this).val() );
            });
        }
        
        function validateOnChangeUnits(item){
            $(item).siblings('input').val($(item).text());
            
            if ($(item).parent().siblings().children('input').val() != ''){
                jQueryValidate();
            }
        }
        
        function rerenderConfirmationAfterValidation(){
            console.log('Entering rerenderConfirmationAfterValidation');
            if ($('#cusWithdrawal').is(":visible")){
                nextStep();
                //saveWithdrawalRequest();
            }
            else{
                if (jQueryValidate() && additionalValidate()){
                    rerenderConfirmation();
                }
            }
        }
        
        function refresh(select) {
            var selector = $(select).val();
            console.log('selector in refresh(): ' + selector);
            $(selector).tab('show');
            switch (selector) {
                case '#BasicPlanTab':
                case '#BasicPlanRealloTab':
                    if (activeTab == 'Switching'){
                        loadAvailFundList('{!PriceType_BasicPlan}');
                    }
                    else if (activeTab == 'Reallocation'){
                        loadAvailFundListForReallocation('{!PriceType_BasicPlan}');
                    }
                    break;
                case '#AdditionalRegularTab':
                case '#AdditionalRegularRealloTab':

                    if (activeTab == 'Switching'){
                        loadAvailFundList('{!PriceType_RegularAdditional}');
                    }
                    else if (activeTab == 'Reallocation'){
                        console.log('selector- here');
                        loadAvailFundListForReallocation('{!PriceType_RegularAdditional}');
                    }
                    break;
                case '#AdditionalSingleTab':
                //case '#AdditionalSingleRealloTab':
                    //if (activeTab == 'Switching'){
                    //    loadAvailFundList('{!PriceType_Single_Additional}');
                    //}
                    //else if (activeTab == 'Reallocation'){
                    //    loadAvailFundListForReallocation('{!PriceType_Single_Additional}');
                    //}
                    loadAvailFundList('{!PriceType_Single_Additional}');
                    break;
                default:
                    break;
            }
        }
        
        // TO BE DELETED
        function hidePartialTab(select) {
            if ($(select).val() == '') {
                console.log('in hidePartialTab when value is empty');
                $('#MaxiumTab').tab('show');
            }
        }
        
        function hideChequeTab(select) {
            if ($(select).val() == '') {
                $('#directTab').tab('show');
            }
        }
        
        function showRemarks(select) {
            if ($(select).val() == '#directTab'){
                document.getElementById('paymentMethodRemarks').style.display = "block";
                $('#paymentMethodRemarks').text('{!$Label.Payment_Instruction_Remark}');
            }
            else {
                document.getElementById('paymentMethodRemarks').style.display = "none";
                $('#paymentMethodRemarks').text('');
            }
        }
        
        function showDeliveryRemarks(select) {
            if ($(select).val() == 'pickUp'){
                //document.getElementById('deliveryRemarks').style.display = "block";
                //$('#deliveryRemarks').text('{!$Label.Day_Time_Contact_No}: 91239123');
                $('#deliveryRemarks').show();
            }
            else {
                //document.getElementById('deliveryRemarks').style.display = "none";
                //$('#deliveryRemarks').text('');
                $('#deliveryRemarks').hide();
            }
        }
        
        function showInputBank(select) {
            if ($(select).val() == 'USD'){
                $('#withdraw-bank-location-div').show();
            }
            else {
                $('#withdraw-bank-location-div').hide();
            }
        }
        
        function getURLParameter(name) {
        
            return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
        }
        
        $("[id$='policyChange']").addClass('active'); // <-- change the id to the active tab          
        
        function reallocationToggleOverlayFM(){
            var overlay = document.getElementById('reallocationOverlayFM');
            var specialBox = document.getElementById('reallocationSpecialBoxFM');
            overlay.style.opacity = .95;
            if(overlay.style.display == "block"){
                overlay.style.display = "none";
                specialBox.style.display = "none";
            } else {
                overlay.style.display = "block";
                specialBox.style.display = "block";
            }
            return false;
        }
        function getOverlayContent(){
            if(Cigna.Util.isCustomerPortal()){ 
                var selectedTab = $("[id$='selectedTab']").val();
                var SwitchingTC = document.getElementById('Switching-TC-Customer');
                var ReallocationTC = document.getElementById('Reallocation-TC-Customer');
                var WithdrawalTC = document.getElementById('Withdrawal-TC-Customer');
                if(selectedTab == 'Switching'){
                    SwitchingTC.style.display = "";
                    ReallocationTC.style.display = "none";
                    WithdrawalTC.style.display = "none";
                } else if(selectedTab == 'Reallocation'){
                    SwitchingTC.style.display = "none";
                    ReallocationTC.style.display = "";
                    WithdrawalTC.style.display = "none";
                } else{
                    SwitchingTC.style.display = "none";
                    ReallocationTC.style.display = "none";
                    WithdrawalTC.style.display = "";
                }
            }else {
                var selectedTab = $("[id$='selectedTab']").val();
                var SwitchingTC = document.getElementById('Switching-TC-Broker');
                var ReallocationTC = document.getElementById('Reallocation-TC-Broker');
                var WithdrawalTC = document.getElementById('Withdrawal-TC-Broker');
                if(selectedTab == 'Switching'){
                    SwitchingTC.style.display = "";
                    ReallocationTC.style.display = "none";
                    WithdrawalTC.style.display = "none";
                } else if(selectedTab == 'Reallocation'){
                    SwitchingTC.style.display = "none";
                    ReallocationTC.style.display = "";
                    WithdrawalTC.style.display = "none";
                } else{
                    SwitchingTC.style.display = "none";
                    ReallocationTC.style.display = "none";
                    WithdrawalTC.style.display = "";
                }
            }
        }
        
        function addFundJS(name) {
            //if (jQueryValidate()){
                addFundApex(name);
            //}
        }
        
        /*For upload attachment*/  
        function uploadFile(parentId, attType){
                
            showLoading();
            
            $("#"+attType).each(function(){
              filesToUpload=$(this)[0].files[0];
            });
            
            if (filesToUpload == undefined){
                finishSubmission();
            }
    
            var reader = new FileReader();
    
            // Keep a reference to the File in the FileReader so it can be accessed in callbacks
            reader.file = filesToUpload;
    
            reader.onload = function(e){
            
                var maxFileSize = 7340032;
                var passFileSize;
                var passFileType;
                
                if(this.file.size>maxFileSize){
                    $("#errFileSize").show();
                    passFileType = false;
                }else{
                    passFileSize = 'true';
                    $("#errFileSize").hide();
                }
            
                if(this.file.type!='application/vnd.openxmlformats-officedocument.wordprocessingml.document' && this.file.type!='application/msword' && this.file.type!='application/pdf' && this.file.type!='image/png' && this.file.type!='image/jpeg' && this.file.type!='image/tiff'){
                    $("#errFileType").show();
                }else{
                    passFileType  = 'true';
                    $("#errFileType").hide();
                }
                
                if(passFileType=='true' && passFileSize=='true' && parentId && parentId!=undefined){
                    var att = new sforce.SObject("Attachment");
                    att.Name = attType+'_'+this.file.name;
                    att.ContentType = this.file.type;
                    att.ParentId = parentId;
    
                    var binary = "";
                    var bytes = new Uint8Array(e.target.result);
                    var length = bytes.byteLength;
                    
                    for (var i = 0; i < length; i++)
                    {
                        binary += String.fromCharCode(bytes[i]);
                    }
                    
                    att.Body = (new sforce.Base64Binary(binary)).toString();
                    
                    sforce.connection.create([att],
                    {
                        onSuccess : function(result, source)
                        {
                       
                            if (result[0].getBoolean("success"))
                            {
                                console.log("new attachment created with id " + result[0].id);
                                finishSubmission();
                                refreshAttlist();
                                $("html, body").animate({ scrollTop: $(document).height() }, "slow");
                                
                                $('#uploadDocErrorMesDiv').hide();
                            
                            }
                            else
                            {
                                console.log("failed to create attachment " + result[0]);
                                alert("failed to create attachment " + result[0]);
                                finishSubmission();
                                
                            }
                            
                        },
                        onFailure : function(error, source)
                        {
                            console.log("an error has occurred " + error);
                            alert("an error has occurred " + error);
                            finishSubmission();
                        }
                    });
                    
                }else if (passFileType=='true' && passFileSize=='true'){
                    alert("Missing parentId");
                    finishSubmission();
                }
                else{
                    finishSubmission();
                }
            };
                
            reader.readAsArrayBuffer(filesToUpload);
        }
        
        function showLoading() {
            $('#att-loading').fadeIn(100);
            $('#overlay-loading').fadeIn(100);
        }
                
        function finishSubmission() {
            $('#att-loading').fadeOut(100);
            $('#overlay-loading').fadeOut(100);
        } 
                  
        function removeAttachment(id){
           removeAtt(id);
           refreshAttlist();
        }    
        
        /** For Upload Attachment End */
        
        function jQueryValidate() {
            return $("form[id*='fundForm']").validate().form();
        }
        
        function additionalValidate(){
            var pass;
            if (activeTab == 'Switching'){
                pass = checkSwitchIn100();
            }
            else if (activeTab == 'Reallocation'){
                pass = checkReallocate100();
            }
            else if (activeTab == 'Withdrawal'){
                pass = checkWithdrawFilled() && checkWithdrawRequired() && checkUploadFile();
            }
            else{
                pass = true;
            }
            return pass && checkAccept();
        }
        
        function checkWithdrawRequired(){
            var pass = true;
            
            /**
            if ( document.getElementById("withdraw-select-payment-error") != null ){
                $('#withdraw-select-payment-error').text('{!$Label.Required_Field_Error_Message}');
                document.getElementById("withdraw-select-payment-error").style.display="block";
            }
            else{*/
            
            
            if ( $('#withdraw-select-payment').val() == '{!$Label.Please_Select}') {
                document.getElementById("paymentTypeErrorMes").style.display="block";
                $('#paymentTypeErrorMes').text('{!$Label.Required_Field_Error_Message}');
                pass = false;
            }
            else if ( $('#withdraw-select-payment').val() == '#chequeTab') {
                if ( $('#withdraw-select-delivery').val() == '{!$Label.Please_Select}') {
                    document.getElementById("deliveryErrorMes").style.display="block";
                    $('#deliveryErrorMes').text('{!$Label.Required_Field_Error_Message}');
                    pass = false;
                }
                if ( $('#withdraw-select-currency').val() == '{!$Label.Please_Select}') {
                    document.getElementById("chequeCurrencyErrorMes").style.display="block";
                    $('#chequeCurrencyErrorMes').text('{!$Label.Required_Field_Error_Message}');
                    pass = false;
                }
            }
            
            if ($('#withdraw-select-type').val() == '{!$Label.Please_Select}'){
                $("#withdrawTypeErrorMes").show();
                $("#withdrawTypeErrorMes").text('{!$Label.Required_Field_Error_Message}');
                pass = false;
            }
            else if ($('#withdraw-select-type').val() == '#PartialTab'){
                if ( $('#withdraw-select-currency-to-withdraw').val() == '{!$Label.Please_Select}') {
                    $("#withdrawSelectCurrencyToWithdrawErrorMes").show();
                    $("#withdrawSelectCurrencyToWithdrawErrorMes").text('{!$Label.Required_Field_Error_Message}');
                    pass = false;
                }
                else{
                    $("#withdrawSelectCurrencyToWithdrawErrorMes").hide();
                }
            }
            
            
            return pass;
        }
        
        /*function checkAllSwitchOut(){
            $("form[id*='fundForm'] input[id*='fund-switch-out-amount']").each(function(idx, elem){

                    $(this).focus();
                    $(this).blur();

            });
        }*/
        
        
        function checkSwitchOutFilled(){
            var switchOutFilled = false;
            
            $("form[id*='fundForm'] input[id*='fund-switch-out-amount']").each(function(idx, elem){
                if ( $(elem).val() != ''){
                    switchOutFilled = true;
                }
            });
            
            return switchOutFilled;
        }
        
        function checkWithdrawFilled(){
            var withdrawFilled = false;
            
            if ( !$('#partial-li').hasClass('active') ) {
                return true;
            }
            else {
                $("form[id*='fundForm'] input[id*='withdraw-input-check-maximum']").each(function(idx, elem){
                    if ($(elem).val() != ''){
                        console.log('this item is filled: ' + $(elem) + $(elem).val());
                        withdrawFilled = true;
                        return false;
                    }
                });
            }
            
            if (!withdrawFilled){
                $('#partialTableErrorDiv').show();
                $('#partialTableErrorMes').text('{!$Label.Error_Message_At_Least_One_Withdrawal_Amount}');
            }
            else{
                $('#partialTableErrorDiv').hide();
            }
            console.log('withdrawFilled: ' + withdrawFilled);
            return withdrawFilled;
        }
        
        function checkBelow100percentage(value, element){
            var pass = true;
            
            $(element).parent().siblings('div').children('.cigna-fg-blue-medium').each(function(idx, elem){
                if ( $.trim($(elem).text()) == '%'){
                    if (parseInt(value) > 100){
                        pass = false;
                        return false;
                    }
                }
            });
            /**
            $(element).parent().siblings('th').children('select').each(function(idx, elem){
                if ( $.trim($(elem).val()) == 'percent'){
                    if (parseInt(value) > 100){
                        pass = false;
                        return false;
                    }
                }
            });
            */
            return pass;
        }
        
        function checkBelowCurrentUnit(value, element){
            var pass = true;
            var temp;
            
            $(element).parent().siblings('div').children('.cigna-fg-blue-medium').each(function(idx, elem){
                if ( $.trim($(elem).text()) == '{!$Label.Units}'){
                    temp = $(element).parent().parent().parent().siblings('div').find('td.unitColumn').text();
                    if (parseInt(value) > parseInt(temp)){
                        
                        pass = false;
                    }
                }
            });
            /**
            $(element).parent().siblings('th').children('select').each(function(idx, elem){
                if ( $.trim($(elem).val()) == 'units'){
                    temp = $(element).parents('table').siblings('table').find('td.unitColumn').text();
                    if (parseInt(value) > parseInt(temp)){
                        pass = false;
                        return false;
                    }
                }
            });
            */
            return pass;
        }
        
        function checkSwitchIn100(){
            var switchIn100 = false;
            var sum = 0;
            var tempInt;
            
            $("form[id*='fundForm'] input[id*='fund-switch-in-percentage']").each(function(idx, elem){
                if ( $(elem).val() != ''){
                    tempInt = parseInt($(elem).val());
                    sum += tempInt;
                }
            });
            if (sum == 100){
                switchIn100 = true;
                $('#errorDiv').hide();
            }
            else{
                $('#errorDiv').show();
                $('#errorMes').text('{!$Label.Error_Message_Add_Up_to_Hundred_Percent}');
            }
            
            return switchIn100;
        }
        
        function checkFundSwitchDuplicate(value, element) {
            var pass = true;
            $("select[id*='fund-switch-']").each(function( index ) {
                //console.log( index + ": id : " + $( this ).attr('id') + " val: " + $( this ).val() );
                if (!$(this).is($(element))){
                    //if (value == $(this).val()) {
                    if (value!=''){
                        if (value == $(this).val()) {
                            console.log(value); //Rayyyyy
                            pass = false;
                            return false;
                        }
                    }
                }
            });
            
            return pass;
        }
        
        function checkFundReallocationDuplicate(value, element) {
            var pass = true;
            $("select[id*='fund-reallocation-']").each(function( index ) {
                //console.log( index + ": id : " + $( this ).attr('id') + " val: " + $( this ).val() );
                if (!$(this).is($(element))){
                    if (value!=''){
                    //if (value == $(this).val()) {
                        if (value == $(this).val()) {
                            pass = false;
                            return false;
                        }
                    }
                }
            });
            
            return pass;
        }
        
        function checkReallocate100(){
            var reallocate100 = false;
            var sum = 0;
            var tempInt;
            
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").each(function(idx, elem){
                if ( $(elem).val() != ''){
                    tempInt = parseInt($(elem).val());
                    sum += tempInt;
                }
            });
            if (sum == 100){
                reallocate100 = true;
                $('#RealloErrorDiv').hide();
            }
            else{
                $('#RealloErrorDiv').show();
                $('#RealloErrorMes').text('{!$Label.Error_Message_Add_Up_to_Hundred_Percent}');
            }
            
            return reallocate100;
        }
        
        function checkAccept() {
           
                var selectedTab = $("[id$='selectedTab']").val();
                
                if(selectedTab == 'Switching'){
                    if ($("#dm-consent-Switching").is(':checked')){
                    $('#picErrorDiv-Switching').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Switching').show();
                        return false;
                    }
                   
                } else if(selectedTab == 'Reallocation'){
                    if ($("#dm-consent-Reallocation").is(':checked')){
                    $('#picErrorDiv-Reallocation').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Reallocation').show();
                        return false;
                    }
                } else{
                    if ($("#dm-consent-Withdrawal").is(':checked')){
                    $('#picErrorDiv-Withdrawal').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Withdrawal').show();
                        return false;
                    }
                }
           
            
        }
        
        function checkAcceptSwitch() {
            if ($("#switch-dm-consent").is(':checked')){
                return true;
            }
            else {
                $('#errorMes').text('{!$Label.Error_Message_Accept_Terms_and_Conditions}');
                return false;
            }
        }
        
        function checkWithdrawMaximum(value, element) {
            var pass = true;
            var temp;
            
            if ($('#withdraw-select-currency-to-withdraw').val() != ''){
                $(element).parent().siblings('div.remarksLabel').find('span').each(function(idx, elem){
                    temp = $(elem).text();
                    temp = Number(temp.replace(/[^0-9\.]+/g,""));
                    
                    if ($('#withdraw-select-currency-to-withdraw').val() == 'HKD'){
                        temp *= $('#usd-hkd-ex-rate').val();
                        console.log($('#usd-hkd-ex-rate').val());
                        console.log(temp);
                    }
                    
                    if (value != '' && parseFloat(value) > temp){
                        pass = false;
                    }
                });
            }
            return pass;
        }
        
        function checkWithdrawMinimum(value, element) {
            var pass = true;
            var temp;
            if (value != ''){
                temp = parseFloat(value);
                if ($('#withdraw-select-currency-to-withdraw').val() != ''){
                    if ($('#withdraw-select-currency-to-withdraw').val() == 'HKD'){
                        temp /= $('#usd-hkd-ex-rate').val();
                        console.log($('#usd-hkd-ex-rate').val());
                        console.log(temp);
                    }
                    
                    if (temp < 100){    // < 100USD
                        pass = false;
                    }
                }
            }
            return pass;
        }
        
        function testFocus(){
            //CR-56_Link_20220214
            $("input[id*='withdraw-input-check-maximum-']").trigger("focus");
            $("input[id*='withdraw-input-check-maximum-']").trigger("blur");
        }
        
        
        //var detailsToShow;
        
        function returnRequest() {
            if (Cigna.Util.isCustomerPortal()) {
                Cigna.Util.navigateToVFP('MyPolicyVFP', null, null, true);
            }
            else if (Cigna.Util.isBrokerPortal()) {
                Cigna.Util.navigateToVFP('CustomizeSearchPolicyPageVFP', null, null, true);
            }
            else {
                Cigna.Util.navigateToVFP('MyPolicyVFP', null, null, true);
            }
        }
        
        function clearThisError(element) {
            if ($(element).val() != '') {
                $(element).siblings('label.duplicateError').text('');
                $(element).siblings('label.duplicateError').hide();
            }
        }
        
        function clearErrorMes() {
            $('#errorMes').text('');
            $('#RealloErrorMes').text('');
            $('#partialTableErrorMes').text('');
            $('#partialTableErrorDiv').hide();
            
            $("#withdrawTypeErrorMes").text('');
            $("#withdrawTypeErrorMes").hide();
            $('#paymentTypeErrorMes').text('');
            $('#deliveryErrorMes').text('');
            $('#chequeCurrencyErrorMes').text('');
            
        }
             
        function roundDown(num, precision) {
            return Math.floor(num * precision) / precision;
        } 
        
        // 20200306 - minghua - ILAS
        function validString(inputStr){
          var isOnlyChat = false;
          inputStr = inputStr.trim();
          if (inputStr) {
            var REGEX =/[`~!@#$%^&*()_\-+=<>?:"{}|,.\/;'\\[\]~@#%&*\-+={}|']/im;
            for (var i = 0; i < inputStr.length; i++) {
              var temp = inputStr.charAt(i);
              if(REGEX.test(temp)) {
              }else{
                console.log('find chat:'+temp);
                isOnlyChat = true;
                break;
              }
            }
          }
          return isOnlyChat;
        }
    </script> 
</head>
    
    <div id="container"> <!--  class="bs container-fluid" -->
    <!--  add bob 20201229 -->
    <apex:outputPanel id="errorMessage">
        <apex:pagemessages />
    </apex:outputPanel>
    <apex:form id="fundForm">
        <div class="bs content-step" data-step="1" id="firstStepForm">
            <div id ="bartab" class="onclick-pointer" > <!-- bs row  -->
                <table class="bs bar-tab-container col-sm-12 col-xs-12">
                    <tr>
                        <td id="Switching" class="bs active-bar-tab" style="color:white !important" onclick="selectTab(this);displayList('Switching')" >
                        {!$Label.Fund_Switch}
                        </td>
                        <td id="Reallocation" class="bs inactive-bar-tab" style="color:white !important" onclick="selectTab(this);displayList('Reallocation')">
                        {!$Label.Fund_Reallocation}
                        </td>
                        <td id="Withdrawal" class="bs inactive-bar-tab" style="color:white !important" onclick="selectTab(this);displayList('Withdrawal')">
                        {!$Label.Fund_Withdrawal}
                        </td>
                    </tr>
                </table>  
            </div>
    
            <apex:actionFunction action="{!addFund}" name="addFundApex" 
                                 rerender="switchInPanel,reallocationPanel"
                                 oncomplete="validateForm();calculateSwitchRemainingPercentage();calculateReallocationRemainingPercentage();FixSubmitButtonJS();">
                <apex:param name="fundListName" value="" assignTo="{!listName}"/>
            </apex:actionFunction> <!--  oncomplete="validateForm()" -->
            
            <apex:actionFunction name="sendEmailSignature" rerender="false" status="loader-icon" action="{!sendEmailSignature}" oncomplete="sendEmailToCustomer=true; nextStep();">
                <apex:param name="esignatureEmail" assignTo="{!phEmail}" value=""/>
            </apex:actionFunction>

            <apex:actionFunction name="submitEsignature" action="{!submitEsignature}" rerender="false" status="loader-icon" reRender="errorMessage" oncomplete="nextStep();">
                <apex:param name="imgDataParam" assignTo="{!imgData}" value=""/>
            </apex:actionFunction>

            <apex:actionFunction action="{!loadAvailFundList}" name="loadAvailFundList" status="loader-icon"
                                 rerender="FundSwitchingPanel, switchInPanel, uploadPanel" oncomplete="validateForm();FixSubmitButtonJS();"> <!-- FundRellocationPanel -->
                <apex:param name="fundPriceType" value="" assignTo="{!fundPriceType}"/>
            </apex:actionFunction>
            
            <apex:actionFunction action="{!loadAvailFundListForReallocation}" name="loadAvailFundListForReallocation" rerender="reallocationPanel" oncomplete="validateForm();FixSubmitButtonJS();" status="loader-icon">
                <apex:param name="fundPriceTypeReallocation" value="" assignTo="{!fundPriceTypeReallocation}"/>
            </apex:actionFunction>
            
            <apex:actionFunction action="{!loadMaximumForWithdraw}" name="loadMaximumForWithdraw" 
                                 rerender="partialTablePanel, maximumTablePanel, withdrawOuterPanel" oncomplete="validateForm();bindWithdrawalElementEvent();FixSubmitButtonJS();" status="loader-icon">
            </apex:actionFunction>
            
            <apex:actionFunction action="{!rerenderConfirmation}" name="rerenderConfirmation" rerender="confirmationPanel" status="loader-icon" oncomplete="nextStep();"/>
            <apex:actionFunction action="{!saveRecord}" name="saveRecord" status="loader-icon" oncomplete="nextStep(4);"/>

            <!-- 20200306 - minghua - ILAS -->
            <apex:actionFunction action="{!saveRecordDraft}" name="saveRecordDraft" status="loader-icon" reRender="false" />
            <apex:actionFunction action="{!loadOldFundSwitch}" name="loadOldFundSwitch" rerender="FundSwitchingPanel, switchInPanel, uploadPanel" status="loader-icon" oncomplete="rerenderConfirmation();" />
            <apex:actionFunction action="{!loadOldFundReallocation}" name="loadOldFundReallocation" rerender="reallocationPanel" oncomplete="rerenderConfirmation();" status="loader-icon">
            </apex:actionFunction>

            <apex:actionFunction action="{!brkSaveRecord}" name="brkSaveRecord" status="loader-icon"      oncomplete="sendEmailSignature(Cigna.ESignatureComp.getEmailAddress());" />

            <apex:actionFunction action="{!brkSubmitRecord}" name="brkSubmitRecord" status="loader-icon"      oncomplete="submitEsignature(Cigna.ESignatureComp.getSignatureImage(1));" />

            <apex:actionFunction action="{!saveWithdrawalRequest}" name="saveWithdrawalRequest" status="loader-icon" oncomplete="nextStep(4);"/>
            
            <!--   -->
            <!--End of del msg-->   
            <!--Customer View-->

            <!-- <div class="bs container-fluid"> -->
                <div style="padding-top:10px;" />
                <div id="headeraction" class="bs header-action">
                    <div id="back" class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                        <a href="#" onclick="previousStep();" class="bs cigna-fg-orange-medium pull-left"> <!-- onclick="Cigna.Util.navigateToVFP('PolicyDetailsPageVFP?policyNumber={!policyNumber}&policyType=ILAS', null, null, true)" -->
                            <i class="ci-hk-arrow-29" aria-hidden="true"></i> {!$Label.Back}
                        </a>
                    </div>
                </div>
                
                <!-- Start of Customer Fund Switching -->
                <div id="cusSwitching" class="bs container-fluid"> 
                    <div class="bs row">
                        <!-- 20200306 - minghua - ILAS -->
                        <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                            <!-- Rancho_BEEFund_20220324: add reminder -->
                            <div class="cigna-fg-blue-light" style="padding-bottom: 10pt;">
                                <apex:outputText escape="false" value="{!$Label.Investment_Choice_Suspension_Notice}" />
                            </div>
                            <div class="cigna-fg-blue-light content-highlight">{!transField['To_view_risk'][$Label.Header_Language_Code_Current]} <a class="onclick-pointer" onclick="showILASPanl();">{!transField['Cigna_Fund_Risk_Level'][$Label.Header_Language_Code_Current]}</a></div>
                        </div>

                        <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field" id="switchFundSelectDiv">
                            <div class="cigna-fg-blue-light content-highlight">{!$Label.Step_1}</div>
                            <p>{!$Label.Please_select_the_plan}</p>
                            <!--
                            <select id="switch-select-type" class="bs form-field-style-select onclick-pointer" onChange="refresh(this);">
                                    <option value="#BasicPlanTab" selected="selected">{!$Label.Basic_Plan}</option>
                                    <option value="#AdditionalRegularTab">{!$Label.Regular_Additional_Contribution}</option>
                                    <option value="#AdditionalSingleTab">{!$Label.Single_Additional_Contribution}</option>
                            </select>
                            -->
                            <apex:selectList id="switch-select-type" value="{!selectedPlan}" multiselect="false" size="1" onchange="refresh(this);" styleClass="bs form-field-style-select onclick-pointer" >
                                <apex:selectOption itemValue="#BasicPlanTab" itemLabel="{!$Label.Basic_Plan}"></apex:selectOption>
                                <apex:selectOption itemValue="#AdditionalRegularTab" itemLabel="{!$Label.Regular_Additional_Contribution}"></apex:selectOption>       
                                <apex:selectOption itemValue="#AdditionalSingleTab" itemLabel="{!$Label.Single_Additional_Contribution}"></apex:selectOption>
                            </apex:selectList>
                        </div>

                        <apex:outputPanel id="FundSwitchingPanel" styleClass="bs tab-content">
                            <script>
                                if('{!currentFundList}' == '' || '{!currentFundList.size}' == '0' || {!negativePolicy}){
                                    console.log('hiding' + '{!currentFundList.size}');

                                    if({!negativePolicy}){
                                      $('#notAllowToSwitchDiv div').text('{!$Label.Error_Unable_to_proceed}');
                                      $('#switchFundSelectDiv').hide();
                                    } else {
                                      $('#notAllowToSwitchDiv div').text('{!$Label.Not_eligible_to_switch_fund}');
                                    }

                                    $('#allowToSwitchDiv').hide();
                                    $('#notAllowToSwitchDiv').show();

                                    displayTCNext(false);
                                    switchShowNext = false;
                                }
                                else{
                                    console.log('showing' + '{!currentFundList.size}');
                                    $('#allowToSwitchDiv').show();
                                    $('#notAllowToSwitchDiv').hide();
                                    displayTCNext(true);
                                    switchShowNext = true;
                                }
                            </script>
                            <div id="allowToSwitchDiv">
                                <input type="hidden" id="usd-hkd-ex-rate" value="{!usdhkdExchangeRate}"/>
                                <div id="BasicPlan"  class="tab-pane fade in active bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                    <div class="cigna-fg-blue-light content-highlight">{!$Label.Step_2}</div>
                                    <p>{!$Label.Please_specify_the_number_of_units_or_percentage_to_sell_from_existing_portfolio}</p>
                                                 
                                    <apex:variable var="switchOutCount" value="{!1}" />
                                    <apex:repeat value="{!currentFundList}" var="fundWrapper">
                                        <div class="bs row">
                                            <div class="bs col-xs-12 cigna-fg-green-medium content-highlight form-field">{!fundWrapper.fund.productFullName }</div> 
                                            <div class="bs col-sm-8 col-sm-offset-2 col-xs-12 form-field"> 
                                                <table class = "bs table borderless fundTable" style="margin-bottom:0;" id="switch-out-table-{!switchOutCount}">
                                                    <thead>
                                                    <tr>
                                                        <th class="cigna-fg-gray-dark">{!$Label.Unit}</th>
                                                        <!-- <th class="cigna-fg-gray-dark">%</th> -->
                                                        <th class="cigna-fg-gray-dark">{!$Label.Unit_Price}</th>
                                                        <th class="cigna-fg-gray-dark">{!$Label.Total}</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td class="content-highlight unitColumn">{!fundWrapper.fund.currNumberUnits }</td>
                                                            <!-- <td class="content-highlight percentColumn">70</td> -->
                                                            <td class="content-highlight unitPriceColumn">{!fundWrapper.fund.unitValue }</td>
                                                            <td class="content-highlight totalPriceColumn">{!fundWrapper.fund.totValue }</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="bs col-xs-12 col-sm-6 form-field">  
                                                <div class="bs row">
                                                    <div class="bs col-xs-8">
                                                        <!-- 
                                                        <apex:inputField type="tel" id="fund-switch-out-amount-A" html-placeholder="{!$Label.Amount}" 
                                                                    value="{!dummyObject.Contact_No__c}" styleClass="bs form-field-style amountInputCenter"
                                                                    onkeyup="calculateSwitchEstimatedValue()"/>
                                                                     -->
                                                        <!-- To be changed to TEL -->
                                                        <apex:input type="text" id="fund-switch-out-amount" html-placeholder="{!$Label.Amount}" 
                                                                    value="{!fundWrapper.amount}" styleClass="bs form-field-style amountInputCenter"
                                                                    onkeyup="calculateSwitchEstimatedValue()" />
                                                    </div>
                                                    <div class="bs col-xs-4 form-field-text-style">    
                                                        <!--
                                                        <select class="bs form-field-style-select onclick-pointer">
                                                                <option value="units" selected="selected">{!$Label.Units}</option>
                                                                <option value="percent">%</option>
                                                        </select>
                                                        -->
                                                        <!-- 20200306 - minghua - ILAS -->
                                                        <span class="content-choice cigna-fg-blue-medium onclick-pointer content-highlight" id="switchOutPercent-{!switchOutCount}" 
                                                                onclick="selectedSingle(this);calculateSwitchEstimatedValue();validateOnChangeUnits(this);"> 
                                                            % 
                                                        </span> 
                                                        / 
                                                        <span class="content-choice cigna-fg-gray-light onclick-pointer content-highlight" id="switchOutUnits-{!switchOutCount}" 
                                                                onclick="selectedSingle(this);calculateSwitchEstimatedValue();validateOnChangeUnits(this);"> 
                                                            {!$Label.Units} 
                                                        </span>
                                                        <apex:inputHidden value="{!fundWrapper.switchOutType}" id="switch-out-type-select"/>
                                                        <input type="hidden" value="{!fundWrapper.switchOutType}" id="switch-out-type-select-{!switchOutCount}" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <script>
                                          // 20200306 - minghua - ILAS
                                          if (loadOldPolicy) {
                                            var oldValue = $('#switch-out-type-select-{!switchOutCount}').val();
                                            if ('%' == oldValue) {
                                              console.log('percent');
                                              //CR-56_Link_20220214
                                              $('span[id$="switchOutPercent-{!switchOutCount}"]').trigger('click');
                                            }else if ('{!$Label.Units}' == oldValue) {
                                              console.log('Units');
                                              //CR-56_Link_20220214
                                              $('span[id$="switchOutUnits-{!switchOutCount}"]').trigger('click');
                                            }
                                          }

                                            /* Round up numbers */
                                            $('#switch-out-table-{!switchOutCount}').children('tbody').children('tr').children('td').each(function(idx, elem){
                                                //console.log(idx);
                                                if (idx == 0) {
                                                    $(elem).html(roundDown('{!fundWrapper.fund.currNumberUnits }', '100'));
                                                }
                                                /**
                                                if (idx == 1) {
                                                    $(elem).html(roundDown('{!fundWrapper.fund.basicPlanPercent }', '100'));
                                                }*/
                                                if (idx == 1) {
                                                    $(elem).html(roundDown('{!fundWrapper.fund.unitValue }', '100'));
                                                }
                                                if (idx == 2) {
                                                    $(elem).html(roundDown('{!fundWrapper.fund.totValue }', '100'));
                                                }
                                                //console.log($(elem).html());
                                            });
                                        </script> 
                                        <apex:variable var="switchOutCount" value="{!switchOutCount + 1}" />
                                    </apex:repeat>
                                    
                                    <div class="bs row form-field">
                                        <div class="bs col-xs-8 cigna-fg-blue-medium content-highlight">
                                            <p>{!$Label.Estimated_value_based_on_last_known_price}</p>
                                        </div>
                                        <div class="bs col-xs-4 cigna-fg-blue-medium pull-right content-highlight">
                                            <p id="fund-switch-estimated-value" class="pull-right">{!$Label.USD} 0 </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Switch in -->
                                    <apex:outputPanel id="switchInPanel">
                                    
                                        <div class="cigna-fg-blue-light content-highlight">{!$Label.Step_3}</div>
                                        <p>{!IF(isBroker,$Label.Please_select_the_fund_s_custome_want_to_buy_and_what_of_the_sale_price_you_want, $Label.Please_select_the_fund_s_you_want_to_buy_and_what_of_the_sale_price_you_want)}</p>
                                        
                                        
                                        <!-- 20200306 - minghua - ILAS -->
                                        <div class="bs row form-field">
                                            <div class="bs col-xs-8 cigna-fg-blue-medium content-highlight">
                                                <p>{!transField['Your_RPQ_Status'][$Label.Header_Language_Code_Current]}</p>
                                            </div>
                                            <div class="bs col-xs-4 cigna-fg-blue-medium pull-right content-highlight">
                                              <!-- 20200812 - minghua - SPS-552 -->
                                                <p class="pull-right">{!latestRPQStatus}</p> 
                                            </div>
                                            <div class="bs col-xs-8 cigna-fg-blue-medium content-highlight">
                                                <p>{!transField['Your_RPQ_Effective_Date'][$Label.Header_Language_Code_Current]}</p>
                                            </div>
                                            <div class="bs col-xs-4 cigna-fg-blue-medium pull-right content-highlight">
                                                <p class="pull-right"> <!-- 20200812 - minghua - SPS-552 -->
                                                  <apex:outputText value="{0, date, dd/MM/yyyy}">
                                                    <apex:param value="{!rPQInfo.effectiveDate}" />
                                                </apex:outputText>
                                                </p>
                                            </div>
                                            <div class="bs col-xs-12 content-highlight" id="showSuggestMesSwitch" style="display: {!IF(isShowRPQWarningMessage,'block','none')}">
                                                <span style="color: red">{!transField['Your_Risk_Profile_was'][$Label.Header_Language_Code_Current]}</span>
                                                <span class="cigna-fg-blue-medium onclick-pointer" onclick="onlineRPQ();">{!transField['Personal_Risk_Questionnaire'][$Label.Header_Language_Code_Current]}</span>
                                                <span style="color: red">{!transField['refresh_your_risk_profile'][$Label.Header_Language_Code_Current]}</span>
                                            </div>
                                        </div>

                                        <div class="bs row form-field">
                                            <div class="bs col-xs-10 cigna-fg-blue-medium content-highlight">
                                                <p>{!$Label.Remaining_percentage_to_distribute}</p>
                                            </div>
                                            <div class="bs col-xs-2 cigna-fg-blue-medium pull-right content-highlight">
                                                <p id="fund-switch-remaining-percentage" class="pull-right"> 0% </p>
                                            </div>
                                        </div> 
                                        <!-- <apex:pageMessages></apex:pageMessages> 
                                        <div class="col-sm-12 col-xs-12 content-highlight" style="padding-top:10px;">{!$Label.Switch_In}</div> -->
                                        
                                        <apex:variable var="count" value="{!1}" />
                                        <apex:repeat value="{!switchInList}" var="fund">
                                            <div class="bs row form-field">
                                                
                                                <div class="bs col-xs-12 col-sm-8">
                                                    <span> {!count}. </span>
                                                    <span>
                                                    <apex:selectList id="fund-switch-selector" styleClass="bs form-field-style-select cigna-fg-gray-dark fund-select-switch-in onclick-pointer" 
                                                                     size="1" value="{!fund.fundCode}" onchange="checkFundSwitchDuplicate();" style="width:90% !important;">
                                                        <apex:selectOptions value="{!availFundOptions}" />
                                                    </apex:selectList>
                                                    </span>
                                                </div>
                                                
                                                <div class="bs col-xs-6 col-xs-offset-5 col-sm-3 col-sm-offset-0">
                                                    <!--<input type="number" min="1" id="fund-switch-in-percentage" placeholder="{!$Label.Percentage}" Class="bs form-field-style amountInputCenter" value="{!fund.amount}"/>-->
                                                    <div class="bs col-xs-9">
                                                        <apex:input id="fund-switch-in-percentage"
                                                                styleClass="bs form-field-style amountInputCenter" value="{!fund.amount}" 
                                                                onkeyup="calculateSwitchRemainingPercentage();"/>  <!-- html-placeholder="{!$Label.Percentage}"  -->
                                                    </div>
                                                    <div class="bs col-xs-3 form-field-text-style" style="padding-left:0;">
                                                        <span class="cigna-fg-blue-medium"> % </span>
                                                    </div>
                                                </div>
                                                <div class="bs col-xs-1 form-field-text-style" style="padding-left:0;">
                                                    <apex:commandLink action="{!removeFund}" rerender="switchInPanel" styleClass="pull-right" oncomplete="calculateSwitchRemainingPercentage();"> 
                                                        <i class="fa fa-minus-circle fa-lg cigna-fg-gray-dark" aria-hidden="true" style="{!IF(switchInList.size == 1, 'display:none;', 'color:black;')}"></i>
                                                        <apex:param name="removeFundParam" value="{!fund.id}" assignTo="{!switchFundToRemove}"/>
                                                    </apex:commandLink>
                                                </div>
                                                
                                            </div>
                                            <div class="bs row" style="{!IF(count>=8, 'display:none;', '')}">
                                                <div class="bs col-xs-1 col-xs-offset-11 cigna-fg-gray-dark" style="padding-left:0;">
                                                    <i class="fa fa-plus-circle fa-lg onclick-pointer pull-right" style="{!IF(count != switchInList.size, 'display:none;', '')}" onclick="addFundJS('switch')"></i> 
                                                </div>
                                            </div>
                                            
                                            <apex:variable value="{!count+1}" var="count"/>
                                        </apex:repeat>    
                                        
                                        
                                    </apex:outputPanel>
                                    
                                    <!-- Error Message -->
                                    <div id="errorDiv" class="errorDiv form-field"> <!-- col-sm-12 col-xs-12  -->
                                        <label class="cusError" id="errorMes" ></label>
                                    </div>
                                    
                                    <!--
                                    <apex:outputPanel id="switch-pics-section">
                                        <div class="bs cigna-fg-gray-dark fontWeightNormal form-field">  
                                            
                                            <p>
                                                <input type="checkbox" id="switch-dm-consent" name="switch-dm-consent" class="bs cigna-question-checkbox" onchange="$(this).parent().siblings('input').val($(this).is(':checked'));" />
                                                <label for="switch-dm-consent">{!IF(isBroker,$Label.Esginature_TandC_I_accept,$Label.I_accept_the)} <a onclick="reallocationToggleOverlayFM();return false;">{!$Label.Footer_Terms_Conditions}</a>.</label>
                                            </p>
                                            
                                            <apex:inputHidden value="{!switchParamDMConsent}" id="switchParamDMConsent" />
                                        </div>
                                    </apex:outputPanel>
                                    -->
                                    
                                </div>
                            </div>
                            
                            <div id="notAllowToSwitchDiv">
                                <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                </div>
                            </div>
                        </apex:outputPanel>
                    </div>
                </div>
                <!-- End of Customer Fund Switching -->
                
                
                <!-- Start of Customer Fund Reallocation -->
                <div id="cusReallocation" class="bs container-fluid " >
                    <div class="bs row">
                        <!-- 20200306 - minghua - ILAS -->
                        <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                            <!-- Rancho_BEEFund_20220324: add reminder -->
                            <div class="cigna-fg-blue-light" style="padding-bottom: 10pt;">
                                <apex:outputText escape="false" value="{!$Label.Investment_Choice_Suspension_Notice}" />
                            </div>
                            <div class="cigna-fg-blue-light content-highlight">{!transField['To_view_risk'][$Label.Header_Language_Code_Current]} <a class="onclick-pointer" onclick="showILASPanl();">{!transField['Cigna_Fund_Risk_Level'][$Label.Header_Language_Code_Current]}</a></div>
                        </div>
                        <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">

                            <div class="cigna-fg-blue-light content-highlight">{!$Label.Step_1}</div>
                            <p>{!$Label.Please_select_the_plan}</p>
                            <!--
                            <select id="tabSelector" class="bs form-field-style-select onclick-pointer" onChange="refresh(this);">
                                    <option value="#BasicPlanRealloTab" selected="selected">{!$Label.Basic_Plan}</option>
                                    <option value="#AdditionalRegularRealloTab">{!$Label.Regular_Additional_Contribution}</option>
                                    <!-- <option value="#AdditionalSingleRealloTab">{!$Label.Single_Additional_Contribution}</option> >
                                    <!-- single is not applicable to reallocation >
                            </select>
                            -->
                            <apex:selectList id="tabSelector" value="{!selectedPlan}" multiselect="false" size="1" onchange="refresh(this);" styleClass="bs form-field-style-select onclick-pointer" >
                                <apex:selectOption itemValue="#BasicPlanRealloTab" itemLabel="{!$Label.Basic_Plan}"></apex:selectOption>
                                <apex:selectOption itemValue="#AdditionalRegularRealloTab" itemLabel="{!$Label.Regular_Additional_Contribution}"></apex:selectOption>
                            </apex:selectList>
                        </div>
                        
                        <!-- apex:outputPanel id="FundRellocationPanel" styleClass="bs tab-content form-field" -->
                        <div id="fundReallocationDiv"  class="tab-pane fade in active bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                            <!-- Reallocation -->
                            <apex:outputPanel id="reallocationPanel">
                                <script>
                                    if (activeTab == 'Reallocation'){
                                        console.log('eligibleToReallocate: ' + {!eligibleToReallocate});
                                        if ({!eligibleToReallocate} && {!!hasNegativeFund} ){
                                            $('#allowToReallocate').show();
                                            $('#notAllowToReallocate').hide();
                                            displayTCNext(true);
                                            reallocationShowNext = true;
                                        }
                                        else{
                                            if({!hasNegativeFund}){
                                              $('#notAllowToReallocate').text('{!$Label.Error_Unable_to_proceed}');
                                            } else {
                                              $('#notAllowToReallocate').text('{!$Label.Not_eligible_to_reallocate_fund}');
                                            }

                                            $('#allowToReallocate').hide();
                                            $('#notAllowToReallocate').show();
                                            displayTCNext(false);
                                            reallocationShowNext = false;
                                        }
                                    }
                                </script>
                                <div id="allowToReallocate">
                                    <div class="cigna-fg-blue-light content-highlight">{!$Label.Step_2}</div>
                                    <p>{!IF(isBroker,$Label.Please_specify_the_funds_cus_want_to_buy_for_your_future_contributions_and_of,$Label.Please_specify_the_funds_you_want_to_buy_for_your_future_contributions_and_of)}</p>
                                    
                                    <!-- 20200306 - minghua - ILAS -->
                                    <div class="bs row form-field">
                                        <div class="bs col-xs-8 cigna-fg-blue-medium content-highlight">
                                            <p>{!transField['Your_RPQ_Status'][$Label.Header_Language_Code_Current]}</p>
                                        </div>
                                        <div class="bs col-xs-4 cigna-fg-blue-medium pull-right content-highlight">
                                            <p class="pull-right">{!latestRPQStatus}</p> <!-- 20200812 - minghua - SPS-552 -->
                                        </div>
                                        <div class="bs col-xs-8 cigna-fg-blue-medium content-highlight">
                                            <p>{!transField['Your_RPQ_Effective_Date'][$Label.Header_Language_Code_Current]}</p>
                                        </div>
                                        <div class="bs col-xs-4 cigna-fg-blue-medium pull-right content-highlight">
                                            <p class="pull-right"> <!-- 20200812 - minghua - SPS-552 -->
                                              <apex:outputText value="{0, date, dd/MM/yyyy}">
                                                <apex:param value="{!rPQInfo.effectiveDate}" />
                                            </apex:outputText>
                                            </p>
                                        </div>
                                        <div class="bs col-xs-12 content-highlight" id="showSuggestMesReallocate" style="display: {!IF(isShowRPQWarningMessage,'block','none')}">
                                            <span style="color: red">{!transField['Your_Risk_Profile_was'][$Label.Header_Language_Code_Current]}</span>
                                            <span class="cigna-fg-blue-medium onclick-pointer" onclick="onlineRPQ();">{!transField['Personal_Risk_Questionnaire'][$Label.Header_Language_Code_Current]}</span>
                                            <span style="color: red">{!transField['refresh_your_risk_profile'][$Label.Header_Language_Code_Current]}</span>
                                        </div>
                                    </div>

                                    <!-- <div class="col-xs-12 content-highlight">{!$Label.Future_Premium_Re_allocation}</div>  -->
                                    <div class="bs row form-field">
                                        <div class="bs col-xs-10 cigna-fg-blue-medium content-highlight">
                                            <p>{!$Label.Remaining_percentage_to_distribute}</p>
                                        </div>
                                        <div class="bs col-xs-2 cigna-fg-blue-medium pull-right content-highlight">
                                            <p id="fund-reallocation-remaining-percentage" class="pull-right"> 0% </p>
                                        </div>
                                    </div> 
                                    
                                    <apex:variable var="count" value="{!1}" />
                                    <apex:repeat value="{!reallocationList}" var="fund">
                                        <!--
                                        <div class="col-md-4 col-sm-6 col-xs-12">
                                            <table class = "bs table borderless content-highlight switchInTable" style="margin-bottom:0;">
                                                <thead>
                                                <tr>
                                                    <th width="5%" ></th>
                                                    <th width="45%" ></th>
                                                    <th width="35%" ></th>
                                                    <th width="5%" ></th>
                                                    <th width="10%"></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td>
                                                        {!count}
                                                    </td>
                                                    <td colspan="3">
                                                        <apex:selectList id="fund-reallocation-selector" styleClass="bs form-field-style-select cigna-fg-gray-dark onclick-pointer" size="1" value="{!fund.fundCode}">
                                                            <apex:selectOptions value="{!availFundOptions}" />
                                                        </apex:selectList>
                                                    </td>
                                                    <td>
                                                        <apex:commandLink action="{!removeFund}" rerender="reallocationPanel"> 
                                                            <i class="fa fa-minus-circle fa-lg " aria-hidden="true" style="{!IF(reallocationList.size == 1, 'display:none;', 'color:black;')}"></i>
                                                            <apex:param name="removeRealloFundParam" value="{!fund.id}" assignTo="{!reallocationFundToRemove}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"></td>
                                                    <td width="25%" class="cigna-fg-gray-dark"> 
                                                        <apex:input id="fund-reallocate-amount" html-placeholder="{!$Label.Amount}" styleclass="bs form-field-style amountInputCenter" value="{!fund.amount}"/>                                        
                                                    </td>
                                                    <td width="5%" class="cigna-fg-gray-dark">
                                                        <div style="margin-top:5px;"> % </div> 
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4"></td>
                                                    <td>
                                                        <i class="fa fa-plus-circle fa-lg onclick-pointer" style="{!IF(count != reallocationList.size, 'display:none;', '')}" onclick="addFundJS('reallocate')"></i>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        -->
                                        
                                        <div class="bs row form-field">
                                            
                                            <div class="bs col-xs-12 col-sm-8">
                                                <span> {!count}. </span>
                                                <span>
                                                <apex:selectList id="fund-reallocation-selector" styleClass="bs form-field-style-select cigna-fg-gray-dark fund-select-switch-in onclick-pointer" size="1" value="{!fund.fundCode}" onchange="checkFundReallocationDuplicate();" style="width:90% !important;">
                                                    <apex:selectOptions value="{!availFundOptionsReallocation}" />
                                                </apex:selectList>
                                                </span>
                                            </div>
                                            
                                            <div class="bs col-xs-6 col-xs-offset-5 col-sm-3 col-sm-offset-0">
                                                <!--<input type="number" min="1" id="fund-switch-in-percentage" placeholder="{!$Label.Percentage}" Class="bs form-field-style amountInputCenter" value="{!fund.amount}"/>-->
                                                <div class="bs col-xs-9">
                                                    <apex:input id="fund-reallocate-amount"
                                                            styleClass="bs form-field-style amountInputCenter" value="{!fund.amount}" 
                                                            onkeyup="calculateReallocationRemainingPercentage()"/>  <!-- html-placeholder="{!$Label.Percentage}"  -->
                                                </div>
                                                <div class="bs col-xs-3 form-field-text-style" style="padding-left:0;">
                                                    <span class="cigna-fg-blue-medium"> % </span>
                                                </div>
                                            </div>
                                            <div class="bs col-xs-1 form-field-text-style" style="padding-left:0;">
                                                <apex:commandLink action="{!removeFund}" rerender="reallocationPanel" styleClass="pull-right" oncomplete="calculateReallocationRemainingPercentage();"> 
                                                    <i class="fa fa-minus-circle fa-lg cigna-fg-gray-dark" aria-hidden="true" style="{!IF(reallocationList.size == 1, 'display:none;', 'color:black;')}"></i>
                                                    <apex:param name="removeRealloFundParam" value="{!fund.id}" assignTo="{!reallocationFundToRemove}"/>
                                                </apex:commandLink>
                                            </div>
                                            
                                        </div>
                                        <div class="bs row" style="{!IF(count>=8, 'display:none;', '')}">
                                            <div class="bs col-xs-1 col-xs-offset-11 cigna-fg-gray-dark" style="padding-left:0;">
                                                <i class="fa fa-plus-circle fa-lg onclick-pointer pull-right" style="{!IF(count != reallocationList.size, 'display:none;', '')}" onclick="addFundJS('reallocate')"></i> 
                                            </div>
                                        </div>
                                        
                                        <apex:variable value="{!count+1}" var="count"/>  <!--increment-->
                                    </apex:repeat>    
                                </div>
                                <div id="notAllowToReallocate" class="bs form-group">
                                </div>
                            </apex:outputPanel>
                            
                            <!-- Error Message -->
                            <div id="RealloErrorDiv" class="errorDiv form-field"> <!-- col-sm-12 col-xs-12  -->
                                <label class="cusError" id="RealloErrorMes" ></label>
                            </div>
                            
                            <!--
                            <apex:outputPanel id="pics-section">
                                <div class="bs cigna-fg-gray-dark fontWeightNormal form-field">  
                                    
                                    <p>
                                        <input type="checkbox" id="dm-consent" name="dm-consent" class="bs cigna-question-checkbox" onchange="$(this).parent().siblings('input').val($(this).is(':checked'));" />
                                        <label for="dm-consent">{!IF(isBroker,$Label.Esginature_TandC_I_accept,$Label.I_accept_the)} <a onclick="reallocationToggleOverlayFM()">{!$Label.Footer_Terms_Conditions}</a>.</label>
                                    </p>
                                    
                                    <apex:inputHidden value="{!paramDMConsent}" id="paramDMConsent" />
                                </div>
                            </apex:outputPanel>
                            -->
                        </div>
                        <!-- /apex:outputPanel -->
                    </div>
                </div>
                <!-- End of Customer Fund Reallocation -->
                
                <!-- Start of Customer Fund Withdrawal -->
                <div id="cusWithdrawal">
                    <apex:outputPanel id="withdrawOuterPanel">
                        <script>
                            console.log('Three max value: {!MaxBasic}, {!MaxRegular}, {!MaxSingle}');
                            //console.log({!MaxBasic} + ', ' + {!MaxRegular} + ', ' + {!MaxSingle});
                            if ({!MaxBasic == 0} && {!MaxRegular == 0} && {!MaxSingle == 0}){
                                console.log('Three max value all zero');
                                $('#allowToWithdraw').hide();
                                $('#notAllowToWithdraw').show();
                                displayTCNext(false);
                                withdrawShowNext = false;
                            }
                        </script>
                        
                        <div id="allowToWithdraw">
                            <!--start of loading-->
                            <div id="overlay-loading" class="overlay" style="background: rgba(217,217,214, 0.5);">
                                <div id="att-loading" class="bs col-xs-offset-3 col-xs-6 text-center loading-spinner">
                                    <img class="bs" src="{!URLFOR($Resource.Spinners, 'slds_spinner.gif')}" width="70px" />
                                    <div class="loading-label">
                                        {!$Label.uploading}
                                    </div>
                                </div>
                            </div> 
                            <!--end of loading-->
                            
                            <div style="padding-top:10px;" />

                            <!-- Rancho_BEEFund_20220324: add reminder -->
                            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                <div class="cigna-fg-blue-light">
                                    <apex:outputText escape="false" value="{!$Label.Investment_Choice_Suspension_Notice}" />
                                </div>
                            </div>
                            
                            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                <div class="bs col-sm-3">{!$Label.Withdrawal_Type}</div>
                                <div class="bs col-sm-9">
                                    <select id="withdraw-select-type" class="bs form-field-style-select onclick-pointer" onChange="refresh(this);clearThisError(this);" required="required"> <!-- hidePartialTab(this);-->
                                            <option value="" selected="selected">{!$Label.Please_Select}</option>
                                            <option value="#MaxiumTab">{!$Label.Maximum_Fund_Withdrawal}</option>
                                            <option value="#PartialTab">{!$Label.Partial_Fund_Withdrawal}</option>
                                    </select>
                                    <apex:inputHidden value="{!withdrawalType}" id="withdrawalType"/>
                                    <label class="cusError duplicateError" id="withdrawTypeErrorMes" style="margin-top:5px;display:none;" ></label>
                                </div>
                            </div>
                                
                            <!-- Nav tabs -->
                            <ul class="bs nav nav-pills" role="tablist" style="display:none">
                                <li role="presentation" class="bs hidden-xs hidden-sm"> <!-- active -->
                                    <a id="MaxiumTab" href="#Maxium" aria-controls="Maxium" role="tab" data-toggle="tab">{!$Label.Maximum_Fund_Withdrawal}</a>
                                </li>
                                <li role="presentation" class="bs hidden-xs hidden-sm" id = "partial-li">
                                    <a id="PartialTab" href="#Partial" aria-controls="Partial" role="tab" data-toggle="tab">{!$Label.Partial_Fund_Withdrawal}</a>
                                </li>
                                <!-- Mobile Dropdown -->
                                <li role="presentation" class="bs dropdown visible-xs visible-sm">
                                    <ul class="bs dropdown-menu dropdown-menu-right" style="right: -60pt;">
                                        <li>
                                            <a href="#MaxiumTab" aria-controls="Maxium" role="tab" data-toggle="tab">{!$Label.Maximum_Fund_Withdrawal}</a>
                                        </li>
                                        <li>
                                            <a href="#PartialTab" aria-controls="Partial" role="tab" data-toggle="tab">{!$Label.Partial_Fund_Withdrawal}</a>
                                        </li>
                                        <li role="separator" class="divider"></li>
                                    </ul>
                                </li>
                            </ul>
                            
                            <div class="bs tab-content" style="padding-top:10px;">
                                
                                <div id="Maxium"  class="tab-pane fade"> <!--  in active bs col-lg-offset-0 col-sm-offset-0 -->
                                    <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                        <apex:outputPanel id="maximumTablePanel">
                                            <div class="bs col-sm-9 col-sm-offset-3">
                                                <div class="bs row form-field" style="{!IF(MaxBasic == 0, 'display:none;', '')}">
                                                    <div class="bs col-sm-6 content-highlight" >
                                                        {!$Label.Basic_Plan}
                                                    </div>
                                                    <div class="bs col-sm-6 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                            <apex:outputText value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxBasic}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                </div>
                                                
                                                <div class="bs row form-field" style="{!IF(MaxRegular == 0, 'display:none;', '')}">                                                
                                                    <div class="bs col-sm-6 content-highlight" >
                                                        {!$Label.Regular_Additional_Contribution}
                                                    </div>
                                                    <div class="bs col-sm-6 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                            <apex:outputText value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxRegular}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="bs row form-field" style="{!IF(MaxSingle == 0, 'display:none;', '')}">
                                                    <div class="bs col-sm-6 content-highlight" >
                                                        {!$Label.Single_Additional_Contribution}
                                                    </div>
                                                    <div class="bs col-sm-6 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                            <apex:outputText value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxSingle}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div> 
                                        </apex:outputPanel>
                                    </div>
                                </div>
                                <div id="Partial"  class="tab-pane fade">
                                    <!-- Partial Withdrawal Table-->
                                    <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                        <div class="bs col-sm-9 col-sm-offset-3">
                                            <div class="bs row">
                                                <div class="bs col-sm-7" >
                                                    {!$Label.Currency_to_withdraw}
                                                </div>
                                                <div class="bs col-sm-5" >
                                                    <select id="withdraw-select-currency-to-withdraw" class="bs form-field-style-select onclick-pointer" onChange="clearThisError(this);jQueryValidate();">
                                                            <option value="" selected="selected">{!$Label.Please_Select}</option>
                                                            <option value="HKD">{!$Label.HKD}</option>
                                                            <option value="USD">{!$Label.USD}</option>
                                                    </select>
                                                    <apex:inputHidden value="{!currencyCode}" id="currencyCode"/>
                                                    <label class="cusError duplicateError" id="withdrawSelectCurrencyToWithdrawErrorMes" style="margin-top:5px;display:none;" ></label>
                                                    
                                                </div>
                                                <div class="bs col-sm-12" >
                                                    
                                                </div>
                                                
                                            </div>
                                        </div>
                                        <apex:outputPanel id="partialTablePanel">
                                            <div class="bs col-sm-9 col-sm-offset-3">
                                                <div class="bs row form-field" style="{!IF(MaxBasic == 0, 'display:none;', '')}">
                                                    <div class="bs col-sm-3 content-highlight" >
                                                        {!$Label.Basic_Plan}
                                                    </div>
                                                    <div class="bs col-sm-4 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                             <apex:outputText id="opMaxBasic" value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxBasic}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                    <div class="bs col-sm-5" >
                                                        <apex:input value="{!withdrawBasic}" id="withdraw-input-check-maximum-basic" styleClass="form-field-style" onkeyup="calc3NegativeValue()" />
                                                    </div>
                                                </div>
                                                
                                                <div class="bs row form-field" style="{!IF(MaxRegular == 0, 'display:none;', '')}">                                                
                                                    <div class="bs col-sm-3 content-highlight" >
                                                        {!$Label.Regular_Additional_Contribution}
                                                    </div>
                                                    <div class="bs col-sm-4 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                           <apex:outputText id="opMaxRegular" value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxRegular}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                    <div class="bs col-sm-5" >
                                                        <apex:input value="{!withdrawRegular}" id="withdraw-input-check-maximum-regular" styleClass="form-field-style" onkeyup="calc3NegativeValue()"/>
                                                       
                                                    </div>
                                                </div>
                                                <div class="bs row form-field" style="{!IF(MaxSingle == 0, 'display:none;', '')}">
                                                    <div class="bs col-sm-3 content-highlight" >
                                                        {!$Label.Single_Additional_Contribution}
                                                    </div>
                                                    <div class="bs col-sm-4 remarksLabel cigna-fg-blue-medium fontSize14" >
                                                        {!$Label.Maximum_USD}
                                                        <span>
                                                           <apex:outputText id="opMaxSingle" value="{0, number, ###,##0.00}">
                                                                <apex:param value="{!MaxSingle}"/>
                                                            </apex:outputText>
                                                        </span>
                                                    </div>
                                                    <div class="bs col-sm-5" >
                                                        <apex:input value="{!withdrawSingle}" id="withdraw-input-check-maximum-single" styleClass="form-field-style" onkeyup="calc3NegativeValue()" />
                                                    </div>
                                                </div>                                          
                                                <div id="partialTableErrorDiv" class="errorDiv" style="display:none;">
                                                    <label class="cusError" id="partialTableErrorMes" ></label>
                                                </div>
                                            </div> 
                                        </apex:outputPanel>
                                        
                                    </div>
                                </div>  
                            </div> 
                           
                            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                <div class="bs col-sm-3">{!$Label.Payment_Instruction}</div>
                                <div class="bs col-sm-9">
                                    <select id="withdraw-select-payment" class="bs form-field-style-select onclick-pointer" onChange="refresh(this);showRemarks(this);hideChequeTab(this);clearThisError(this);"> <!--  -->
                                        <option value="" selected="selected">{!$Label.Please_Select}</option>
                                        <option value="#directTab">{!$Label.Direct_Account_Transfer_in_HKD}</option>
                                        <option value="#chequeTab">{!$Label.Cheque}</option>
                                    </select>
                                    <apex:inputHidden value="{!withdrawPaymentMethod}" id="withdrawPaymentMethod"/>
                                    <p class="remarksLabel cigna-fg-orange-dark fontSize12" id="paymentMethodRemarks" style="display:none;"></p>
                                    <label class="cusError duplicateError" id="paymentTypeErrorMes" style="margin-top:5px;display:none;" ></label>
                                    <p />
                                </div>
                            </div> 
                            
                            <!-- Nav tabs -->
                            <ul class="bs nav nav-pills" role="tablist" style="display:none">
                                <li role="presentation" class="bs active">
                                    <a id="directTab" href="#direct" aria-controls="direct" role="tab" data-toggle="tab">{!$Label.Direct_Account_Transfer_in_HKD}</a>
                                </li>
                                <li role="presentation" class="bs hidden-xs hidden-sm">
                                    <a id="chequeTab" href="#cheque" aria-controls="cheque" role="tab" data-toggle="tab">{!$Label.Cheque}</a>
                                </li>
                                <!-- Mobile Dropdown -->
                                <li role="presentation" class="bs dropdown visible-xs visible-sm">
                                    <ul class="bs dropdown-menu dropdown-menu-right" style="right: -60pt;">
                                        <li>
                                            <a href="#directTab" aria-controls="direct" role="tab" data-toggle="tab">{!$Label.Direct_Account_Transfer_in_HKD}</a>
                                        </li>
                                        <li>
                                            <a href="#chequeTab" aria-controls="cheque" role="tab" data-toggle="tab">{!$Label.Cheque}</a>
                                        </li>
                                        <li role="separator" class="divider"></li>
                                    </ul>
                                </li>
                            </ul>
                            
                            <div class="bs tab-content" style="padding-top:10px;">
                                <div id="direct"  class="tab-pane fade in active bs col-lg-offset-0 col-sm-offset-0">
                                </div>
                                <div id="cheque"  class="tab-pane fade">
                                    <apex:outputPanel id="chequePanel">
                                        <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                                            <div class="col-sm-9 col-sm-offset-3">
                                                <div class="bs row form-field">
                                                    <div class="bs col-sm-3">{!$Label.Delivery_Option}</div>
                                                    <div class="bs col-sm-9">
                                                        <select id="withdraw-select-delivery" class="bs form-field-style-select onclick-pointer" onChange="clearThisError(this);showDeliveryRemarks(this);"> <!--  -->
                                                                <option value="" selected="selected">{!$Label.Please_Select}</option>
                                                                <option value="Delivered By Financial Consultant">{!$Label.Delivered_By_Financial_Consultant}</option>
                                                                <option value="Sent By Surface Mail to Policy Holder Address">{!$Label.Sent_By_Surface_Mail_to_Policy_address}</option>
                                                                <!--<option value="pickUp">{!$Label.Picked_Up_By_Myself}</option>-->
                                                        </select>
                                                        <label class="cusError duplicateError" id="deliveryErrorMes" style="margin-top:5px;display:none;" ></label>
                                                        <apex:inputHidden value="{!withdrawDeliveryMethod}" id="withdrawDeliveryMethod"/>
                                                    </div>
                                                </div> 
                                                <div class="bs row form-field" id="deliveryRemarks" style="display:none;">
                                                    <div class="bs col-sm-3">{!$Label.Day_Time_Contact_No}</div>
                                                    <div class="bs col-sm-9">
                                                        <span class="bs col-xs-4 col-sm-2" style="padding-left:0px !important;">
                                                            <apex:input id="withdraw-input-required-daytime-contact-country-code" type="tel" html-placeholder="+852" 
                                                                value="{!dayTimeContactCountryCode}" styleclass="form-field-style" />
                                                        </span>
                                                        <span class="bs col-xs-8 col-sm-10" style="padding-right:0px !important;">
                                                            <apex:input id="withdraw-input-required-daytime-contact-no-number" type="tel" 
                                                                value="{!dayTimeContact}" styleclass="form-field-style" />
                                                        </span>
                                                    </div>
                                                </div> 
                                                
                                                <div class="bs row form-field">
                                                    <div class="bs col-sm-3">{!$Label.Cheque_Currency}</div>
                                                    <div class="bs col-sm-9">
                                                        <select id="withdraw-select-currency" class="bs form-field-style-select onclick-pointer" onChange="showInputBank(this);clearThisError(this);">
                                                                <option value="" selected="selected">{!$Label.Please_Select}</option>
                                                                <option value="HKD">{!$Label.HKD}</option>
                                                                <option value="USD">{!$Label.USD}</option>
                                                        </select>
                                                        <apex:inputHidden value="{!chequeCurrency}" id="chequeCurrency"/>
                                                        <label class="cusError duplicateError" id="chequeCurrencyErrorMes" style="margin-top:5px;display:none;" ></label>
                                                        <!--
                                                        <p class="remarksLabel cigna-fg-blue-medium fontSize14" id="chequeCurrencyRemarks" >
                                                            <div class="bs row">
                                                                <div class="bs col-sm-3">{!$Label.Location_of_bank}</div>
                                                                <div class="bs col-sm-9">
                                                                    <apex:inputText value="{!bankName}" styleClass="bs form-field-style"/>
                                                                </div>
                                                            </div>
                                                        </p>
                                                        -->
                                                    </div>
                                                </div>
                                                
                                                <div class="bs row form-field" style="display:none;" id="withdraw-bank-location-div">
                                                    <div class="bs col-sm-3">{!$Label.Location_of_bank}</div>
                                                    <div class="bs col-sm-9">
                                                        <apex:inputText value="{!bankName}" styleClass="bs form-field-style" id="withdraw-input-required-bank-location"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                </div>
                            </div>
                            
                            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-field">
                                <div class="bs col-sm-12 form-field">
                                    {!$Label.Please_at_least_upload_one_of_the_following_documents}
                                </div>           
                                <div class="bs col-sm-12">
                                    <div id="errFileSize" class="alert alert-danger" role="alert" style="display:none;">
                                        <span class="ci-hk-caution" aria-hidden="true"></span>
                                        {!$Label.File_size_exceeds_10M}
                                    </div>
                                    <div id="errFileType" class="alert alert-danger" role="alert" style="display:none;">
                                        <span class="ci-hk-caution" aria-hidden="true"></span>
                                        {!$Label.Please_upload_a_valid_file} (i.e. .docx/.doc/.pdf/.jpeg/.png/.tiff)
                                    </div>
                                </div>
                                <apex:actionFunction name="refreshAttlist" rerender="hkidlist" />
                                <apex:actionFunction name="removeAtt" action="{!removeAtt}" rerender="hkidlist">
                                    <apex:param name="id" value="" assignTo="{!removeAttId}"/>
                                </apex:actionFunction>
                                
                                <apex:outputPanel id="uploadPanel">
                                    <script>
                                        //CR-56_Link_20220214
                                        $('[data-toggle="tooltip"]').tooltip();
                                        
                                    </script>
                                    <div class="bs col-sm-12 form-field">
                                        <div id="uploadHKIDlist">
                                            <apex:outputPanel id="hkidlist">
                                                <div class="bs row"> <!--  content-choice-noUnderLine ?? -->
                                                    <div class="col-xs-2 col-sm-1">
                                                        <input id="FundWithdrawAddressAtt" type="file" multiple="multiple" class="fileInput" onchange="uploadFile('{!claimId}','FundWithdrawAddressAtt');" style="display:none;"/>
                                                        <label for="FundWithdrawAddressAtt" ><i class="ci-hk-outbox content-icon onclick-pointer" aria-hidden="true" /></label>
                                                    </div>
                                                
                                                    <div class="col-xs-8 col-sm-10">{!IF(isBroker,  $Label.Your_Customer_Address_Proof, $Label.Your_Address_Proof)}</div>
                                                    <div class="col-xs-2 col-sm-1"><i class="ci-hk-help helptext-icon pull-right" data-toggle="tooltip" title="{!$Label.Upload_Tooltip}" aria-hidden="true"></i></div>
                                                </div>
                                                
                                                <apex:repeat value="{!AddressAtt}" var="addAtt">
                                                    <div class="col-xs-10 col-sm-11 col-xs-offset-2 col-sm-offset-1 form-field">
                                                        {!addAtt.Name}
                                                        <i class="ci-hk-x pull-right onclick-pointer" onclick="removeAttachment('{!addAtt}');" aria-hidden="true"></i>
                                                    </div>
                                                </apex:repeat>
                                                
                                                <div class="bs row">
                                                    <div class="col-xs-2 col-sm-1">
                                                        <input id="FundWithdrawIdCopyAtt" type="file" multiple="multiple" class="fileInput" onchange="uploadFile('{!claimId}','FundWithdrawIdCopyAtt');" style="display:none;"/>
                                                        <label for="FundWithdrawIdCopyAtt" ><i class="ci-hk-outbox content-icon onclick-pointer" aria-hidden="true" /></label>
                                                    </div>
                                                
                                                    <div class="col-xs-8 col-sm-10">{!IF(isBroker,$Label.Your_Customer_ID_Copy,$Label.Your_ID_Copy)}</div>
                                                    <div class="col-xs-2 col-sm-1"><i class="ci-hk-help helptext-icon pull-right" data-toggle="tooltip" title="{!$Label.Upload_Tooltip}" aria-hidden="true"></i></div>
                                                </div>
                                                <apex:repeat value="{!IdCopyAtt}" var="hkidAtt">
                                                    <div class="col-xs-10 col-sm-11 col-xs-offset-2 col-sm-offset-1  form-field">
                                                        {!hkidAtt.Name}
                                                        <i class="ci-hk-x pull-right onclick-pointer" onclick="removeAttachment('{!hkidAtt}');" aria-hidden="true"></i>
                                                    </div>
                                                </apex:repeat>
                                                
                                                
                                                <script>
                                                    
                                                    function checkUploadFile(){
                                                        var pass = false;
                                                        
                                                        console.log('{!AllAtt.size}');
                                                        if('{!AllAtt.size}' > 0){
                                                            pass = true;
                                                            $('#uploadDocErrorMesDiv').hide();
                                                        }
                                                        else{
                                                            $('#uploadDocErrorMesDiv').show();
                                                        }
                                                        
                                                        return pass;
                                                    }
                                                    
                                                </script>
                                                
                                             </apex:outputPanel>    
                                        </div>
                                    </div>
                                </apex:outputPanel>
                            </div>
                            
                            <!-- Error Message -->
                            <div id="uploadDocErrorMesDiv" class="errorDiv bs col-xs-12 col-sm-10 col-sm-offset-1 form-field" style="display:none;">
                                <div class="bs col-xs-12" >
                                    <label class="cusError" id="uploadDocErrorMes" >
                                        {!$Label.Error_Message_Upload_At_Least_One_Document}
                                    </label>
                                </div>
                            </div>
                            
                            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-group">
                                <div class="bs col-sm-12"><apex:outputLabel >{!$Label.Fund_Withdrawal_Note}:</apex:outputLabel></div>
                                <div class="bs col-sm-12 fontWeightNormal">
                                    <apex:outputLabel > 1. {!$Label.Fund_Withdrawal_Note_Content_1}</apex:outputLabel><br/>
                                    <apex:outputLabel > 2. {!$Label.Fund_Withdrawal_Note_Content_2}</apex:outputLabel><br/>
                                    <!-- <apex:outputLabel > 3. {!$Label.Fund_Withdrawal_Note_Content_3}</apex:outputLabel><br/> Zoe updated on 0614, PPCP30 -->
                                    <apex:outputLabel > 3. {!$Label.Fund_Withdrawal_Note_Content_4}</apex:outputLabel><br/>
                                </div>
                            </div> 
                        </div>
                        <div id="notAllowToWithdraw" class="bs col-xs-12 col-sm-10 col-sm-offset-1 form-group" style="display:none;">
                            {!$Label.Not_eligible_to_withdraw_fund}
                        </div>
                    
                    </apex:outputPanel>
                    
                </div>
                <!-- End of Customer Fund Withdrawal -->
                
                <!-- Start Special Centered Box -->
                <apex:inputHidden id="selectedTab" value="{!selectedTab}"/>
                <div id="reallocationOverlayFM" style="display:none;">
                    <div id="reallocationSpecialBoxFM">
                      <a><div id="reallocationCloseOverlayFM" class="onclick-pointer ci-hk-x" onclick="reallocationToggleOverlayFM();"></div></a>
                        <h4>{!$Label.Terms_and_Conditions}</h4>
                        <div style="padding-bottom:10px; border-top: 1px solid #f2f2f2;"></div>
                        <div id="reallocationtccontentFM" style="text-align:left">
                            <div id="Switching-TC-Customer" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Investment Choice Switching 
                                    <br/><br/>
                                    This instruction will change the Investment Choices, being invested in, allocated under your Policy Account.  Appropriate investment Units allocated under your Policy Account will be sold in accordance with your instruction in order to buy the designated investment Units.  The premium allocation instruction will remain unchanged.
                                    <br/><br/>
                                    By providing this service, Cigna Worldwide Life Insurance Company Limited ("Cigna") is not inviting or recommending any person or entity to invest.  The information on this website should not be construed as a prospectus for the purchase or sale of such investment. 
                                    <br/><br/>
                                    Please refer to the Terms of our online services.  By accessing this website and/or using the services offered through this website, you shall be deemed to have read and agree to the related terms. 
                                    <br/><br/>
                                    Investment involves risks and that the value of the investments and the yield from our investment linked assurance schemes may go down as well as up as a consequence of the general nature of varied investments and possible exchange or interest rate fluctuations. Past performance is not indicative of future performance.
                                    <br/><br/>
                                    Your request will be processed on the next business day if it is submitted on
                                    <!--Added by Terry on 20180412 start-->
                                    or before 3:00 pm on a business day, Hong Kong Time.  Any request submitted after 3:00 pm on a business day, Hong Kong Time, will be processed on the                                                                    
                                    <!-- or before 6:00 pm on a business day, Hong Kong Time.  Any request submitted after 6:00 pm on a business day, Hong Kong Time, will be processed on the -->
                                    <!--Added by Terry on 20180412 end-->
                                    business day after next.  If your request is submitted on a Saturday or a holiday, your request will be processed on the business day after next. 
                                    <br/><br/>
                                    Subject to the terms and conditions of the policy provisions, investment choice switching orders will be processed, after Cigna has received and approved your application.  We will sell your specified number of units in the old investment choice(s) on the following valuation date and deduct the fund switching charge (if any) from the sale proceeds; and we will buy specified number of units in the new investment choice(s) on the following valuation date with the sale proceeds (net of any fund switching charge). 
                                    <br/><br/>
                                    Subject to our Companys approval process, a) we will review your Investment Choice Switching instructions as soon as possible, and b) the switching process will be subsequent to the completion of all relevant transactions. 
                                    <br/><br/>
                                    However, Cigna shall not be liable for any delay in processing any instruction. 
                                    <br/><br/>
                                    Note: You can enjoy up to 5 times free switching per policy year.  Any subsequent switching is subject to switching fee which is USD35 or HKD280 each time.  
                                    <br/><br/>
                                    Pursuant to the anti-money laundering and counter-terrorist financing law and regulations, we are required to verify customers identity and address and ensure the customer information remains up-to-date and relevant.
                                    <br/><br/>
                                    (1)Please submit certified true copies* of the Policyholders (i) valid identity document and (ii) proof of residential address and permanent address, if different from residential address, issued in the last 3 months, unless submitted before.
                                    <br/><br/>
                                    (2)Please notify us of any change in customer identification information.  We should treat your information as remaining unchanged from our latest record unless we receive your notice of change.
                                    <br/><br/>
                                    * Certified by suitable certifiers (e.g. authorized insurance brokers, appointed insurance agents or other professional third parties)
                                    <br/><br/><br/>
                                    Means of submission:
                                    <br/><br/>
                                    -Email to <span style="color:#337ab7;">dochk@cigna.com</span> (only for collecting copies of identify document and address proof);
                                    <br/><br/>
                                    -Fax to 2967 3515;
                                    <br/><br/>
                                    -Submit by post or by hand to our office at {!$Label.Cigna_Address_en} (Office hours: 9:00am - 5:30pm from Monday to Friday except Public Holiday)
                                    <br/><br/>
                                    </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    
                                    <br/><br/><br/>
                                    <!--Added by Terry on 20180412 start-->
                                    <!--66-->                                  
                                    33                                   
                                    
                                    <!--Added by Terry on 20180412 end-->
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    a)b)
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    : 535280  
                                    <br/><br/>
                                    
                                    <br/><br/>
                                     (i)  (ii) 3 () * () 
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    * ()
                                    <br/><br/>
                                    <span style="color:#337ab7;">dochk@cigna.com</span>2967 3515
                                    <br/><br/>
                                    {!$Label.Cigna_Address_zh}
                                </apex:outputPanel>
                            </div>
                            <div id="Reallocation-TC-Customer" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Future Premium Re-allocation 
                                    <br/><br/>
                                    This instruction will change the premium allocation instruction of your future premiums.  The existing investment choice balances of your Policy Account will remain unchanged. 
                                    <br/><br/>
                                     Your request will be processed on the next business day if it is submitted on 
                                    <!--Added by Terry on 20180413 start-->
                                    <!-- 
                                    or before 6:00 pm on a business day, Hong Kong Time.  Any request submitted after 6:00 pm on a business day, Hong Kong Time, will be processed on the
                                    -->

                                    or before 3:00 pm on a business day, Hong Kong Time.  Any request submitted after 3:00 pm on a business day, Hong Kong Time, will be processed on the 
                                    <!--Added by Terry on 20180413 end-->
                                    business day after next.  If your request is submitted on a Saturday or a holiday, your request will be processed on the business day after next. 
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    
                                    <br/><br/>
                                    
                                    <br/><br/>
                                    <!--Added by Terry on 20180413 start-->
                                    <!-- 
                                    66
                                    -->
                                    33
                                    <!--Added by Terry on 20180413 end-->

                                    
                                </apex:outputPanel>
                            </div>
                            <div id="Withdrawal-TC-Customer" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Remarks
                                    <br/><br/>
                                    Please note that investment involves risks and that the value of the investments and the yield from our investment linked insurance plans may go down as well as up as a consequence of the general nature of varied investments and possible exchange or interest rate fluctuations. The fund prices shown above are not indicative of future performance of the plans. These funds are the investment options of several CIGNA Worldwide Life Insurance Company Limited investment linked insurance plans. Please read the fund information in conjunction with the CIGNA Funds brochure and the related principle brochure of related insurance plans.
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    
                                    <br/><br/>
                                    
                                </apex:outputPanel>
                            </div>
                            <div id="Switching-TC-Broker" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Investment Choice Switching<br/><br/>
                                    This instruction will change the Investment Choices, being invested in, allocated under your Policy Account.  Appropriate investment Units allocated under your Policy Account will be sold in accordance with your instruction in order to buy the designated investment Units.  The premium allocation instruction will remain unchanged.<br/><br/>
                                    By providing this service, Cigna Worldwide Life Insurance Company Limited ("Cigna") is not inviting or recommending any person or entity to invest.  The information on this website should not be construed as a prospectus for the purchase or sale of such investment.<br/><br/>
                                    Please refer to the Terms of our online services.  By accessing this website and/or using the services offered through this website, you shall be deemed to have read and agree to the related terms.<br/><br/> 
                                    Investment involves risks and that the value of the investments and the yield from our investment linked assurance schemes may go down as well as up as a consequence of the general nature of varied investments and possible exchange or interest rate fluctuations. Past performance is not indicative of future performance.<br/><br/>
                                    Your request will be processed on the next business day if it is submitted on or before 6:00 pm on a business day, Hong Kong Time.  Any request submitted after 6:00 pm on a business day, Hong Kong Time, will be processed on the business day after next.  If your request is submitted on a Saturday or a holiday, your request will be processed on the business day after next.<br/><br/> 
                                    Subject to the terms and conditions of the policy provisions, investment choice switching orders will be processed, after Cigna has received and approved your application.  We will sell your specified number of units in the old investment choice(s) on the following valuation date and deduct the fund switching charge (if any) from the sale proceeds; and we will buy specified number of units in the new investment choice(s) on the following valuation date with the sale proceeds (net of any fund switching charge).<br/><br/> 
                                    Subject to our Companys approval process, a) we will review your Investment Choice Switching instructions as soon as possible, and b) the switching process will be subsequent to the completion of all relevant transactions.<br/><br/>
                                    However, Cigna shall not be liable for any delay in processing any instruction.<br/><br/> 
                                    Note: You can enjoy up to 5 times free switching per policy year.  Any subsequent switching is subject to switching fee which is USD35 or HKD280 each time.<br/><br/>  
                                    Pursuant to the anti-money laundering and counter-terrorist financing law and regulations, we are required to verify customers identity and address and ensure the customer information remains up-to-date and relevant.<br/><br/>
                                    (1)Please submit certified true copies* of the Policyholders (i) valid identity document and (ii) proof of residential address and permanent address, if different from residential address, issued in the last 3 months, unless submitted before.<br/><br/>
                                    (2)Please notify us of any change in customer identification information.  We should treat your information as remaining unchanged from our latest record unless we receive your notice of change.<br/><br/>
                                    * Certified by suitable certifiers (e.g. authorized insurance brokers, appointed insurance agents or other professional third parties)<br/><br/><br/>
                                    Means of submission:<br/><br/>
                                    -Email to <span style="color:#337ab7;">dochk@cigna.com</span> (only for collecting copies of identify document and address proof);<br/><br/>
                                    -Fax to 2967 3515;<br/><br/>
                                    -Submit by post or by hand to our office at {!$Label.Cigna_Address_en} (Office hours: 9:00am - 5:30pm from Monday to Friday except Public Holiday)<br/><br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    <br/><br/>                                    <br/><br/>
                                    <br/><br/>
                                    <br/><br/>                                    <br/><br/><br/>                               66<br/><br/>                              <br/><br/>
                                    a)b)<br/><br/>
                                    <br/><br/>
                                    : 535280<br/><br/>  
                                    <br/><br/>
                                     (i)  (ii) 3 () * () <br/><br/>
                                    <br/><br/>
                                    * ()<br/><br/>
                                    <span style="color:#337ab7;">dochk@cigna.com</span>2967 3515<br/><br/>
                                    {!$Label.Cigna_Address_zh}<br/><br/>
                                </apex:outputPanel>
                            </div>
                            <div id="Reallocation-TC-Broker" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Future Premium Re-allocation<br/><br/>
                                    This instruction will change the premium allocation instruction of your future premiums.  The existing investment choice balances of your Policy Account will remain unchanged.<br/><br/> 
                                    Your request will be processed on the next business day if it is submitted on or before 6:00 pm on a business day, Hong Kong Time.  Any request submitted after 6:00 pm on a business day, Hong Kong Time, will be processed on the business day after next.  If your request is submitted on a Saturday or a holiday, your request will be processed on the business day after next.<br/><br/> 
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    <br/><br/>
                                    <br/><br/>                                   66<br/><br/>
                                </apex:outputPanel>
                            </div>
                            <div id="Withdrawal-TC-Broker" style="display:none;">
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                    Remarks<br/><br/>
                                    Please note that investment involves risks and that the value of the investments and the yield from our investment linked insurance plans may go down as well as up as a consequence of the general nature of varied investments and possible exchange or interest rate fluctuations. The fund prices shown above are not indicative of future performance of the plans. These funds are the investment options of several CIGNA Worldwide Life Insurance Company Limited investment linked insurance plans. Please read the fund information in conjunction with the CIGNA Funds brochure and the related principle brochure of related insurance plans.<br/><br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                    <br/><br/>                                   <br/><br/>
                                </apex:outputPanel>
                            </div>
                        </div>
                    </div>
               </div>
               <!-- End Special Centered Box -->
                
            <!-- </div>  -->
            <div class="bs col-xs-12 col-sm-10 col-sm-offset-1" id="acceptTCDiv">
               <div id="picErrorDiv-Switching" class="errorDiv form-field" style="display:none;">
                    <label class="cusError"  style="{!IF(!isBroker,'','display:none;')}" id="picErrorMes-Switching">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions}
                    </label>

                    <label class="cusError" style="{!IF(isBroker,'','display:none;')}">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions_Broker}
                    </label>
                </div>
                
                <div id="picErrorDiv-Reallocation" class="errorDiv form-field"  style="display:none;">
                    <label class="cusError" style="{!IF(!isBroker,'','display:none;')}" id="picErrorMes-Reallocation">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions}
                    </label>

                    <label class="cusError" style="{!IF(isBroker,'','display:none;')}">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions_Broker}
                    </label>
                </div>
                
                <div id="picErrorDiv-Withdrawal" class="errorDiv form-field" style="display:none;">
                    <label class="cusError" style="{!IF(!isBroker,'','display:none;')}" id="picErrorMes-Withdrawal">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions}
                    </label>

                    <label class="cusError" style="{!IF(isBroker,'','display:none;')}">
                      {!$Label.Error_Message_Accept_Terms_and_Conditions_Broker}
                    </label>
                </div>
                
                <div id="Accept-TC-Switching" style="display:none;">
                    <div id="pics-section-Switching" >
                        <div class="bs cigna-fg-gray-dark fontWeightNormal form-field">  
                            
                            <p>
                                <input type="checkbox" id="dm-consent-Switching" name="dm-consent-Switching" class="bs cigna-question-checkbox" onchange="$(this).parent().siblings('input').val($(this).is(':checked'));" />
                                <label for="dm-consent-Switching" style="display: inline !important;float:left;"></label>
                                <label style="cursor:default;display: inline !important;font-size: 0.9em;">
                                  {!IF(isBroker,$Label.Esginature_TandC_I_accept,$Label.I_accept_the)}&nbsp;
                                  <a class="onclick-pointer" onclick="getOverlayContent();reallocationToggleOverlayFM()">{!$Label.Footer_Terms_Conditions}</a>.
                                </label>
                            </p>
                            
                            <apex:inputHidden value="{!paramDMConsentSwitching}" id="paramDMConsent-Switching" />
                        </div>
                    </div>
                </div>
                <div id="Accept-TC-Reallocation" style="display:none;">
                    <div id="pics-section-Reallocation" >
                        <div class="bs cigna-fg-gray-dark fontWeightNormal form-field">  
                            
                            <p>
                                <input type="checkbox" id="dm-consent-Reallocation" name="dm-consent-Reallocation" class="bs cigna-question-checkbox" onchange="$(this).parent().siblings('input').val($(this).is(':checked'));" />
                                <label for="dm-consent-Reallocation" style="display: inline !important;float:left;"></label>
                                <label style="cursor:default;display: inline !important;font-size: 0.9em;">
                                  {!IF(isBroker,$Label.Esginature_TandC_I_accept,$Label.I_accept_the)}&nbsp;
                                  <a class="onclick-pointer" onclick="getOverlayContent();reallocationToggleOverlayFM()">{!$Label.Footer_Terms_Conditions}</a>.
                                </label>
                            </p>
                            
                            <apex:inputHidden value="{!paramDMConsentReallocation}" id="paramDMConsent-Reallocation" />
                        </div>
                    </div>
                </div>
                
                <div id="Accept-TC-Withdrawal" style="display:none;">
                    <div id="pics-section-Withdrawal">
                        <div class="bs cigna-fg-gray-dark fontWeightNormal form-field">  
                            
                            <p>
                                <input type="checkbox" id="dm-consent-Withdrawal" name="dm-consent-Withdrawal" class="bs cigna-question-checkbox" onchange="$(this).parent().siblings('input').val($(this).is(':checked'));" />
                                <label for="dm-consent-Withdrawal" style="display: inline !important;float:left;"></label>
                                <label style="cursor:default;display: inline !important;font-size: 0.9em;">
                                  {!IF(isBroker,$Label.Esginature_TandC_I_accept,$Label.I_accept_the)}&nbsp;
                                  <a class="onclick-pointer" onclick="getOverlayContent();reallocationToggleOverlayFM()">{!$Label.Footer_Terms_Conditions}</a>.
                                </label>
                            </p>
                            
                            <apex:inputHidden value="{!paramDMConsentWithdrawal}" id="paramDMConsent-Withdrawal" />
                        </div>
                    </div>
                </div>
                
                
            </div>
            
            <!-- First Step Button -->
            <div class="bs col-sm-12 col-xs-12" id="firstStepSubmitDiv">
                
                <div style="padding:20px;"></div>
                <!--desktop action button-->
                <div id="firstbtnsm" class="bs hidden-xs col-sm-4 col-sm-offset-4 cigna-fg-white cigna-bg-orange-dark desktop-action-btn onclick-pointer" onclick="SubmitFiledValidation();rerenderConfirmationAfterValidation()"> <!-- onclick="submitRequest()" rerenderConfirmation()--> 
                    {!$Label.Submit}
                </div>
                    
                <!--mobile action button-->    
            
                <div id="mobile-app-padding" class="bs row" style="display: none; padding-bottom: 100px;">
                    <div class="bs col-xs-12"></div>
                </div>
                
                <div id="firstStepDiv" class="bs" style="display:none;">
                  <div id="action-bar" class="bs visible-xs cigna-floating-bottom-panel" style="left:0px;">
                      <div id="firstbtnxs" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark onclick-pointer" onclick="SubmitFiledValidation();rerenderConfirmationAfterValidation()"> 
                          <a class="action-btn cigna-fg-white" role="button"><span class="ci-hk-arrow-31" aria-hidden="true"></span><br/><span id="firstbtnxstext">{!$Label.Submit}</span></a>
                      </div>
                  </div>
                </div>
                
            </div>
        </div>
        <!-- End of First Step Form -->

        <!-- Start of Details Confirmation Page -->
        <div class="bs content-step col-xs-12 col-sm-10 col-sm-offset-1" data-step="2" style="display:none;" id="detailsConfirmationPage">
            <apex:outputPanel id="confirmationPanel">
              <!-- 20200306 - minghua - ILAS -->
              <input type="hidden" id="showRPQWarningMessage" value="{!isShowRPQWarningMessage}" />
              <input type="hidden" id="showRPQOnlinePanel" value="{!isShowRPQOnlinePanel}" />
              <apex:inputHidden value="{!request.Reason_checkbox__c}" id="fund-reasonCheckbox" />
              <apex:inputHidden value="{!request.Reason_content__c}" id="fund-ReasonContent" />
                <div class="bs row">
                    <div id="headeraction" class="bs header-action">
                        <div id="secondStepback" class="bs col-xs-6 col-sm-6 form-field"><!-- 20200306 - minghua - ILAS -->
                            <a href="#" onclick="previousStep()" class="bs cigna-fg-orange-medium pull-left"> <!-- onclick="detailsConfirmationBack()"  -->
                                <i class="ci-hk-arrow-29" aria-hidden="true"></i> {!$Label.Back}
                            </a>
                        </div>

                        <!-- 20200306 - minghua - ILAS -->
                        <div id="save" class="bs col-xs-6 col-sm-6" style="display: {!IF(isBroker,'none','block')}">
                            <a href="javascript:void(0);" id="fundSaveDraftBtn" class="bs cigna-fg-orange-medium pull-right onclick-pointer" style="margin-right: -10px;" >
                                {!$Label.Save} <i class="ci-hk-briefcase" aria-hidden="true" style="font-weight:bold;"></i> 
                            </a>
                        </div>
                    </div>
                    
                    <!-- Start of Fund Switch Details Confirmation -->
                    <div id="fund-switch-details-confirmation" style="display:none;">
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-12 cigna-fg-blue-light content-highlight">{!$Label.Confirmation_of_Fund_Switching}</div>
                        </div>
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-2 col-sm-1">{!$Label.X1}</div>
                            <div class="bs col-xs-10 col-sm-11">{!$Label.Plan_Selected}</div>
                            <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight">{!selectSwitchType}</div>
                        </div>
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-2 col-sm-1">{!$Label.X2}</div>
                            <div class="bs col-xs-10 col-sm-11">{!$Label.Fund_s_to_sell}</div>
                            <apex:repeat value="{!currentFundList}" var="fundWrapper">
                                <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight form-field" 
                                     style="{!IF(fundWrapper.amount != null && fundWrapper.amount != '' && fundWrapper.amount != '0', '', 'display:none;')}">
                                    <div class="bs row">
                                        <div class="bs col-xs-12 cigna-fg-green-medium content-highlight">{!fundWrapper.fund.productFullName}</div> 
                                        <div class="bs col-xs-12 content-highlight">{!fundWrapper.amount} {!fundWrapper.switchOutType}</div> 
                                    </div>
                                </div>
                            </apex:repeat>
                        </div>
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-2 col-sm-1">{!$Label.X3}</div>
                            <div class="bs col-xs-10 col-sm-11">{!$Label.Fund_s_to_buy}</div>
                            <apex:variable var="confirmSwitchInCount" value="{!1}" />
                            <apex:repeat value="{!switchInList}" var="fund">
                                <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight form-field">
                                    <div class="bs row">
                                        <div class="bs col-xs-12 cigna-fg-green-medium content-highlight">{!confirmSwitchInCount}. {!fund.fundFullName}</div> 
                                        <div class="bs col-xs-12 content-highlight">{!fund.amount}%</div> 
                                    </div>
                                </div>
                                <apex:variable var="confirmSwitchInCount" value="{!confirmSwitchInCount + 1}" />
                            </apex:repeat>
                            
                        </div>
                    </div>
                    
                    <!-- End of Fund Switch Details Confirmation -->
                    
                    <!-- Start of Fund Reallocation Details Confirmation -->
                    <div id="fund-reallocation-details-confirmation" style="display:none;">
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-12 cigna-fg-blue-light content-highlight">{!$Label.Confirmation_of_Fund_Reallocation}</div>
                        </div>
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-2 col-sm-1">{!$Label.X1}</div>
                            <div class="bs col-xs-10 col-sm-11">{!$Label.Plan_Selected}</div>
                            <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight">{!selectReallocationType}</div>
                        </div>
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-2 col-sm-1">{!$Label.X2}</div>
                            <div class="bs col-xs-10 col-sm-11">{!$Label.Fund_s_to_buy}</div>
                            <apex:variable var="confirmReallocationCount" value="{!1}" />
                            <apex:repeat value="{!reallocationList}" var="fund">
                                <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight form-field">
                                    <div class="bs row">
                                        <div class="bs col-xs-12 cigna-fg-green-medium content-highlight">{!confirmReallocationCount}. {!fund.fundFullName}</div> 
                                        <div class="bs col-xs-12 content-highlight">{!fund.amount}%</div> 
                                    </div>
                                </div>
                                <apex:variable var="confirmReallocationCount" value="{!confirmReallocationCount + 1}" />
                            </apex:repeat>
                            <!--
                            <div class="bs col-xs-10 col-xs-offset-2 col-sm-11 col-sm-offset-1 content-highlight form-field">
                                <div class="bs row">
                                    <div class="bs col-xs-12 cigna-fg-green-medium content-highlight">1. Cigna - Aberdeen Gbl American Equity Fund</div> 
                                    <div class="bs col-xs-12 content-highlight">100%</div> 
                                </div>
                            </div>
                            -->
                        </div>
                    </div>
                    <!-- End of Fund Reallocation Details Confirmation -->
                    
                    
                    <!-- Start of Fund Withdrawal Details Confirmation -->
                    <div id="fund-withdrawal-details-confirmation" style="display:none;">
                        <!-- 
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-12 cigna-fg-blue-light content-highlight">{!$Label.Confirmation} of Fund Withdrawal</div>
                            <div class="bs col-xs-12"> TBD </div>
                        </div>
                        -->
                    </div>
                    <!-- End of Fund Withdrawal Details Confirmation -->
                    
                    <!-- 20200306 - minghua - ILAS -->
                    <div id="fund-risk-choose" style="display:none;text-align: center;">
                        <div class="bs col-xs-12 form-field">
                            <div class="bs col-xs-12">{!transField['Your_Risk_Profile_was'][$Label.Header_Language_Code_Current]} <a class="onclick-pointer">{!transField['Personal_Risk_Questionnaire'][$Label.Header_Language_Code_Current]}</a> {!transField['refresh_your_risk_profile'][$Label.Header_Language_Code_Current]}</div>
                            <div class="bs col-xs-12 cigna-fg-blue-light content-highlight">{!transField['or'][$Label.Header_Language_Code_Current]}</div>
                            <div class="bs col-xs-12 cigna-fg-blue-light content-highlight"><a class="onclick-pointer" onclick="checkRPQStatus();">{!transField['continue_your_risk_profile'][$Label.Header_Language_Code_Current]}</a></div>
                        </div>
                    </div>
                    <div id="fund-show-warning-message" class="bs col-xs-12 form-field" style="display: none;">
                        <div class="bs col-xs-12 form-field">
                            {!transField['Please_note_your_current'][$Label.Header_Language_Code_Current]}{!latestRPQStatus}{!transField['which_is_lower_than'][$Label.Header_Language_Code_Current]} <a class="cigna-fg-blue-medium onclick-pointer" onclick="saveAndGoOnline();">{!transField['Personal_Risk_Questionnaire'][$Label.Header_Language_Code_Current]}</a> {!transField['refresh_your_risk_profile'][$Label.Header_Language_Code_Current]}<br />
                            <div style="text-align: center;" class="col-xs-12">{!transField['or'][$Label.Header_Language_Code_Current]}</div>
                            <div style="text-align: center;" class="col-xs-12"><a class="cigna-fg-blue-medium onclick-pointer" onclick="provideReason();">{!transField['continue_your_risk_profile'][$Label.Header_Language_Code_Current]}</a></div>
                        </div>
                        <div class="bs col-xs-12 form-field" id="provideReason" style="display: none;">
                            <span>{!transField['You_must_provide_your'][$Label.Header_Language_Code_Current]}</span><br/><br/>
                            <!--Nicole_ILAS CR_20201005-->
                            <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'en_US'}">
                                
                                <br/><br/>
                                
                                <br/>
                                X&nbsp;&nbsp;&nbsp;<br/>
                                X&nbsp;&nbsp;&nbsp;<br/>
                                X&nbsp;&nbsp;&nbsp;&nbsp; <br/>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!$Label.Header_Language_Code == 'zh_TW'}">
                                We strongly advise you to update your Risk Profile Questionnaire since the risk level of selected fund(s) is higher than your risk profile at our record. Such fund switching or subscription may not be in your best interest. However, if you still wish switching to the unmatched fund choice(s), you must provide a valid and sufficient reason on why you still decide to proceed.
                                <br/><br/>
                                Please note that the following explanations will NOT be accepted and your instruction will NOT be proceeded. In that case, we will suspend the application for further clarification and there may be financial implications to you.
                                Examples of invalid reasons:<br/>
                                X&nbsp;&nbsp;&nbsp;I don't want to perform the RPQ (Not explaining on why the unmatched fund is selected)<br/>
                                X&nbsp;&nbsp;&nbsp;This is my own decision (No detailed explanation on the decision)<br/>
                                X&nbsp;&nbsp;&nbsp;&nbsp;Any other reason without elaboration on the investment decision and indication of understanding and accepting the risk of purchasing a fund with risk level higher than your own.<br/>
                            </apex:outputPanel>
                            <br/>
                            <apex:inputTextarea id="switchReasonMessage" style="height: 100px;" styleClass="form-field-style-textarea" />
                        </div>
                        <div id="fund-show-input-div" class="errorDiv form-field">
                            <label class="cusError" id="fundInputErrorMes" ></label>
                        </div>
                        <div id="fund-show-checkbox-div" class="errorDiv form-field">
                            <label class="cusError" id="fundCheckBoxErrorMes" ></label>
                        </div>
                        <div class="bs col-xs-1">
                          <input type="checkbox" id="fund-switch-checkReason" name="fund-switch-checkReason" class="bs cigna-question-checkbox" />
                          <label for="fund-switch-checkReason" style="display: inline !important;float:left;"></label>
                        </div>
                        <div class="bs col-xs-11 col-sm-11" style="text-align: left;">
                          <div>
                           {!transField['Risks_related_to_select_fund'][$Label.Header_Language_Code_Current]}<br/>
                           <br/>
                            <div style="color: red">
                             {!transField['Below_are_the_mismatch'][$Label.Header_Language_Code_Current]}
                              <apex:repeat value="{!mismatchFundList}" var="mismatchFund">
                                <div>{!mismatchFund}</div>
                              </apex:repeat>
                              <br/>
                            </div>
                           {!transField['I_understand_that_the'][$Label.Header_Language_Code_Current]} {!transField['application_and_bear_the'][$Label.Header_Language_Code_Current]}
                          </div>
                        </div>
                    </div>
                    <!-- 20200306 - minghua - ILAS -->
                    <div id="detailsconfirmbtndiv"  class="bs col-xs-12 " style="display: none;">
                        <div style="padding:20px;"></div>
                        <!--desktop action button-->
                        <div id="detailsconfirmbtnsm" class="bs hidden-xs col-sm-4 col-sm-offset-4 cigna-fg-white cigna-bg-orange-dark desktop-action-btn onclick-pointer"> <!-- onclick="goToConfirmation();" -->
                            <!--Nicole_ILAS CR_20201005-->
                            <apex:outputText value="{!$Label.Confirm}" rendered="{!isBroker}"></apex:outputText>
                            <apex:outputText value="{!transField['RPQ_Confirm'][$Label.Header_Language_Code_Current]}" rendered="{!!isBroker}"></apex:outputText>
                        </div>
                            
                        <!--mobile action button-->    
                        
                        <div id="mobile-app-padding" class="bs row" style="display:none; padding-bottom:220px;">
                            <div class="bs col-xs-12"></div>
                        </div>
                        
                        <div id="secondStepDiv" style="display: none;">
                          <div id="action-bar" class="bs visible-xs cigna-floating-bottom-panel " style="left:0px;">
                              <div id="detailsconfirmbtnxs" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark onclick-pointer">
                                  <a class="action-btn cigna-fg-white" role="button"><span class="ci-hk-thumbs-up" aria-hidden="true"></span><br/>{!$Label.Confirm}</a>
                              </div>
                          </div>
                        </div>
                                        
                    </div>
                </div>
                <script>
                // 20200306 - minghua - ILAS
                function saveAndGoOnline(){
                  if (saveConfirmRecord(false)) {
                    onlineRPQ();
                  }
                }
                function clearErrorAllMes(){
                  $('#fund-show-input-div').hide();
                  $('#fundInputErrorMes').text('');
                  $('#fund-show-checkbox-div').hide();
                  $('#fundCheckBoxErrorMes').text('');
                }
                function checkInputValueAndGoNext(){
                  console.log('enter checkInputValueAndGoNext:');
                  var showwaingmes = false;
                  var checkTextarea = false;
                  var hasTextareaValue = false;
                  var textStr = '';
                  var warningMessage = document.getElementById('fund-show-warning-message');
                  var provideReason = document.getElementById('provideReason');
                  clearErrorAllMes();
                  if(warningMessage.style.display != "none"){
                    showwaingmes = true;
                    console.log('enter warning-message');
                  }

                  if (showwaingmes) {
                    if (provideReason.style.display == "none") {
                      $('#fund-show-input-div').show();
                      $('#fundInputErrorMes').text('{!transField["Please_click_Personal_Risk"][$Label.Header_Language_Code_Current]}');
                      return;
                    }
                    textStr = reasonMessageToShow.val();
                    if (validString(textStr)) {
                      hasTextareaValue = true;
                    }else{
                      //show error message
                      $('#fund-show-input-div').show();
                      $('#fundInputErrorMes').text('{!transField["Please_enter_all_characters"][$Label.Header_Language_Code_Current]}{!transField["please_check_the_existing"][$Label.Header_Language_Code_Current]}');
                      return;
                    }

                    if(checkReasonToShow.is(':checked')){
                      console.log('show checkReason');
                      checkTextarea = true;
                    }else{
                      //show error message
                      $('#fund-show-checkbox-div').show();
                      $('#fundCheckBoxErrorMes').text('please choose checkbox');
                      return;
                    }
                  }

                  $('input[type=hidden][id$=fund-reasonCheckbox]').val(checkTextarea);
                  $('input[type=hidden][id$=fund-ReasonContent]').val(textStr);
                  nextStep();
                }
                function saveConfirmRecord(type){
                  console.log('enter saveConfirmRecord:');
                  var showwaingmes = false;
                  var checkTextarea = false;
                  var textStr = '';
                  var warningMessage = document.getElementById('fund-show-warning-message');
                  var provideReason = document.getElementById('provideReason');
                  clearErrorAllMes();
                  if(warningMessage.style.display != "none"){
                    showwaingmes = true;
                    console.log('enter warning-message');
                  }

                  if (showwaingmes && type) {
                    if (provideReason.style.display == "none") {
                      $('#fund-show-input-div').show();
                      $('#fundInputErrorMes').text('{!transField["Please_click_Personal_Risk"][$Label.Header_Language_Code_Current]}');
                      return;
                    }
                    textStr = reasonMessageToShow.val();
                    if (!validString(textStr)) {
                      //show error message
                      $('#fund-show-input-div').show();
                      $('#fundInputErrorMes').text('{!transField["Please_enter_all_characters"][$Label.Header_Language_Code_Current]}{!transField["please_check_the_existing"][$Label.Header_Language_Code_Current]}');
                      return;
                    }

                    if(checkReasonToShow.is(':checked')){
                      console.log('show checkReason');
                      checkTextarea = true;
                    }else{
                      //show error message
                      $('#fund-show-checkbox-div').show();
                      $('#fundCheckBoxErrorMes').text('{!transField["Written_ACK"][$Label.Header_Language_Code_Current]}');
                      return;
                    }
                  }

                  // SaveDraft
                  if (showwaingmes && !type) {
                    if (provideReason.style.display != "none") {
                      textStr = reasonMessageToShow.val();
                      if (textStr != null && textStr != '') {
                        if (!validString(textStr)) {
                          //show error message
                          $('#fund-show-input-div').show();
                          $('#fundInputErrorMes').text('{!transField["Please_enter_all_characters"][$Label.Header_Language_Code_Current]}{!transField["please_check_the_existing"][$Label.Header_Language_Code_Current]}');
                          return;
                        }
                      }
                    }
                    if(checkReasonToShow.is(':checked')){
                      console.log('show SaveDraft checkReason');
                      checkTextarea = true;
                    }
                  }

                  $('input[type=hidden][id$=fund-reasonCheckbox]').val(checkTextarea);
                  $('input[type=hidden][id$=fund-ReasonContent]').val(textStr);
                  if (type) {
                    saveRecord();
                    console.log('save record');
                  }else{
                    saveRecordDraft();
                    console.log('save draft record');
                  }
                  return true;
                }

                console.log('fundPriceTypeReallocation: {!fundPriceTypeReallocation}');
                if(Cigna.Util.isCustomerPortal()){
                  // 20200306 - minghua - ILAS
                  //CR-56_Link_20220214
                  $('#fundSaveDraftBtn').on("click",function(){
                    saveConfirmRecord(false);
                  });
                  // $('#detailsconfirmbtnxs').click(saveRecord);
                  // $('#detailsconfirmbtnsm').click(saveRecord);
                  $('#detailsconfirmbtnxs').on("click",function(){
                    saveConfirmRecord(true);
                  });
                  $('#detailsconfirmbtnsm').on("click",function(){
                    saveConfirmRecord(true);
                  });
                  console.log('record saved');
                } else {
                  $('#detailsconfirmbtnxs').on("click",function(){
                    nextStep();
                  });
                  $('#detailsconfirmbtnsm').on("click",function(){
                    nextStep();
                  });
                }
                </script>
            </apex:outputPanel>
        </div>
        <!-- End of Details Confirmation Page -->
        
        <!-- Start of E-Signature Page -->
        <div class="bs content-step col-xs-12 col-sm-10 col-sm-offset-1" data-step="3" style="display:none;min-height:300px;" id="eSignaturePage">
            <div class="bs row">
                
                <!-- Start T&C Box -->
                <div id="overlay" style="display:none;">
                    <div id="specialBox">
                        <a><div id="closeOverlay" class="onclick-pointer ci-hk-x" onclick="toggleOverlay();"></div></a>
                        <h4>{!$Label.Terms_And_Conditions}</h4>
                        <div style="padding-bottom:10px; border-top: 1px solid #f2f2f2;"></div>
                        <div id="esignaturetccontent">
                            <!-- If PH = Selected PI -->
                            <apex:outputText value="{!$Label.Submit_Claim_T_C_Selected_PI_is_PH_1}" escape="false" rendered="true"/> 
                            <apex:outputText value="{!$Label.Submit_Claim_T_C_Selected_PI_is_PH_2}" escape="false" rendered="true"/>
                            <!-- If PH != Selected PI -->
                            <apex:outputText value="{!$Label.Submit_Claim_T_C_Selected_PI_is_not_PH}" escape="false" rendered="false"/>
                        </div>
                    </div>
                </div>
                <!-- End T&C Box -->
                
                <!-- Start PIC Box -->
                <div id="overlayPIC" style="display:none;">
                    <div id="specialBoxPIC">
                        <a><div id="closeOverlayPIC" class="onclick-pointer ci-hk-x" onclick="toggleOverlayPIC();"></div></a>
                        <h4>{!$Label.Personal_Information_Collection_Statement}</h4>
                        <div style="padding-bottom:10px; border-top: 1px solid #f2f2f2;"></div>
                        <div id="PICcontent">
                            <apex:outputText value="{!picString}" escape="false"/>
                        </div>
                    </div>
                </div>
                <!-- End PIC Box -->
                
                <div id="headeraction" class="bs header-action">
                    <div id="back" class="bs col-xs-12 form-field">
                        <a href="#" onclick="previousStep();" class="bs cigna-fg-orange-medium pull-left">
                            <i class="ci-hk-arrow-29" aria-hidden="true"></i> {!$Label.Back}
                        </a>
                    </div>
                </div>

                <div class="bs col-xs-12">
                  <div id="errEmptySignature" class="bs alert alert-danger" role="alert" style="display:none;">
                      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                      {!$Label.e_signature_empty_err_msg}
                  </div>
                  <div id="errEmptyEmail" class="bs alert alert-danger" role="alert" style="display:none;">
                      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                      {!$Label.email_empty_err_msg}
                  </div>
                  <div id="errNotAcceptTNC" class="bs alert alert-danger" role="alert" style="display:none;">
                      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                      {!$Label.e_signature_tc_err_msg}
                  </div>
                </div>
                
                <apex:actionFunction action="{!getPolicyBasic}" name="refreshEsignature" reRender="e-signature-panel" oncomplete="Cigna.ESignatureComp.forceResizeCanvas();"  status="loader-icon"/>
                
                <apex:outputPanel id="e-signature-panel" >
                    <div class="bs col-xs-12 form-field">
                      <!-- 20200306 - minghua - ILAS -->
                        <c:eSignatureFundComp emailAddress="{!customerEmail}" 
                                          displayPICS="false"
                                          displayTC="false"
                                          tcMessage="{!$Label.Claims_T_and_C}"
                                          PICSLink="{!picLink}"
                                          sendEmailMessage="{!$Label.We_are_going_to_assess_the_claim_now_but_we_cant_finalize_the_claim_until_the_cu}"
                                          signNow="false"
                                          isBroker="{!isBroker}"
                                          isShowWarningMes="{!isShowRPQOnlinePanel}"
                                          pleaseNoteYourCurrent="{!transField['Please_note_your_current'][$Label.Header_Language_Code_Current]}"
                                          latestRPQStatus="{!latestRPQStatus}"
                                          whichIsLowerThan="{!transField['which_is_lower_than'][$Label.Header_Language_Code_Current]}"
                                          personalRiskQuestionnaire="{!transField['Personal_Risk_Questionnaire'][$Label.Header_Language_Code_Current]}"
                                          refreshYourRiskProfile="{!transField['refresh_your_risk_profile'][$Label.Header_Language_Code_Current]}"
                                          continueYourRiskProfile="{!transField['continue_your_risk_profile'][$Label.Header_Language_Code_Current]}"
                                          youMustProvideYour="{!transField['You_must_provide_your'][$Label.Header_Language_Code_Current]}"
                                          riskRelatedToSelectFund="{!transField['Risks_related_to_select_fund'][$Label.Header_Language_Code_Current]}"
                                          contentTBP="{!transField['I_understand_that_the'][$Label.Header_Language_Code_Current]} {!transField['application_and_bear_the'][$Label.Header_Language_Code_Current]}"
                                          orChar="{!transField['or'][$Label.Header_Language_Code_Current]}"
                                          returnToFundSelectionPage="{!transField['Return_to_fund_selection_page'][$Label.Header_Language_Code_Current]}"
                                          mismatchFundList="{!mismatchFundList}"
                                          belowAreTheMismatch="{!transField['Below_are_the_mismatch'][$Label.Header_Language_Code_Current]}"
                                           /> 
                    </div>
                          
                    <script>
                        /** pop up dialog**/
                        function toggleOverlay(){
                            var overlay = document.getElementById('overlay');
                            var specialBox = document.getElementById('specialBox');
                            overlay.style.opacity = .95;
                            if(overlay.style.display == "block"){
                                overlay.style.display = "none";
                                specialBox.style.display = "none";
                            } else {
                                overlay.style.display = "block";
                                specialBox.style.display = "block";
                            }
                        }
                                        
                        function toggleOverlayPIC(){
                            var overlay = document.getElementById('overlayPIC');
                            var specialBox = document.getElementById('specialBoxPIC');
                            overlay.style.opacity = .95;
                            
                            if(overlay.style.display == "block"){
                                overlay.style.display = "none";
                                specialBox.style.display = "none";
                            } else {
                                overlay.style.display = "block";
                                specialBox.style.display = "block";
                            }
                        }
                        
                        /** end pop up dialog**/ 

                        /** override component function **/ 
                        Cigna.ESignatureComp.sendEmail = function(){
                            $("form[id*='esignature-form']").validate();
                
                            jQuery.validator.addMethod("emailStrict", function(value, element) {
                                return this.optional(element) || Cigna.ValidationUtil.isValidEmail(value);
                            }, "{!$Label.Your_Email_Address_is_invalid}");
                            
                            $("[id$='esignature-email']").rules("add", {
                                required : true,
                                emailStrict : true
                            });
                            
                            if(($("form[id*='fundForm']")).validate().form()){
                               brkSaveRecord();
                               
                               //sendEmailSignature(Cigna.ESignatureComp.getEmailAddress());
                                
                            }
                        }
                        
                        // 20200306 - minghua - ILAS
                        Cigna.ESignatureComp.doOnlineRPQ = function(){
                          $('input[type=hidden][id$=fund-reasonCheckbox]').val(false);
                          $('input[type=hidden][id$=fund-ReasonContent]').val('');
                          saveRecordDraft();
                          Cigna.Util.navigateToVFP('RPQSubmitVFP?ss={!customerUserId}&nn={!JSINHTMLENCODE(policyHolderSSNEncrypt)}', null, null, true);
                        }

                        Cigna.ESignatureComp.saveSignature = function() {
                          $('#fundShowInputDiv').hide();
                          $('#fundInputErrorMesCom').text('');
                          var showWaingMess = Cigna.ESignatureComp.callBackShowWarningM();
                          var reasonMes = '';
                          var checkboxValue = false;
                          if (showWaingMess) {
                            var selectedOption = Cigna.ESignatureComp.callBackSelectedOption();
                            if (!selectedOption) {
                              $('#fundShowInputDiv').show();
                              $('#fundInputErrorMesCom').text('{!transField["Please_click_Personal_Risk"][$Label.Header_Language_Code_Current]}');
                              return;
                            }

                            var validaMes = Cigna.ESignatureComp.callBackvalidMes();
                            if (!validaMes) {
                              $('#fundShowInputDiv').show();
                              $('#fundInputErrorMesCom').text('{!transField["Please_enter_all_characters"][$Label.Header_Language_Code_Current]}{!transField["please_check_the_existing"][$Label.Header_Language_Code_Current]}');
                              return;
                            }

                            var selectCheckBox = Cigna.ESignatureComp.callBackCheckBox();
                            if (selectCheckBox) {
                              checkboxValue = true;
                            }else{
                              $('#fundShowInputDiv').show();
                              $('#fundInputErrorMesCom').text('{!transField["Written_ACK"][$Label.Header_Language_Code_Current]}');
                              return;
                            }
                            reasonMes = Cigna.ESignatureComp.callBackReasonMes();
                          }

                          $('input[type=hidden][id$=fund-reasonCheckbox]').val(checkboxValue);
                          $('input[type=hidden][id$=fund-ReasonContent]').val(reasonMes);

                            /*
                            console.log("erer");
                            if($('#esignature-sign-div #esignature-pics').is(':checked') == false){
                                $("#errNotAcceptTNC").show();
                                return;
                            } else {
                                $("#errNotAcceptTNC").hide();
                            }
                            */
                                            
                            if(Cigna.ESignatureComp.isEmptyCanvas(1)){
                                $("#errEmptySignature").show();
                                return;
                            } else {
                                $("#errEmptySignature").hide();
                            }
                            
                            brkSubmitRecord();
                            //submitEsignature(Cigna.ESignatureComp.getSignatureImage(1));
    
                        }
                                                        
                        Cigna.ESignatureComp.nextStep = function(tabId){
                            $('#esignature-branch-div').fadeOut(function(){
                                $('#' + tabId).fadeIn(function(){
                                    $('#e-signature-submit').show();
                                    if (tabId == 'esignature-sign-div') {
                                        Cigna.ESignatureComp.forceResizeCanvas();
                                    }
                                });
                            });
                        }
                        
                        if (Cigna.Util.isIOS() && Cigna.Util.isSalesforce1() && Cigna.Util.isBrokerPortal()) {
                                  
                            $('.mobile-app-padding').css('display', 'block');
                                  
                        }
                        
                    </script>
                
                
                </apex:outputPanel>
                <div id="e-signature-submit" style="display:none;">
                
                    <div class="bs col-xs-12 col-sm-12" style="padding:20px;z-index:-1;"></div>
                    <!--desktop action button-->
                    <div id="eSignaturebtnsm" class="bs hidden-xs col-sm-4 col-sm-offset-4 cigna-fg-white cigna-bg-orange-dark desktop-action-btn onclick-pointer" onclick="nextStep();"> <!-- onclick="submitESignature();"   -->
                        {!$Label.Submit}
                    </div>
                        
                    <!--mobile action button-->    
                
                    <div id="mobile-app-padding" class="bs row" style="display: none;">
                        <div class="bs col-xs-12" style="display: none; padding-bottom: 150px;"></div>
                    </div>
                
                    <div id="action-bar" class="bs visible-xs cigna-floating-bottom-panel" style="left:0px;">
                        <div id="eSignaturetnxs" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark onclick-pointer" onclick="nextStep();">
                            <a class="action-btn cigna-fg-white" role="button"><span class="ci-hk-document-send" aria-hidden="true"></span><br/><span id="eSignaturebtnxstext">{!$Label.Submit}</span></a>
                        </div>
                    </div>
                    
                </div>
            
            </div>
        </div>
        <!-- End of E-Signature Page -->
        
        <!-- Start of Confirmation Page -->
        <div class="bs content-step col-xs-12 form-field" data-step="4" style="display:none; padding-top:20px !important;" id="confirmationPage"> <!--  display:none; -->
            <div class="bs col-xs-12 col-sm-12" style="padding: 20px 35px;">
                <div class="col-xs-12 col-sm-12" style="text-align:center;">
                    <i class="fa fa-check-circle-o content-active" style="font-size:50px;" aria-hidden="true"></i>
                </div>
                <div id="submitESig" style="padding-top:70px;text-align:center"> <!-- class="col-xs-12 col-sm-12"  -->
                    <apex:outputText value="{!$Label.Fund_Management_Acknowledgment_Message}" escape="false" />
                </div>

                <div id="sendESig" style="padding-top:70px;text-align:center;display:none;"> <!-- class="col-xs-12 col-sm-12"  -->
                    <apex:outputText value="{!$Label.Fund_Management_Send_Esig_Email}" escape="false" />
                </div>
            </div>  
            <div class="bs col-xs-3 hidden-xs" />
            <div class="bs col-xs-12 ">
                <div style="padding:20px;"></div>
                <!--desktop action button-->
                <div id="confirmbtnsm" class="bs hidden-xs col-sm-4 col-sm-offset-4 cigna-fg-white cigna-bg-orange-dark desktop-action-btn onclick-pointer" onclick="returnRequest();">
                    {!$Label.Return_to_My_Policy}
                </div>
                    
                <!--mobile action button-->    
                
                <div id="mobile-app-padding" class="bs row" style="display:none; padding-bottom:220px;">
                    <div class="bs col-xs-12"></div>
                </div>
                
                <div id="finalStepDiv" style="display:none;">
                  <div id="action-bar" class="bs visible-xs cigna-floating-bottom-panel" style="left:0px;">
                      <div id="confirmbtnxs" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark onclick-pointer" onclick="returnRequest();"> 
                          <a class="action-btn cigna-fg-white" role="button"><span class="ci-hk-notes" aria-hidden="true"></span><br/><span id="confirmbtnxstext">{!$Label.Return_to_My_Policy}</span></a>
                      </div>
                  </div>
                </div>
                
                <!--
                <div id="confirmbtnxs" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark onclick-pointer" onclick="Cigna.Util.navigateToVFP('MyPolicyVFP', null, null, true)">
                    <a class="action-btn cigna-fg-white" role="button"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span><br/><span id="confirmbtnxstext">{!$Label.Return_to_My_Policy}</span></a>
                </div>
                -->
                
            </div>
        </div>
        <!-- End of Confirmation Page -->
        
    </apex:form>       
    </div>
    <script>
        
        jQuery.validator.addMethod("atLeastOneSwitchOut", function(value, element) {
            return checkSwitchOutFilled();
        }, "{!$Label.Error_Message_Switch_Out_At_Least_One_Fund}");
        
        jQuery.validator.addMethod("noDuplicateSwitchFund", function(value, element) {
            return checkFundSwitchDuplicate(value, element);
        }, "{!$Label.Error_Message_Not_Select_Same_Fund_Twice}");
        
        jQuery.validator.addMethod("noDuplicateReallocationFund", function(value, element) {
            return checkFundReallocationDuplicate(value, element);
        }, "{!$Label.Error_Message_Not_Select_Same_Fund_Twice}");
        
        jQuery.validator.addMethod("below100percentage", function(value, element) {
            return checkBelow100percentage(value, element);
        }, "{!$Label.Error_Message_Not_Exceed_100_Percent}");
        
        jQuery.validator.addMethod("belowCurrentUnit", function(value, element) {
            return checkBelowCurrentUnit(value, element);
        }, "{!$Label.Error_Message_Not_Exceed_Current_Units}");
        
        /**
        jQuery.validator.addMethod("switchIn100", function(value, element) {
            return checkSwitchIn100();
        }, "{!$Label.Error_Message_Add_Up_to_Hundred_Percent}");
        */
        
        jQuery.validator.addMethod("atLeastOneWithdraw", function(value, element) {
            return checkWithdrawFilled();
        }, "{!$Label.Error_Message_At_Least_One_Withdrawal_Amount}");
        
        jQuery.validator.addMethod("belowWithdrawMaximum", function(value, element) {
            return checkWithdrawMaximum(value, element);
        }, "{!$Label.Error_Message_Not_Exceed_Maximum_Withdraw_Amount}");
        
        jQuery.validator.addMethod("minimum100usd", function(value, element) {
            return checkWithdrawMinimum(value, element);
        }, "{!$Label.Error_Message_Not_Below_100_USD_Withdraw_Amount}");
        
        validateForm();
 
        function validateForm() {
            $("form[id*='fundForm']").validate({
                errorPlacement: function(label, element) {
                    label.addClass('errorDiv');
                    label.insertAfter(element);
                },

                wrapper: 'div'
            });
            
            $("form[id*='fundForm'] select[id*='fund-switch-']").each(function(idx, elem){
                $(elem).rules("add", {
                    noDuplicateSwitchFund : true
                });
            });
            
            $("form[id*='fundForm'] select[id*='fund-reallocation-']").each(function(idx, elem){
                $(elem).rules("add", {
                    noDuplicateReallocationFund : true
                });
            });
            
            /**
            $("form[id*='fundForm'] select[id*='withdraw-select']").each(function(idx, elem){
                $(elem).rules("add", {
                    required: true
                });
            });
            */
                 
            $("form[id*='fundForm'] input[id*='fund-switch-out-amount']").each(function(idx, elem){
                $(elem).rules("add", {
                    digits: true,
                    min: 1,
                    atLeastOneSwitchOut: true,
                    below100percentage: true,
                    belowCurrentUnit: true
                });
            });
                    
            $("form[id*='fundForm'] input[id*='fund-switch-in-percentage']").each(function(idx, elem){
                $(elem).rules("add", {
                    digits: true,
                    min: 1,
                    max: 100
                });
            });
            
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").each(function(idx, elem){
                $(elem).rules("add", {
                    digits: true,
                    min: 1,
                    max: 100
                });
            });
            
            /**
            $("form[id*='fundForm'] input[id*='withdraw-input']").each(function(idx, elem){
                $(elem).rules("add", {
                    atLeastOneWithdraw : true
                });
            });
            */
            
            $("form[id*='fundForm'] input[id*='withdraw-input-check-maximum']").each(function(idx, elem){
                $(elem).rules("add", {
                    belowWithdrawMaximum : true,
                    minimum100usd: true,
                    number: true,
                    min: 0
                });
            });
            
            /**
            $("form[id*='fundForm'] input[id$='-contact-no-number']").each(function(idx, elem){
                $(elem).rules("add", {
                    digits: true
                });
            });
            */
            
        }
        
        
        
        function SubmitFiledValidation(){
            
            $("form[id*='fundForm']").validate({
                errorPlacement: function(label, element) {
                    label.addClass('errorDiv');
                    label.insertAfter(element);
                },

                wrapper: 'div'
            });
            
            $("form[id*='fundForm'] input[id*='fund-switch-in']").each(function(idx, elem){
                $(elem).rules("add", {
                    required: true
                });
            });
            
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").each(function(idx, elem){
                $(elem).rules("add", {
                    required: true
                });
            });
            
            $("form[id*='fundForm'] select[id*='fund-']").each(function(idx, elem){
                $(elem).rules("add", {
                    required: true
                });
            });
            
            $("form[id*='fundForm'] input[id*='withdraw-input-required']").each(function(idx, elem){
                $(elem).rules("add", {
                    required : true
                });
            });
            
            //CR-56_Link_20220214
            $("form[id*='fundForm'] input[id*='fund-switch-in-percentage']").on("blur",function(){
                RecheckSwitchIn100();
            });
            
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").on("blur",function(){
                RecheckReallocate100();
            });
            
            /*$("form[id*='fundForm'] input[id*='fund-switch-out-amount']").each(function(idx, elem){
                $(elem).rules("add", {
                    atLeastOneSwitchOut: true,
                });
            });*/
            
            //CR-56_Link_20220214
            if($("[id$='selectedTab']").val() == 'Switching'){
                $("#dm-consent-Switching").on("change",function(){
                    if($(this).is(":checked")) {
                        $('#picErrorDiv-Switching').hide();
                    }
                    else {
                        $('#picErrorDiv-Switching').show();
                    }
                });    
            } else if($("[id$='selectedTab']").val() == 'Reallocation'){
                $("#dm-consent-Reallocation").on("change",function(){
                    if($(this).is(':checked')){
                        $('#picErrorDiv-Reallocation').hide();
                    }
                    else {
                        $('#picErrorDiv-Reallocation').show();
                    }
                });
            } else{
                $("#dm-consent-Withdrawal").on("change",function(){
                    if($(this).is(':checked')){
                        $('#picErrorDiv-Withdrawal').hide();
                    }
                    else {
                        $('#picErrorDiv-Withdrawal').show();
                    }
                });
            }
        
        }
        
        function RecheckSwitchIn100(){
            //var switchIn100 = false;
            var sum = 0;
            //var tempInt;
            
            $("form[id*='fundForm'] input[id*='fund-switch-in-percentage']").each(function(idx, elem){
                if ( $(elem).val() != ''){
                    sum += parseInt($(elem).val());
                }
            });
            
            if (sum == 100){
                //switchIn100 = true;
                $('#errorDiv').hide();
                $('#errorMes').text('');
                return true;
            }
            else{
                $('#errorDiv').show();
                $('#errorMes').text('{!$Label.Error_Message_Add_Up_to_Hundred_Percent}');
                return false;
            }
            
            //return switchIn100;
        }
        
        
        function RecheckReallocate100(){
  
            var sum = 0;
            
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").each(function(idx, elem){
                if ( $(elem).val() != ''){
                    sum += parseInt($(elem).val()); 
                }
            });
            if (sum == 100){
                $('#RealloErrorDiv').hide();
                $('#RealloErrorMes').text('');
                return true;
            }
            else{
                $('#RealloErrorDiv').show();
                $('#RealloErrorMes').text('{!$Label.Error_Message_Add_Up_to_Hundred_Percent}');
                return false;
            }

        }
        
        /*
        function RecheckAccept() {
           
                var selectedTab = $("[id$='selectedTab']").val();
                
                if(selectedTab == 'Switching'){
                    if ($("#dm-consent-Switching").is(':checked')){
                    $('#picErrorDiv-Switching').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Switching').show();
                        return false;
                    }
                   
                } else if(selectedTab == 'Reallocation'){
                    if ($("#dm-consent-Reallocation").is(':checked')){
                    $('#picErrorDiv-Reallocation').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Reallocation').show();
                        return false;
                    }
                } else{
                    if ($("#dm-consent-Withdrawal").is(':checked')){
                    $('#picErrorDiv-Withdrawal').hide();
                    return true;
                    }
                    else {
                        $('#picErrorDiv-Withdrawal').show();
                        return false;
                    }
                }
           
            
        }
        
        */
        
        function calculateSwitchRemainingPercentage() {
            var total = 0;
            $("form[id*='fundForm'] input[id*='fund-switch-in-percentage']").each(function(idx, elem){
                if ($(elem).val() != ''){
                    total += parseInt($(elem).val());
                }
            });
            var remain = 100 - total;
            if (remain <= 100){ //remain >= 0 && 
                $('#fund-switch-remaining-percentage').text(remain + '%');
            }
            else{
                $('#fund-switch-remaining-percentage').text('%');
            }
        }
        
        function calculateSwitchEstimatedValue() {
            $('#fund-switch-estimated-value').text('calculating...');
            
            var total = 0;
            var temp;
            var disableSubmit = false;
            $("form[id*='fundForm'] input[id*='fund-switch-out-amount']").each(function(idx, inputElem){
                $(inputElem).parent().siblings('div').children('.cigna-fg-blue-medium').each(function(idx, elem){
                    if ( $.trim($(elem).text()) == '{!$Label.Units}'){
                        temp = $(elem).parent().parent().parent().siblings('div').find('td.unitPriceColumn').text();
                        total += $(inputElem).val() * parseFloat(temp);
                    }
                    else if ($.trim($(elem).text()) == '%'){
                        temp = $(elem).parent().parent().parent().siblings('div').find('td.totalPriceColumn').text();
                        total += $(inputElem).val() * parseFloat(temp) / 100;
                    }
                     if( $(inputElem).val() !='' && parseFloat(temp) < 0 ) {                        
                        disableSubmit = true
                    }
                });
            });
             // Added by IBM(Roy) due to JR1679/Portable R2 --START
            if(disableSubmit){
                $('#firstbtnsm').prop('onclick',null).off('click');
                $('#firstbtnsm').addClass('cigna-bg-gray-dark');
            } else {
                //$('#firstbtnsm').prop('onclick','SubmitFiledValidation();rerenderConfirmationAfterValidation()');
                //Added by Nicole start
                $('#firstbtnsm').prop('onclick',null).off('click');
                
                //Nicole_SPS-584_20200922
                //$('#firstbtnsm').click(SubmitFiledValidation,rerenderConfirmationAfterValidation);
               //CR-56_Link_20220214
               $('#firstbtnsm').on("click",SubmitFiledValidation);
                $('#firstbtnsm').on("click",rerenderConfirmationAfterValidation);
                
                //Added by Nicole end
                $('#firstbtnsm').removeClass('cigna-bg-gray-dark');
            }
            // Added by IBM(Roy) due to JR1679/Portable R2 --END
            total = roundDown(total, '100');
            
            $('#fund-switch-estimated-value').text('{!$Label.USD} ' + total);
        }
        
        function calculateReallocationRemainingPercentage() {
            var total = 0;
            $("form[id*='fundForm'] input[id*='fund-reallocate-amount']").each(function(idx, elem){
                if ($(elem).val() != ''){
                    total += parseInt($(elem).val());
                }
            });
            var remain = 100 - total;
            if (remain <= 100){ //remain >= 0 && 
                $('#fund-reallocation-remaining-percentage').text(remain + '%');
            }
            else{
                $('#fund-reallocation-remaining-percentage').text('%');
            }
        }
        
        //Ray Update
        
        function FixSubmitButtonJS(){
        
            if (Cigna.Util.isIOS() && Cigna.Util.isCustomerPortal() && $(window).width() < 768 ) {  
                //CR-56_Link_20220214
                $('.bs input[type="text"], .bs  input[type="tel"], .bs  input[type="date"], .bs  select, textarea').on("focus",function(evt){
                    if ($('#action-bar').is(':visible')) {
                        $('#action-bar').addClass('hidden-xs').removeClass('visible-xs');
                    }
                });
                
                $('.bs input[type="text"], .bs  input[type="tel"], .bs  input[type="date"], .bs  select, .bs  textarea').on("blur",function(evt){
                    if ($('#action-bar').hasClass('hidden-xs')) {
                        $('#action-bar').addClass('visible-xs').removeClass('hidden-xs');
                    }
                });
            }
        }
        
        FixSubmitButtonJS();
        
        if (Cigna.Util.isIOS() && Cigna.Util.isSalesforce1() && Cigna.Util.isBrokerPortal()) {
        
            /*$(document).ready(function(){
              
                window.onkeydown = function(){ 
                    window.focus();
                }
                
                var targetHeight = window.screen.height;
                var sfOneHeaderHeight = 44 + 20; //window.parent.document.getElementsByClassName('oneHeader')[0].offsetHeight;
                
                if($(window).width() > $(window).height()){
                    targetHeight = window.screen.width;   
                }
                
                //$('body').css('height', (targetHeight  - (targetHeight * 0.09)) + 'px');
                
                $('body').css('height', (targetHeight - sfOneHeaderHeight) + 'px');
                $('#action-bar').css('bottom', '0');
                
                $('body').bind('touchmove', function(e){$('#action-bar').css('opacity', '0');});
                $('body').bind('touchend', function(e){setTimeout(function(){$('#action-bar').css('opacity', '1');}, 700);});
                
            });*/

            $("div[id*='mobile-app-padding']").css('display', 'block');
            $("a").attr("target","");
        }
        // Added by IBM(Roy) due to JR1679/Portable R2 --START
        function calc3NegativeValue() {
            var maxB, maxR, maxS;
            $("form[id*='fundForm'] input[id*='withdraw-input-check-maximum-basic']").each(function(idx, inputElem){
              var currV = $("form[id*='fundForm'] [id*='opMaxBasic']").text().replace(',','');
              if($(inputElem).val() != '' && currV < 0.0) {
                  maxB = true;
              }
            });

            $("form[id*='fundForm'] input[id*='withdraw-input-check-maximum-regular']").each(function(idx, inputElem){
                var currV = $("form[id*='fundForm'] [id*='opMaxRegular']").text().replace(',','');
                if($(inputElem).val() != '' && currV < 0.0) {
                    maxR = true;
                }
            });

            $("form[id*='fundForm'] input[id*='withdraw-input-check-maximum-single']").each(function(idx, inputElem){
                var currV = $("form[id*='fundForm'] [id*='opMaxSingle']").text().replace(',','');
                if($(inputElem).val() != '' && currV < 0.0) {
                    maxS = true;
                }
            });
            
            console.log('maxB '+maxB +'maxR '+'maxS '+maxS);
            
            if(maxB || maxR || maxS) {
                $('#firstbtnsm').prop('onclick',null).off('click');
                $('#firstbtnsm').addClass('cigna-bg-gray-dark');
            } else {
                //$('#firstbtnsm').prop('onclick','SubmitFiledValidation();rerenderConfirmationAfterValidation()'); Comment by Nicole
                //Added by Nicole start
                $('#firstbtnsm').prop('onclick',null).off('click');
                
                //Nicole_SPS-584_20200922
                //$('#firstbtnsm').click(SubmitFiledValidation,rerenderConfirmationAfterValidation);
                //CR-56_Link_20220214
                $('#firstbtnsm').on("click",SubmitFiledValidation);
                $('#firstbtnsm').on("click",rerenderConfirmationAfterValidation);
                
                //Added by Nicole end
                $('#firstbtnsm').removeClass('cigna-bg-gray-dark');
            }
        }
        // Added by IBM(Roy) due to JR1679/Portable R2 --END
        
    </script>
</apex:page>