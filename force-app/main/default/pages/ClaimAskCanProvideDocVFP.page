<apex:page Controller="MyClaimSubmitController" showHeader="false" sidebar="false" docType="html-5.0" cache="false">
    
    <head>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover"/>
    </head>
    <script>
        //Add by Manuel to define a global variable to indicate the files amount and number
        var filesAmt = 0; 
        var fileNum = 0;
    
        /** upload files**/
        /*For upload attachment*/  
        function uploadFile(parentId, attType)
        {
            
            showLoading();
            
            //Add by Manuel on 20180927 to support multiple files select and upload function start
            var arrFiles = new Array();
            
            // add by minghua 20190806 - to show the progress
            // $('#showProgress').hide();

            $("#"+attType).each(function(){
                //filesToUpload=$(this)[0].files[0]; // Comment by Manuel on 20180927 that legacy single file select upload every time
                filesAmt = $(this)[0].files.length; //Add by Manuel to define a global variable to indicate the files amount and number 
                for(var j=0; j<$(this)[0].files.length; j++){
                    arrFiles[j] = $(this)[0].files[j];
                }
                console.log('filesAmt: '+filesAmt);
            });
            //Heather file upload on empty cursor
            if(filesAmt<1){
                $("#errFileType").show();
                passFileType = false;
                finishSubmission();
            }
            else{
            fileNum = 0; //Add by Manuel to define a global variable to indicate the files amount and number
            for(var k=0; k<arrFiles.length; k++){
                filesToUpload = arrFiles[k];
                //Add by Manuel on 20180927 to support multiple files select and upload function stop
                console.log('filesToUpload: '+k);
                var reader = new FileReader();
        
                // Keep a reference to the File in the FileReader so it can be accessed in callbacks
                reader.file = filesToUpload;
                
                if(typeof(filesToUpload)  === "undefined"){
                    alert('please select file.');
                    
                }else{
                    reader.onload = function(e)
                    {
                        // minghua - 20220523 - file virus scan
                        // var maxFileSize = 26214400;//10485760;//David Zhang - 20190425 - Pull Doc//7340032;
                        var maxFileSize = 10485760;
                        var passFileSize;
                        var passFileType;
                        console.log('check file size');
                        if(this.file.size>maxFileSize){
                            $("#errFileSize").show();
                            passFileType = false;
                            finishSubmission();
                        }else{
                            passFileSize = 'true';
                            $("#errFileSize").hide();
                        }
                        //Heather 20190724 - remove 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 'application/msword' for Claims system project - Submit claim & GOP change
                    if(this.file.type!='application/pdf' && this.file.type!='image/png' && this.file.type!='image/jpeg' && this.file.type!='image/tiff'){
                            $("#errFileType").show();
                            finishSubmission();
                        }else{
                            passFileType  = 'true';
                            $("#errFileType").hide();
                            console.log('check file type');
                        }
                        
                        if(passFileType=='true' && passFileSize=='true' && parentId && parentId!=undefined){
                            
                            /*
                            var att = new sforce.SObject("Attachment");
                            att.Name = attType+'_'+this.file.name;
                            att.ContentType = this.file.type;
                            att.ParentId = parentId;
                            console.log(att.Name);
                            */
                            
                            var binary = "";
                            var bytes = new Uint8Array(e.target.result);
                            var length = bytes.byteLength;
            
                            for (var i = 0; i < length; i++)
                            {
                                binary += String.fromCharCode(bytes[i]);
                            }
                            
                            //att.Body = (new sforce.Base64Binary(binary)).toString();
                            console.log('prepare upload');
                            var attachment_object = {
                                parentId: parentId,
                                Body: window.btoa(binary), 
                                Name: attType+'_'+this.file.name, 
                                ContentType: this.file.type 
                            };
                
                            $.ajax({
                                url: '{!$Site.BaseUrl}/services/data/v45.0/sobjects/Attachment',
                                data: JSON.stringify(attachment_object),
                                type: 'POST',
                                processData: false,
                                contentType: false,
                                headers: {'Authorization': 'Bearer {!GETSESSIONID()}', 'Content-Type': 'application/json'},
                                xhr: function(){
                                    var xhr = new window.XMLHttpRequest();
                                    //Upload progress
                                    xhr.upload.addEventListener("progress", function(evt){
                                        if (evt.lengthComputable) {
                                            var percentComplete = evt.loaded / evt.total;
                                            //Do something with upload progress
                                            // add by minghua 20190806 - to show the progress
                                            // $('#showProgress').html('<span>Upload File Progress:'+percentComplete*100+'%</span>');
                                            // $('#showProgress').show();
                                            console.log("Percentage:"+percentComplete);
                                        }
                                    }, false);
                                    return xhr;
                                },
                                success: function(response) {
                                    console.log('success response:'+response);
                                    fileNum++; //Add by Manuel to define a global variable to indicate the files amount and number
                                    if (fileNum == filesAmt) {//PI20 jack add
                                        refreshAttlist();
                                    }
                                    if ({!isCustomer}){
                                        displayNextBtnIn(8);
                                    }
                                    else{
                                        displayNextBtnIn(6);
                                    }
                                },

                                error: function(xhr, status, error) {
                                    var errorMessage = xhr.status + ': ' + xhr.statusText
                                    console.log('ERROR:'+ errorMessage);
                                    alert(errorMessage );
                                    fileNum++; //Add by Manuel to define a global variable to indicate the files amount and number
                                    checkFilesAmtNum(fileNum);
                                }
                            });
                            
                            /*
                            sforce.connection.create([att],
                            {
                                
                                onSuccess : function(result, source)
                                {
                                    if (result[0].getBoolean("success"))
                                    {
                                        //("new attachment created with id " + result[0].id);
                                        //finishSubmission(); //Add by Manuel to update spinner status
                                        fileNum++; //Add by Manuel to define a global variable to indicate the files amount and number
                                        console.log('prepare upload');
                                        refreshAttlist();
                                        //$("html, body").animate({ scrollTop: $(document).height() }, "slow");
                                        console.log('upload success');
                                        if ({!isCustomer}){
                                            displayNextBtnIn(8);
                                        }
                                        else{
                                            displayNextBtnIn(6);
                                        }
                                    }
                                    else
                                    {
                                        //finishSubmission(); //Add by Manuel to update spinner status
                                        fileNum++; //Add by Manuel to define a global variable to indicate the files amount and number
                                        checkFilesAmtNum(fileNum);
                                        console.log('upload no success');
                                    }
                                    
                                },
                                onFailure : function(error, source)
                                {
                                    //finishSubmission(); //Add by Manuel to update spinner status
                                    fileNum++; //Add by Manuel to define a global variable to indicate the files amount and number
                                    checkFilesAmtNum(fileNum);
                                    console.log(error);
                                    console.log('upload error');
                                }
                            });
                            */
                            
                        }else{
                            console.log('upload no action');
                            //finishSubmission(); //Add by Manuel to update spinner status
                        }
                    };
                    reader.readAsArrayBuffer(filesToUpload);
                }
            }//Add by Manuel on 20180927 
        }
        } 
        
        function removeAttachment(id){
           
           removeAtt(id);
           refreshAttlist();
           
        }
        
        //Add by Manuel to define a global variable to indicate the files amount and number
        function checkFilesAmtNum(fileNumber){
            console.log('fileNumber:'+fileNumber+' filesAmt:'+filesAmt);
            if(fileNumber==filesAmt){
                finishSubmission();
            }
        }
        
        //end doc
        /** top section **/
        function selectUploadDoc(){
            
            $('#uploadDoc').toggle();
            if($('#upload_angle').hasClass('ci-hk-arrow-28 ci-hk-lg font-size-10')){
                $('#upload_angle').removeClass('ci-hk-arrow-28 ci-hk-lg font-size-10').addClass('ci-hk-arrow-27 ci-hk-lg font-size-10');
                $('#upload_div').text('{!$Label.Hide_Document}');
            }
            else if($('#upload_angle').hasClass('ci-hk-arrow-27 ci-hk-lg font-size-10')){
                $('#upload_angle').removeClass('ci-hk-arrow-27 ci-hk-lg font-size-10').addClass('ci-hk-arrow-28 ci-hk-lg font-size-10');
                $('#upload_div').text('{!$Label.View_Document}');
            }
        }
        
        function selectDownloadDoc(){
            
            $('#downloadDoc').toggle();
            if($('#download_angle').hasClass('ci-hk-arrow-28 ci-hk-lg font-size-10')){
                $('#download_angle').removeClass('ci-hk-arrow-28 ci-hk-lg font-size-10').addClass('ci-hk-arrow-27 ci-hk-lg font-size-10');
                $('#download_div').text('{!$Label.Hide_Document}');
            }
            else{
                $('#download_angle').removeClass('ci-hk-arrow-27 ci-hk-lg font-size-10').addClass('ci-hk-arrow-28 ci-hk-lg font-size-10');
                $('#download_div').text('{!$Label.View_Document}');
            }
        
        }
        
        /** bottom section **/
        function selectUploadDoc2(){
            console.log('Select upload docu2...');
            $('#uploadDoc2').toggle();
            if($('#upload_angle2').hasClass('ci-hk-arrow-28 ci-hk-lg font-size-10')){
                $('#upload_angle2').removeClass('ci-hk-arrow-28 ci-hk-lg font-size-10').addClass('ci-hk-arrow-27 ci-hk-lg font-size-10');
                $('#upload_div2').text('{!$Label.Hide_Document}');
            }
            else if($('#upload_angle2').hasClass('ci-hk-arrow-27 ci-hk-lg font-size-10')){
                $('#upload_angle2').removeClass('ci-hk-arrow-27 ci-hk-lg font-size-10').addClass('ci-hk-arrow-28 ci-hk-lg font-size-10');
                $('#upload_div2').text('{!$Label.View_Document}');
            }
        }
        
        function selectDownloadDoc2(){
            
            $('#downloadDoc2').toggle();
            if($('#download_angle2').hasClass('ci-hk-arrow-28 ci-hk-lg font-size-10')){
                $('#download_angle2').removeClass('ci-hk-arrow-28 ci-hk-lg font-size-10').addClass('ci-hk-arrow-27 ci-hk-lg font-size-10');
                $('#download_div2').text('{!$Label.Hide_Document}');
            }
            else{
                $('#download_angle2').removeClass('ci-hk-arrow-27 ci-hk-lg font-size-10').addClass('ci-hk-arrow-28 ci-hk-lg font-size-10');
                $('#download_div2').text('{!$Label.View_Document}');
            }
        }
        
        function displayUploadSection(){
            hideQuestion('allow_download'); 
            hideQuestion('allow_upload'); 
            
            displayQuestion('display_download'); 
            displayQuestion('display_upload'); 
        
        }
        
        function allowUploadSection(isAllowUpload){
            if(isAllowUpload){
                hideQuestion('display_download'); 
                hideQuestion('display_upload'); 
                hideQuestion('displayDocQuestion'); 
                
                displayQuestion('allow_download'); 
                displayQuestion('allow_upload');
            
            }
            else{
                displayUploadSection();
                toggleOverlay_CannotProvideDoc();
            }
        }
        
        
    </script>
    <style>
        .font-size-10{
            font-size: 10px !important;
        }
        
        /*CR-56_Link_20220214*/
        .ui-tooltip {
                background: black !important;
                max-width: 250px !important;
                width: 250px; 
                min-width: 100px;
                color: white !important;
                z-index: 1070;
                display: block;
                text-align: center !important;
                font-size: 12px !important;
                border-radius: 5px !important;
            }
        
    </style>
    
    <div id="errFileSize" class="alert alert-danger" role="alert" style="display:none;">
        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
        {!$Label.File_Size_Claim_Limit}
    </div>
    <div id="errFileType" class="alert alert-danger" role="alert" style="display:none;">
        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
        {!$Label.Please_upload_a_valid_file} (i.e. .pdf/.jpeg/.png/.tiff)
    </div>
    <!-- PI20 jack add -->
    <apex:outputPanel id="errFileSizeZero">
        <apex:outputPanel rendered="{!NOT(ISBLANK(failFileName))}">
            <div id="errFileType" class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                {!transField['Uploaded_fail'][$Label.Header_Language_Code_Current]}
            </div>
        </apex:outputPanel>
    </apex:outputPanel>
    <!-- end of error msg -->
    <div class="bs">
                                    
        <!-- for upload doc -->   
        <div id="display_upload" class="uploadForm content-choice-block" style="display:none;"> <!-- style="{!if( isCustomer,'display: none;','')}" -->
            <div class="content-question">
                <apex:outputLabel value="{!$Label.Please_upload_the_following_document}" escape="false"></apex:outputLabel>
            </div>
            <div class="col-xs-12 col-sm-12 cigna-fg-blue-medium onclick-pointer" style="text-align:right; border-bottom:1px solid #f2f2f2;" onclick="selectUploadDoc()" >
                <div id="upload_div" style="display:inline" >{!$Label.Hide_Document}</div>
                <i id="upload_angle" class="ci-hk-arrow-27 ci-hk-lg font-size-10 content-icon" aria-hidden="true"></i>
            </div>
            <div id="uploadDoc" style="width: 100%; float: left;">
                <!-- display doc need to upload only, cannot upload at this part -->
                <div style="width:100%; padding-top:20px; padding-bottom:40px; ">
                   <apex:repeat value="{!wClaimTypeRelatedDocList}" var="wItem">
                       <!-- testing to add rules -->
                       <div class="{!wItem.rules}" >
                           <div class="col-xs-2 col-sm-1">
                               <i class="fa fa-circle" aria-hidden="true"/>
                           </div>
                           <div class="col-xs-10 col-sm-11">{!if( uList.size>0 && uList[0].LanguageLocaleKey == 'en_US', wItem.docTypeName_eng, wItem.docTypeName_chi)}</div>
                           <div class="col-xs-12 col-sm-12" style="padding-bottom:10px;"></div>
                       </div>
                       
                   </apex:repeat>
                   
                </div>
            </div>
        </div>
        
        <!-- upload part -->
        <div id="allow_upload" class="uploadForm content-choice-block" > <!-- style="{!if( !isCustomer,'display: none;','')}"  -->
            <!-- display claim upload record -->
            <div class="content-question">
                <apex:outputLabel value="{!$Label.Please_upload_the_following_document_s}" escape="false"></apex:outputLabel>
            </div>
            <div class="col-xs-12 col-sm-12 cigna-fg-blue-medium onclick-pointer" style="text-align:right; border-bottom:1px solid #f2f2f2;" onclick="selectUploadDoc2()" >
                <div id="upload_div2" style="display:inline" >{!$Label.Hide_Document}</div>
                <i id="upload_angle2" class="ci-hk-arrow-27 ci-hk-lg font-size-10 content-icon" aria-hidden="true"></i>
            </div>
            <div id="uploadDoc2" style="width: 100%; float: left;">
                <!-- add by minghua 20190806 - to show the progress -->
                <!-- <div id="showProgress" style="display: none;"></div> -->
                <apex:outputPanel id="uploadDocResult">
                    <apex:variable value="{!0}" var="doc_upload_count"/>    <!-- customer upload doc count -->
                    <div style="width:100%; padding-top:20px; padding-bottom:40px; ">
                       <apex:repeat value="{!wClaimTypeRelatedDocList}" var="wItem">
                           <!-- compare with rules from claim type doc - SF-->
                           <div class="{!wItem.rules}" style="{!if(wItem.rules !=null && wItem.rules!= '','display:none;','')}" >
                               <div class="col-xs-2 col-sm-1">
                                   <!--Add by Manuel on 20180927 to support multiple files select and upload function-->
                                   <input id="{!wItem.docId}" type="file" multiple="multiple" class="fileInput" onchange="console.log('uploadDocResult begin');uploadFile('{!if(cList.size>0 && cList[0].id!= null, cList[0].id, '')}','{!wItem.docId}');" style="display:none;" />
                                   <label for="{!wItem.docId}"><i class="ci-hk-outbox content-icon onclick-pointer" aria-hidden="true"/></label>
                               </div>
                               <div class="col-xs-8 col-sm-10">{!if( uList.size>0 && uList[0].LanguageLocaleKey == 'en_US', wItem.docTypeName_eng, wItem.docTypeName_chi)}</div>
                               <div class="col-xs-2 col-sm-1"><i class="ci-hk-help helptext-icon pull-right" data-toggle="tooltip" title="{!IF(contains(transKey, '~Upload_Tooltip~'), transField['Upload_Tooltip'][$Label.Header_Language_Code_Current],'Upload_Tooltip')}" aria-hidden="true"></i></div>
                               <div class="col-xs-12 col-sm-12" style="padding-bottom:5px;"></div>
                               <apex:repeat value="{!claimUploadAttList}" var="att"  >
                                   <apex:outputPanel rendered="{!if(att.relatedClaimTypeDocumentId == wItem.docId, true, false)}">
                                       <div class="col-xs-12 col-sm-12" style="background-color: #f2f2f2; " >
                                           <div class="col-xs-2 col-sm-1"></div>
                                           <div class="col-xs-8 col-sm-10 uploaded-filelist" >{!att.attName}</div>
                                           <div class="col-xs-2 col-sm-1" ><i class="fa fa-times-circle pull-right onclick-pointer" onclick="removeAttachment('{!att.attId}');" aria-hidden="true"></i></div>
                                       </div>
                                       <div class="col-xs-12 col-sm-12" style="padding-bottom:10px;"></div>
                                       <apex:variable var="doc_upload_count" value="{!doc_upload_count+ 1}"/> 
                                   </apex:outputPanel>
                               </apex:repeat>
                               
                               <div class="col-xs-12 col-sm-12" style="padding-bottom:10px;"></div>
                           </div>
                       </apex:repeat>
                       
                       <!-- DUMMY -->
                       <div style="{!if( isCustomer ,'display:none;','display:none;')}" >
                           <div class="col-xs-2 col-sm-1">
                               <input id="dummy-upload" type="file" multiple="multiple" class="fileInput" onchange="console.log('dummy-upload begin');uploadFile('{!if(cList.size>0 && cList[0].id!= null, cList[0].id, '')}','dummy-upload');" style="display:none;" />
                               <label for="dummy-upload"><i class="ci-hk-outbox content-icon onclick-pointer" aria-hidden="true"/></label>
                           </div>
                           <div class="col-xs-8 col-sm-10">{!if( uList.size>0 && uList[0].LanguageLocaleKey == 'en_US', 'Dummy document', 'Dummy document Chinese')}</div>
                           <div class="col-xs-2 col-sm-1"><i class="ci-hk-help helptext-icon pull-right" data-toggle="tooltip" title="{!$Label.Upload_Tooltip_For_Claim}" aria-hidden="true"></i></div>
                           <div class="col-xs-12 col-sm-12" style="padding-bottom:5px;"></div>
                           <apex:repeat value="{!claimUploadAttList}" var="att"  >
                               <apex:outputPanel rendered="{!if(att.relatedClaimTypeDocumentId == 'dummy-upload', true, false)}">
                                   <div class="col-xs-12 col-sm-12" style="background-color: #f2f2f2; " >
                                       <div class="col-xs-2 col-sm-1"></div>
                                       <div class="col-xs-8 col-sm-10 uploaded-filelist" >{!att.attName}</div>
                                       <div class="col-xs-2 col-sm-1" ><i class="fa fa-times-circle pull-right onclick-pointer" onclick="removeAttachment('{!att.attId}');" aria-hidden="true"></i></div>
                                   </div>
                                   <div class="col-xs-12 col-sm-12" style="padding-bottom:10px;"></div>
                                   <apex:variable var="doc_upload_count" value="{!doc_upload_count+ 1}"/> 
                               </apex:outputPanel>
                           </apex:repeat>
                           
                           <div class="col-xs-12 col-sm-12" style="padding-bottom:10px;"></div>
                       </div>
                       <!-- End of Dummy -->
                       
                       <!--
                       Rules:
                        individualLifePolicy - selected Policy
                        brokerPAC -> IfHPAPolicyLessThan2Yrs_IFHSPolicyLessThan3YrsOrBrokerPACPlanCodeP2AMERateScale1/2/3/4ORPlanCodePSAMERateScale1/2/3/4  - selected Policy and plan code claim type
                        //no need now totalAndPermanentDisability - plan code claim type
                        claimFromOtherCompany - by answer question
                       -->
                       <script>
                            var isGSUser = {!isGSUser};
                           /** customer logic here **/
                           if({!cList[0].Is_Contain_Individual_Life_Policy__c})    $('.individualLifePolicy').show();
                           else    $('.individualLifePolicy').hide();
                           
                           if(isGSUser || ((showHPA >= 1 && IfHPAPolicyLessThan2Yrs  ) 
                            || ( showHS >= 1 && IFHSPolicyLessThan3YrsOrBrokerPACPlanCode )) 
                            || (({!cList[0].HS__c} && {!cList[0].HS_Less_Than_3_Yrs_or_Broker_PAC__c}) 
                            || ({!cList[0].HPA__c} && {!cList[0].HPA_Less_Than_2_Yrs__c})) ) {
                              $('.brokerPAC').show();
                              displayQuestion('allow_download');
                           } else {
                               $('.brokerPAC').hide();
                               //for case only one doc can download and it is HPA/HS doc - hide download part also
                               if(( showHPA >= 1 ||  showHS >= 1 || {!cList[0].HS__c} || {!cList[0].HPA__c}) && {!if( noOfFormNeedToDownload <=1, true, false)})    hideQuestion('allow_download');         
                           
                           }
                           
                           // 20200109-minghua-JR1811
                           if(claimFromOtherCompany == 1 && {!cList[0].Making_other_insurance_claim__c})    $('.claimFromOtherCompany').show();
                           else    $('.claimFromOtherCompany').hide();
                           //IBM KOU Wonder Woman CR Start
                           // alert('WW=' + isWonderWoman);  
                           if(isWonderWoman)
                           {
                             $('.WonderWoman').show(); 
                           }
                           else
                           {
                             $('.WonderWoman').hide();  
                           }
                           // alert(showPolicyLessThan1Yr);  //IBM KOU TEMP
                           // 20190918 - Raistlin - GS user ignore showPolicyLessThan1Yr and isWonderWoman
                           if($('.WonderWoman1Year').length > 0) {
                               console.log('WonderWoman1Year exist');
                               if(isGSUser || (!isGSUser && isWonderWoman && showPolicyLessThan1Yr))
                               {
                                 $('.WonderWoman1Year').show();
                                 $('.brokerPAC').hide();
                               }
                               else
                               {
                                 $('.WonderWoman1Year').hide(); 
                               }
                           }
                           //IBM KOU Wonder Woman CR End                            
                           
                           //sj_OP_d__c true: is in fast track
                           if({!if(cList.size>0 && (cList[0].OP__c || cList[0].OPF__c) && !cList[0].Is_Fast_Track__c && CONTAINS(cList[0].Selected_Question_s__c,'q13'), true, false)}){
                               $('.OPFHide').show();
                           }
                           else    $('.OPFHide').hide();
                           
                           var currentStepNum = $('.content-step:visible').data('step');
                           if(currentStepNum == 9){
                               console.log('force resize canvas when edit exist record');
                               Cigna.ESignatureComp.forceResizeCanvas();
                           }
                           
                       </script>
                    </div>
                    <!-- initialize show next button -->
                    <script>
                        var stepNum;
                        if ({!isCustomer}){
                            stepNum = 8;
                        }
                        else{
                            stepNum = 6;
                        }
                        
                        if({!doc_upload_count}>=1){
                            displayNextBtnIn(stepNum);
                            if (Cigna.Util.isIOS() && Cigna.Util.isSalesforce1() && Cigna.Util.isBrokerPortal()) {
                                $('.nextStepBtnPaddingIn6').show();
                            }
                        }
                        else{
                            hideNextBtnIn(stepNum);
                        }
                        
                        //CR-56_Link_20220214
                        $('[data-toggle="tooltip"]').tooltip();
                    </script>
                    
                </apex:outputPanel>
                
            </div>
        </div>
        
        <!-- for download as pdf part -->
        <apex:outputPanel rendered="{!needDownloadPDF}">
       
            <div id="display_download" class="downloadForm content-choice-block"  style="{!if( isCustomer,'display: none;','display: none;')}"> <!-- style="display: none;"  -->
            
                <div class="content-question" style="padding-top:20px;">
                   <apex:outputLabel value="[To Be Deleted]{!$Label.Please_download_the_form_s_below_and_filled_by_your_doctor}" escape="false" rendered="{!isCustomer}"></apex:outputLabel>
                   <apex:outputLabel value="[To Be Deleted]{!$Label.The_customer_s_doctor_will_need_to_complete_the_following_form}" escape="false" rendered="{!!isCustomer}"></apex:outputLabel>
                </div>
                
                <div class="col-xs-12 col-sm-12 cigna-fg-blue-medium onclick-pointer" style="text-align:right; border-bottom:1px solid #f2f2f2;" onclick="selectDownloadDoc()" >
                    <div id="download_div" style="display:inline" >{!$Label.Hide_Document}</div>
                    <i id="download_angle" class="ci-hk-arrow-27 ci-hk-lg font-size-10 content-icon" aria-hidden="true"></i>
                </div>
                      
                <div id="downloadDoc" style="width: 100%; float: left;">
                    
                    <div style="width:100%; padding-top:20px; padding-bottom:40px; ">
                        
                       <apex:variable value="{!0}" var="idx_wItem"/>
                       <apex:repeat value="{!wClaimTypeRelatedDocList}" var="wItem">
                           <!-- testing to add rules -->
                           <div class="{!wItem.rules}" >
                               <apex:outputPanel rendered="{!wItem.isPdf}" layout="inline" >
                                   <apex:variable value="{!0}" var="idx_doc"/>
                                   <apex:repeat value="{!wItem.attList}" var="att_tmp">
                                       
                                       <div class="col-xs-2 col-sm-1"><a id="btn-click-display-doc-{!idx_wItem}-{!idx_doc}" href="{!$Setup.Portal_Settings__c.File_Download_URL__c}{!att_tmp.id}" target="_blank" ><i class="fa fa-download content-icon" aria-hidden="true"></i></a></div>
                                       <div class="col-xs-10 col-sm-11" >{!if( uList.size>0 && uList[0].LanguageLocaleKey == 'en_US', wItem.docTypeName_eng, wItem.docTypeName_chi)}</div>
                                       <div class="col-xs-12 col-sm-12" style="padding:10px;"></div>
                                       <apex:variable var="idx_doc2" value="{!idx_doc+1}"/>
                                       
                                   </apex:repeat>
                               </apex:outputPanel>
                               <apex:variable var="idx_wItem" value="{!idx_wItem+1}"/>
                           </div>
                       </apex:repeat>
                       <!--
                       <script>
                           
                           console.log('to see showIndividualLifePolicy :    '+showIndividualLifePolicy );
                           if({!if(cList.size>0 && cList[0].Is_Contain_Life_Policy__c && cList[0].Is_Contain_Individual_Policy__c, true, false)})    $('.individualLifePolicy').show();
                           else    $('.individualLifePolicy').hide();
                           
                           if((showHPA >= 1 && IfHPAPolicyLessThan2Yrs  ) || ( showHS >= 1 && IFHSPolicyLessThan3YrsOrBrokerPACPlanCode ))    $('.brokerPAC').show();
                           else{
                               $('.brokerPAC').hide();
                               //for case only one doc can download and it is HPA/HS doc - hide download part also
                               if( ( showHPA >= 1 ||  showHS >= 1 ) && {!if( noOfFormNeedToDownload <=1, true, false)})    hideQuestion('allow_download');         
                           }
                           
                       </script>
                       -->
                    </div>
                    <div class="bs form-field row content-choice-block" style="float:left; width:100%;">
                        <apex:form id="frmSendClaimForm-1" >
                            <div class="bs col-sm-12">
                                <div class="bs col-sm-3 col-xs-12" style="padding-left:0px; border-bottom: 0px; font-weight: bold;" >
                                    <apex:outputLabel value="{!$Label.Send_to_email_address}" escape="false" rendered="{!isCustomer}"></apex:outputLabel>
                                    <apex:outputLabel value="{!$Label.Send_to_email_address_broker}" escape="false" rendered="{!!isCustomer}"></apex:outputLabel>
                                </div>
                                <div class="bs form-field col-sm-7 col-xs-12 onclick-pointer fg-grey" style="padding-left:0px; border-bottom: 0p=x;" >
                                    <apex:inputText id="PH-Email-1" value="{!cList[0].Email_Address_to_send__c}" styleclass="form-field-style" rendered="{!if(cList.size>0, true, false)}"/>
                                </div>
                                <div class="bs col-sm-3 col-xs-12" style="padding-left:0px; border-bottom: 0px; " >
                                    <apex:outputLabel value="{!$Label.Please_edit_the_address_if_you_would_like}" escape="false" rendered="{!!isCustomer}"></apex:outputLabel>
                                </div>
                                
                                <div class="bs col-sm-2 col-xs-12" style="padding-left:0px;border-bottom: 0px;">
                                    <!--
                                    <apex:commandButton styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0 && cList[0].Is_Using_Chinese_Version__c, true, false)}" status="loader-icon" action="{!sendAttachmentEmail}"/>
                                    <apex:commandButton styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0 && !cList[0].Is_Using_Chinese_Version__c, true, false)}" status="loader-icon" action="{!sendAttachmentEmail}"/>
                                    -->
                                    <apex:actionFunction status="loader-icon" reRender="dummyPanel" name="sendAttachmentEmailAtAction1" action="{!sendAttachmentEmail}"  />
        
                                    <apex:commandButton status="loader-icon" styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" onclick="frmSendClaimFormValidation1()" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0, true, false)}" />
                                    
                                </div>
                            </div>
                        </apex:form>
                    </div>
                </div>
                
            </div>
        </apex:outputPanel>
        
        <!-- allow upload -->
        <!-- download part -->
        <apex:outputPanel rendered="{!needDownloadPDF}">
            
            <div id="allow_download" class="downloadForm content-choice-block" style="{!if( !isCustomer,'display: none;','')}">
                <div class="content-question" style="padding-top:20px;">
                   <apex:outputLabel value="{!$Label.Please_download_the_form_s_below_and_filled_by_your_doctor}" escape="false" rendered="{!isCustomer}" ></apex:outputLabel>
                   <apex:outputLabel value="{!$Label.The_customer_s_doctor_will_need_to_complete_the_following_form}" escape="false" rendered="{!!isCustomer}" ></apex:outputLabel>
                </div>
                <div class="col-xs-12 col-sm-12 cigna-fg-blue-medium onclick-pointer" style="text-align:right; border-bottom:1px solid #f2f2f2;" onclick="selectDownloadDoc2()" >
                    <div id="download_div2" style="display:inline" >{!$Label.Hide_Document}</div>
                    <i id="download_angle2" class="ci-hk-arrow-27 ci-hk-lg font-size-10 content-icon" aria-hidden="true"></i>
                </div>
                <div id="downloadDoc2" style="width: 100%; float: left;">
                    <div style="width:100%; padding-top:20px; padding-bottom:40px; ">
                       <apex:variable value="{!0}" var="idx_wItem2"/>
                       <apex:repeat value="{!wClaimTypeRelatedDocList}" var="wItem">
                           <!-- testing to add rules -->
                           <div class="{!wItem.rules}" >
                               <apex:outputPanel rendered="{!wItem.isPdf}" layout="inline" >
                                   <apex:variable value="{!0}" var="idx_doc2"/>
                                   <apex:repeat value="{!wItem.attList}" var="att_tmp">
                                       
                                       <div class="col-xs-2 col-sm-1"><a id="btn-click-allow-doc-{!idx_wItem2}-{!idx_doc2}" href="{!$Setup.Portal_Settings__c.File_Download_URL__c}{!att_tmp.id}" target="_blank" ><i class="fa fa-download content-icon" aria-hidden="true"></i></a></div>
                                       <div class="col-xs-10 col-sm-11" >{!if( uList.size>0 && uList[0].LanguageLocaleKey == 'en_US', wItem.docTypeName_eng, wItem.docTypeName_chi)}</div>
                                       <div class="col-xs-12 col-sm-12" style="padding:10px;"></div>
                                       <apex:variable var="idx_doc2" value="{!idx_doc2+1}"/>
                                       
                                   </apex:repeat>
                               </apex:outputPanel>
                               <apex:variable var="idx_wItem2" value="{!idx_wItem2+1}"/>
                           </div>
                       </apex:repeat>
                       
                    </div>
                    <div class="bs row content-choice-block">
                        <apex:form id="frmSendClaimForm-2" >
                            <div class="bs col-sm-12">
                                <div class="bs col-sm-3 col-xs-12" style="padding-left:0px; border-bottom: 0px; font-weight: bold;" >
                                    <apex:outputLabel value="{!$Label.Send_to_email_address}" escape="false" rendered="{!isCustomer}"></apex:outputLabel>
                                    <apex:outputLabel value="{!$Label.Send_to_email_address_broker}" escape="false" rendered="{!!isCustomer}"></apex:outputLabel>
                                </div>
                                <div class="bs form-field col-sm-7 col-xs-12 onclick-pointer fg-grey" style="padding-left:0px; border-bottom: 0px;" >
                                    <apex:inputText id="PH-Email-2" value="{!cList[0].Email_Address_to_send__c}" styleclass="form-field-style" rendered="{!if(cList.size>0, true, false)}"/>
                                </div>
                                <div class="bs col-sm-2 col-xs-12" style="padding-left:0px;border-bottom: 0px;">
                                    <apex:actionFunction status="loader-icon" reRender="dummyPanel" name="sendAttachmentEmailAtAction2" action="{!sendAttachmentEmail}"  />
                                    <apex:commandButton status="loader-icon" styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" onclick="frmSendClaimFormValidation2()" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0, true, false)}" />
                                    <!--
                                    <apex:commandButton status="loader-icon" styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" onclick="frmSendClaimFormValidation()" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0 && cList[0].Is_Using_Chinese_Version__c, true, false)}" action="{!sendAttachmentEmail}"/>
                                    <apex:commandButton status="loader-icon" styleClass="bs btn cigna-fg-white cigna-bg-orange-dark" onclick="frmSendClaimFormValidation()" value="{!$Label.Send}" reRender="dummyPanel" rendered="{!if(cList.size>0 && !cList[0].Is_Using_Chinese_Version__c, true, false)}" action="{!sendAttachmentEmail}"/>
                                    -->
                                </div>
                                <div class="bs col-sm-12 col-xs-12" style="padding-left:0px; padding-top:4px; padding-bottom:2px; border-bottom: 0px; font-weight:lighter;" >
                                    <apex:outputLabel value="{!$Label.Please_edit_the_address_if_you_would_like}" escape="false" style="font-weight:normal" rendered="{!!isCustomer}"></apex:outputLabel>
                                </div>
                            </div>
                        </apex:form>
                    </div>
                </div>
            </div>
        </apex:outputPanel>
        <script>
            
            function addRules1(){
                if($("form[id*='frmSendClaimForm-1']").length !=0){
                    
                    $("form[id*='frmSendClaimForm-1']").validate();
                    
                    jQuery.validator.addMethod("emailStrict", function(value, element) {
                        return this.optional(element) || Cigna.ValidationUtil.isValidEmail(value);
                    }, "{!$Label.Please_enter_valid_email_address}");
                    
                    $("form[id*='frmSendClaimForm-1'] input[id*='PH-Email']").each(function(idx, elem){
                        $(elem).rules("add", {
                            emailStrict: true
                        });
                    });
                
                    
                }
            
            }
            
            function addRules2(){
                
                if($("form[id*='frmSendClaimForm-2']").length !=0){
                    
                    $("form[id*='frmSendClaimForm-2']").validate();
                    
                    jQuery.validator.addMethod("emailStrict", function(value, element) {
                        return this.optional(element) || Cigna.ValidationUtil.isValidEmail(value);
                    }, "{!$Label.Please_enter_valid_email_address}");
                    
                    $("form[id*='frmSendClaimForm-2'] input[id*='PH-Email']").each(function(idx, elem){
                        $(elem).rules("add", {
                            emailStrict: true
                        });
                    });
                    
                }
            
            }
            
            function frmSendClaimFormValidation1(){
                if($("form[id*='frmSendClaimForm-1']").length !=0){
                    
                    $("form[id*='frmSendClaimForm-1']").validate();
                    
                    jQuery.validator.addMethod("emailStrict", function(value, element) {
                        return this.optional(element) || Cigna.ValidationUtil.isValidEmail(value);
                    }, "{!$Label.Please_enter_valid_email_address}");
                    
                    $("form[id*='frmSendClaimForm-1'] input[id*='PH-Email']").each(function(idx, elem){
                        $(elem).rules("add", {
                            emailStrict: true
                        });
                    });
                
                    var validation1 = $("form[id*='frmSendClaimForm-1']").validate().form();
                    if(!validation1){
                        return false;
                    }else{
                        sendAttachmentEmailAtAction1();
                        return true;
                    }
                }else{
                    return true;
                }
            }
            
            function frmSendClaimFormValidation2(){
                
                if($("form[id*='frmSendClaimForm-2']").length !=0){
                
                    $("form[id*='frmSendClaimForm-2']").validate();
                    
                    jQuery.validator.addMethod("emailStrict", function(value, element) {
                        return this.optional(element) || Cigna.ValidationUtil.isValidEmail(value);
                    }, "{!$Label.Please_enter_valid_email_address}");
                    
                    $("form[id*='frmSendClaimForm-2'] input[id*='PH-Email']").each(function(idx, elem){
                        $(elem).rules("add", {
                            emailStrict: true
                        });
                    });
                    
                    var validation2 = $("form[id*='frmSendClaimForm-2']").validate().form();
                    if(!validation2){
                        return false;
                    }else{
                        sendAttachmentEmailAtAction2();
                        return true;
                    }
                }else{
                    return true;
                }
            }
            //frmSendClaimFormValidation1();
            //frmSendClaimFormValidation2();
            addRules1();
            addRules1();
        </script>
        
        <!-- Rancho_Covid19_20221019 - display text if selected policy has covid-19 benefit -->
        <apex:outputPanel id="covid-19-reminder">
            <div style="padding-bottom:30px;">
                <apex:outputText value="{!transField['Covid_19_Benefit_Remind_1'][$Label.Header_Language_Code_Current]}{!transField['Covid_19_Benefit_Remind_2'][$Label.Header_Language_Code_Current]}{!transField['Covid_19_Benefit_Remind_3'][$Label.Header_Language_Code_Current]}{!transField['Covid_19_Benefit_Remind_4'][$Label.Header_Language_Code_Current]}" escape="false" rendered="{!isCovid19}"/>
            </div>
        </apex:outputPanel>
        
        
        <!-- end allow upload -->  
        
        <!-- ask question -->
        <!-- 
        *****   Moved to previous step -- Zoe    *****
        <apex:outputPanel id="claimTypeDocUploadEmail" >
            <div id="displayDocQuestion" class="bs form-field row content-choice-block" style="width:100%; float: left; {!if( isCustomer,'display: none;','')}">
               <div class="bs col-sm-12">
                   {!$Label.Do_you_have_all_the_documents_to_upload_now}
               </div>
               <div class="bs col-sm-12">
                   <div class="bs col-sm-4 content-choice fg-grey" style="padding-left:40px;border-bottom: 0px;" onclick="allowUploadSection(true);" >
                       <i class="fa fa-check-circle-o content-icon " aria-hidden="true"></i>{!$Label.Yes}
                   </div>
                   <div class="bs col-sm-4 content-choice fg-grey" style="padding-left:40px;border-bottom: 0px;" onclick="allowUploadSection(false);" >
                       <i class="fa fa-times-circle-o content-icon " aria-hidden="true"></i>{!$Label.No}
                   </div>
               </div>
            </div>
        </apex:outputPanel>
        -->
        
        <script>
            //CR-56_Link_20220214
            $('[data-toggle="tooltip"]').tooltip();
            
            
        </script>
        <apex:form >
            <apex:actionFunction status="loader-icon" action="{!DummyAction}"  name="refreshSecondTime" reRender="uploadDocResult" />
            <!--apex:actionFunction status="loader-icon" name="refreshAttlist" action="{!FindUploadAttachment}"  reRender="uploadDocResult" oncomplete="console.log('refreshSecondTime complete');refreshSecondTime();" ></apex:actionFunction-->
            <!-- Add by Manuel to setup the animation -->
            <apex:actionFunction name="refreshAttlist" action="{!FindUploadAttachment}" status="loader-icon" reRender="uploadDocResult,errFileSizeZero" oncomplete="console.log('refreshAttlist complete');checkFilesAmtNum(fileNum);"></apex:actionFunction><!-- PI20 jack add -->
            
            <apex:actionFunction status="loader-icon" name="refreshSecondTimeWithoutDummy" reRender="uploadDocResult" />
            <apex:actionFunction status="loader-icon" name="refreshAttlistWithoutDummy" action="{!FindUploadAttachment}"  reRender="uploadDocResult" oncomplete="console.log('refreshSecondTimeWithoutDummy complete');refreshSecondTimeWithoutDummy();" ></apex:actionFunction>
            
            <apex:actionFunction status="loader-icon" name="removeAttachment" action="{!RemoveUploadAttachment}" rerender="uploadDocResult" oncomplete="console.log('removeAttachment complete');refreshSecondTime();" >
                <apex:param name="id" value="" assignTo="{!removeAttId}" />
            </apex:actionFunction>
            
        </apex:form>
        
    </div>
    
    <!-- next button -->
    <!-- mobile -->
    <div id="mobile-app-padding" class="bs row nextStepBtnPaddingIn6" style="display: none; padding-bottom: 100px;">
        <div class="bs col-xs-12"></div>
    </div>
    
    <div id="action-bar" class="bs action-bar hidden-sm hidden-md hidden-lg cigna-floating-bottom-panel {!If(isCustomer, 'nextStepBtnIn8', 'nextStepBtnIn6')} " style="left:0px; display:none;" onclick="nextStep();">
        <div id="callAction1" class="bs cigna-action-btn-group cigna-fg-white cigna-bg-orange-dark">
            <a class="action-btn cigna-fg-white" role="button"><span class="ci-hk-arrow-31" aria-hidden="true"></span><br/>{!$Label.Next}</a>
        </div>
    </div>
    
    <!-- web -->
    <div class="bs row hidden-xs {!If(isCustomer, 'nextStepBtnIn8', 'nextStepBtnIn6')}" style="padding-top: 20px; padding-bottom: 20px; display:none;">
        <div class="bs col-sm-3 col-md-3 col-xs-3 col-lg-3 "></div>
        <div id="callAction2" class="bs col-sm-6 col-md-6 col-xs-6 col-lg-6 onclick-pointer mobile-version-button cigna-fg-white cigna-bg-orange-dark desktop-action-btn" onclick="nextStep();">
            {!$Label.Next}
        </div>
        <div class="bs col-sm-3 col-md-3 col-xs-3 col-lg-3"></div>
    </div>
   
</apex:page>