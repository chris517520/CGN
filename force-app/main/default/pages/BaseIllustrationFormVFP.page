<apex:page docType="html-5.0" sidebar="false" showHeader="false" title="Illustration Form" controller="eSaleIllustrationFormCtrl">
    <head>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"/>
        <style type="text/css">
            .loading-div {
                top:0px;
                left:0px;
            }

            /*   @media (min-width: 768px) {
                   .header-bar {
                       background-image: url({!URLFOR($Resource.KV_Get_Quote)});
                    background-size: cover;
                    background-position-y: 37%;
                }
            }
            @media (max-width: 767px) {
                .header-bar {
                    background-image: url({!URLFOR($Resource.KV_Get_Quote_Mobile)});
                    background-size: cover;
                    background-position-y: 48%;
                }
            }*/
            .bs .cigna-btn-desktop {
                width: 30%;
                text-transform: uppercase;
                /* Rancho_HKITSFDC264_20250903 - replace "Gotham SSm A", "Gotham SSm B" */
                font-family: "ValueSansRegular", "Microsoft Jhenghei", "LiHei Pro", "Heiti TC", Arial, Helvetica, sans-serif;
                font-style: normal;
                font-weight: 500;
            }
            .content-choice{
                font-size:14px !important;
                padding-top:20px !important;
                padding-bottom:20px !important;
                border-bottom:1px solid #f2f2f2 !important;
            }

            <!--additional inline css-->
            <!--tooltips-->
                .tooltip {
                    position: relative;
                    display: inline-block;
                }
            .tooltip .tooltiptext {
                visibility: hidden;
                width: 120px;
                background-color: black;
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 5px 0;
            }
            .tooltip:hover .tooltiptext {
                visibility: visible;
            }
            .tooltip-inner {
                /* Change the tooltip width here */
                max-width: 250px !important;
                /* If max-width does not work, try using width instead */
                width: 250px;
                min-width: 100px;
            }
            .form-field-style-align{
                border:0px;
                border-bottom:1px solid #58595B;
                width: 100%;
                box-shadow: none !important;
                border-radius: 0px;
                color: #58595B;
                height: 34px;
                outline: none;
                -webkit-box-shadow: none;
                -moz-box-shadow: none;
                box-shadow: none;
                padding: 6px 0px;
                line-height: 1.42857143 !important;
                background: transparent;
            }

        </style>

        <script type="text/javascript">
            var __sfdcSessionId = '{!GETSESSIONID()}';
            var filesToUpload = '';
            var uploadedFile = 0;
        </script>
        <script src="/soap/ajax/32.0/connection.js" type="text/javascript"></script>

        <script type="text/javascript">

            var Cigna = Cigna || {};
            Cigna.PaperApp = function(){

                function showLoadingIcon(id){
                    $('#' + id).show();
                }

                function hideLoadingIcon(id){
                    $('#' + id).hide();
                }

                function uploadFile(parentId, attType){

                    showLoadingIcon('snd-loading-phurl');

                    $('#errNoFile').hide();

                    //Add by Manuel on 20180927 to support multiple files select and upload function
                    var arrFiles = new Array();

                    $("#"+attType).each(function(){
                        //filesToUpload=$(this)[0].files[0]; // Comment by Manuel on 20180927 that legacy single file select upload every time
                        for(var j=0; j<$(this)[0].files.length; j++){
                            arrFiles[j] = $(this)[0].files[j];
                        }
                    });
                    for(var k=0; k<arrFiles.length; k++){
                        filesToUpload = arrFiles[k];
                        //CR-56_Link_20220214
                        if($('[att-type="User_PaperAPP"]').length>=10){ 
                            $('#errOnlyAllowOneFile').show();
                            hideLoadingIcon('snd-loading-phurl');
                            return;
                        }else{
                            $('#errOnlyAllowOneFile').hide();
                        }

                        var reader = new FileReader();

                        // Keep a reference to the File in the FileReader so it can be accessed in callbacks
                        reader.file = filesToUpload;

                        if(typeof(filesToUpload)  === "undefined"){
                            alert('please select file.');

                        }else{
                            reader.onload = function(e)
                            {
                                var maxFileSize = 26214400;//7340032;
                                var passFileSize;
                                var passFileType;

                                if(this.file.size>maxFileSize){
                                    $("#errFileSize").show();
                                    passFileType = false;
                                }else{
                                    passFileSize = 'true';
                                    $("#errFileSize").hide();
                                }

                                if(this.file.type!='application/pdf' && this.file.type!='image/png' && this.file.type!='image/jpeg' && this.file.type!='image/tiff' && this.file.type!='image/gif' ){
                                    $("#errFileType").show();
                                    hideLoadingIcon('snd-loading-phurl');
                                }else{
                                    passFileType  = 'true';
                                    $("#errFileType").hide();
                                }

                                if(passFileType=='true' && passFileSize=='true' && parentId && parentId!=undefined){

                                    var att = new sforce.SObject("Attachment");
                                    var num = Math.random()*9999;
                                    num = parseInt(num, 10);

                                    $('input[type="hidden"][id$="randomNum"]').val(num);
                                    console.log('randomNum ' + num);

                                    var binary = "";
                                    var bytes = new Uint8Array(e.target.result);
                                    var length = bytes.byteLength;

                                    for (var i = 0; i < length; i++)
                                    {
                                        binary += String.fromCharCode(bytes[i]);
                                    }

                                    var attachment_object = {
                                        parentId: parentId,
                                        Body: window.btoa(binary),
                                        Name: attType+'_'+this.file.name,
                                        ContentType: this.file.type
                                    };

                                    $.ajax({
                                        url: '{!$Site.BaseUrl}/services/data/v38.0/sobjects/Attachment',
                                        data: JSON.stringify(attachment_object),
                                        type: 'POST',
                                        processData: false,
                                        contentType: false,
                                        headers: {'Authorization': 'Bearer '+__sfdcSessionId, 'Content-Type': 'application/json'},
                                        xhr: function(){
                                            var xhr = new window.XMLHttpRequest();
                                            //Upload progress
                                            xhr.upload.addEventListener("progress", function(evt){
                                                if (evt.lengthComputable) {
                                                    var percentComplete = evt.loaded / evt.total;
                                                    //Do something with upload progress
                                                    console.log("Percentage:"+percentComplete);
                                                }
                                            }, false);
                                            return xhr;
                                        },
                                        success: function(response) {
                                            hideLoadingIcon('snd-loading-phurl');
                                            refreshAttlist();
                                            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
                                        },

                                        error: function(xhr, status, error) {
                                            var errorMessage = xhr.status + ': ' + xhr.statusText;
                                            console.log('ERROR:'+ errorMessage);
                                            hideLoadingIcon('snd-loading-phurl');
                                        }
                                    });
                                }else{
                                    hideLoadingIcon('snd-loading-phurl');
                                }
                            };

                            if(filesToUpload!='' || filesToUpload!='1'){
                                reader.readAsArrayBuffer(filesToUpload);
                                $("#errNoFile").hide();
                            }else{
                                //finishSubmission();
                                $("#errNoFile").show();
                            }
                        }
                    }
                }

                function submitDoc(){
                    console.log('validation for upload doc');
                    //CR-56_Link_20220214
                    if($('[att-type="User_PaperAPP"]').length<1){
                        $('#errUpdateAllFile').show();
                        return;
                    }
                    //CR-56_Link_20220214
                    if($('[att-type="User_PaperAPP"]').length>10){
                        $('#errOnlyAllowOneFile').show();
                        return;
                    }
                    showLoadingIcon('snd-loading-phurl');
                    submit();

                }

                function goHome() {
                    var sitePrefix = "{!$Site.Prefix}";
                    var url = "";

                    if (sitePrefix == "/broker") {
                        url = sitePrefix + "/apex/BrkBrokerLandingVFP";
                    } else if (sitePrefix == "/customer") {
                        url = sitePrefix + "/apex/CustomerLandingPage";
                    } else {
                        var currentUrl = window.location.href.substring(window.location.href.lastIndexOf('/'));
                        if (currentUrl.toLowerCase().indexOf('/cus') == 0) {
                            url = "/apex/CustomerLandingPage";
                        } else if (currentUrl.toLowerCase().indexOf('/brk') == 0) {
                            url = "/apex/BrkBrokerLandingVFP";
                        } else {
                            url = "/apex/CustomerLandingPage";
                        }
                    }

                    if (Cigna.Util.isSalesforce1()) {
                        sforce.one.navigateToURL(url, true);
                    } else {
                        window.location.href = url;
                    }
                }

                function goBack(){
                    var fromPage = $('input[type="hidden"][id$="fromPage"]').val();
                    if(fromPage == 'Quote'){
                        Cigna.Util.navigateToVFP("GetQuoteVFP?tid={!JSINHTMLENCODE(paratid)}", null, null, true);
                    }else{
                        Cigna.Util.navigateToVFP("GetProtectedVFP?pc={!JSINHTMLENCODE(paraProductCode)}", null, null, true);
                    }

                }

                return {
                    showLoadingIcon : showLoadingIcon,
                    hideLoadingIcon : hideLoadingIcon,
                    uploadFile : uploadFile,
                    submitDoc : submitDoc,
                    goHome : goHome,
                    goBack : goBack
                }
            }();

            function isSmoker(smoker) {
                console.log('smoker---'+smoker);
                $('#location-param input[id$="isSmoker"]').val(smoker);
            }
            function isSex(Sex) {
                console.log('Sex---'+Sex);
                $('#location-param input[id$="isSex"]').val(Sex);
            }
            function gotoIllustrationFormPDF(){
                var age=Number($('[id$=Age]').val());
                var payTerm=Number($('[id$=selectedPayTerm]').val());
                console.log('Name---'+(age+payTerm));
                if($('[id$=Name]').val()==''||$('[id$=Age]').val()==''||$('[id$=isSex]').val()==''||$('[id$=isSmoker]').val()==''||$('[id$=selectedPayTerm]').val()==''||$('[id$=selectedPayMode]').val()==''||$('[id$=sumInsured]').val()==''){
                    $('#informationMsg').show();
                }else if($('[id$=Age]').val()!=''&&$('[id$=selectedPayTerm]').val()!=''&&(age+payTerm>65)){
                    $('#ageMsg').show();
                }else if($('[id$=Age]').val()!=''&&$('[id$=isSmoker]').val()=='true'&&(age<18)){
                    $('#informationMsg2').show();
                }else{
                    var sitePrefix = "{!$Site.Prefix}";
                    var url = sitePrefix + "/apex/Brk" + "IllustrationFormPDFVFP?plan=" + $('#current-product-code').val()+"&name="+$('[id$=Name]').val()+"&age="+$('[id$=Age]').val()+"&sex="+$('[id$=isSex]').val()+"&smoker="+$('[id$=isSmoker]').val()+"&payTerm="+$('[id$=selectedPayTerm]').val()+"&sumInsured="+$('[id$=sumInsured]').val()+"&payMode="+$('[id$=selectedPayMode]').val();
                    window.open(url);
                }
            }
            function hideMsg(){
                $('#informationMsg').hide();
                $('#informationMsg2').hide();
                $('#ageMsg').hide();
            }
            $(document).ready(function(){
                hideMsg();
                $('#location-param input[id$="isSmoker"]').val('');
                //CR-56_Link_20220214
                $('[data-toggle="tooltip"]').tooltip();
            });
        </script>

    </head>

    <apex:define name="additionalLibraries">
        <!--additional css, bootstrap, jquery,js libraries-->
        <apex:stylesheet value="{!URLFOR($Resource.Cigna_HK_Icons, 'Cigna-HK-Icons.css')}"/>
    </apex:define>

    <apex:form id="papaerapplication">
        <div id="location-param" style="display: none;">
            <apex:inputHidden value="{!Sex}" id="isSex" />
            <apex:inputHidden value="{!Smoker}" id="isSmoker" />
        </div>
        <input id="current-product-code" type="hidden" value="{!paraProductCode}" />
        <apex:actionFunction name="refreshAttlist" rerender="uploadatt" status="loader-icon"/>
        <apex:outputPanel id="errorMessage">
            <div class="bs row">
                <apex:pagemessages ></apex:pagemessages>
            </div>
        </apex:outputPanel>

        <apex:outputPanel >
            <div id="product-back">
                <div class="bs col-xs-12">
                    <p><a id="product-back-btn" href="#" class="bs cigna-fg-orange-medium" onclick="Cigna.PaperApp.goBack();"><i class="ci-hk-arrow-29" aria-hidden="true"></i> {!$Label.Back}</a></p>
                </div>
            </div>
            <div id="papaer-app" class="bs row cigna-content-area cigna-fg-gray-dark" style="padding-bottom: 50px;">
                <div class="snd-loading-div">
                    <span id="snd-loading-phurl" style="display: none;">
                        <div class="bs col-xs-12 col-lg-12 loading-div">
                            <span class="loading-helper"></span>
                            <i class="spinner-icon fa fa-spinner fa-pulse fa-3x fa-fw"></i>
                            <span class="sr-only">Loading...</span>
                        </div>
                    </span>
                </div>

                <div class="bs col-xs-12">
                    <div class="bs col-xs-12"><h3 class="bs cigna-fg-green-medium" style="text-transform: uppercase;">{!selectedProduct.name__c}</h3></div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 30px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Name_of_Life_Insured'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Name_of_Life_Insured~')}"/>
                    </div>
                    <div class="col-xs-3">
                        <apex:inputText id="Name" value="{!Name}" styleClass="bs form-field-style-align" />
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Age'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Age~')}"/>
                    </div>
                    <div class="col-xs-3">
                        <apex:inputText id="Age" value="{!Age}" styleClass="bs form-field-style-align" />
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Sex'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Sex~')}"/>
                    </div>
                    <div id="param-choose-different-plan-rider" class="bs cigna-answer-wrapper col-xs-4">
                        <p class="bs col-xs-4">
                            <input type="radio" id="male_div" value="Male" name="questionSex" onclick="isSex(value)" class="bs cigna-question-radio plan-info-input-label-checker" />
                            <label for="male_div">{!$Label.Esales_Male}</label>
                        </p>
                        <p class="bs col-xs-4">
                            <input type="radio" id="female_div" value="Female" name="questionSex" onclick="isSex(value)" class="bs cigna-question-radio plan-info-input-label-checker" />
                            <label for="female_div">{!$Label.Esales_Female}</label>
                        </p>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Smoker'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Smoker~')}"/>
                    </div>
                    <div id="param-choose-different-plan-rider" class="bs cigna-answer-wrapper col-xs-4">
                        <p class="bs col-xs-4">
                            <input type="radio" id="yes_div" value="true" name="questionNonsmoker" onclick="isSmoker(value)" class="bs cigna-question-radio plan-info-input-label-checker" />
                            <label for="yes_div">{!$Label.Yes}</label>
                        </p>
                        <p class="bs col-xs-4">
                            <input type="radio" id="no_div" value="false" name="questionNonsmoker" onclick="isSmoker(value)" class="bs cigna-question-radio plan-info-input-label-checker" />
                            <label for="no_div">{!$Label.No}</label>
                        </p>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Premium_Pay_Term'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Premium_Pay_Term~')}"/>
                    </div>
                    <div class="col-xs-3">
                        <apex:selectList style="height:34px;" value="{!pay_term}" size="1" styleClass="bs form-field-style-select" id="selectedPayTerm">
                            <apex:selectOptions value="{!pay_termValue}" />
                        </apex:selectList>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Sum_Insured'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Sum_Insured~')}"/>
                    </div>
                    <div class="col-xs-3">
                        <!--<apex:inputText id="sumInsured" value="{!sum_insured}" styleClass="bs form-field-style-align" />-->
                        <apex:selectList value="{!sum_insured}" id="sumInsured" size="1" multiselect="false" styleClass="bs form-field-style-select">
                            <apex:selectOptions value="{!insuredList}"></apex:selectOptions>
                        </apex:selectList>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px">
                    <div class="col-xs-3" style="font-weight: bold;">
                        <apex:outputText value="{!transField['Illu_Payment_Mode'][$Label.Header_Language_Code_Current]}:" rendered="{!contains(transKey, '~Illu_Payment_Mode~')}"/>
                    </div>
                    <div class="col-xs-3">
                        <apex:selectList style="height:34px;" value="{!pay_mode}" size="1" styleClass="bs form-field-style-select" id="selectedPayMode">
                            <apex:selectOptions value="{!pay_modeValue}" />        
                        </apex:selectList>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px" id="informationMsg">
                    <div class="col-xs-12" style="font-weight: bold;color:red;">
                        <apex:outputText value="{!transField['Illu_Information_Msg'][$Label.Header_Language_Code_Current]}" rendered="{!contains(transKey, '~Illu_Information_Msg~')}"/>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px" id="informationMsg2">
                    <div class="col-xs-12" style="font-weight: bold;color:red;">
                        <apex:outputText value="{!transField['Illu_Information_Msg2'][$Label.Header_Language_Code_Current]}" rendered="{!contains(transKey, '~Illu_Information_Msg2~')}"/>
                    </div>
                </div>
                <div class="bs form-group col-xs-12" style="padding-top: 10px" id="ageMsg">
                    <div class="col-xs-12" style="font-weight: bold;color:red;">
                        <apex:outputText value="{!transField['Illu_Age_Msg'][$Label.Header_Language_Code_Current]}" rendered="{!contains(transKey, '~Illu_Age_Msg~')}"/>
                    </div>
                </div>

                <div id="downloadDocPanel" class= "bs col-xs-12 form-horizontal">
                    <br/>
                    <div class="bs col-xs-12 form-field" style="font-weight: 500;">
                        <a href="#" onclick="hideMsg();gotoIllustrationFormPDF();">
                            <span class="ci-hk-inbox content-icon" aria-hidden="true"></span>
                            <span style="color:#666666;">{!$Label.Download_Illustration_Form}</span>
                        </a>
                    </div>
                </div>
                <div class="bs col-sm-12 col-xs-12">
                    <!--mobile action button-->
                    <div id="mobile-app-padding" class="bs row" style="display: none; padding-bottom: 100px;">
                        <div class="bs col-xs-12"></div>
                    </div>
                </div>
            </div>
            <div id="mobile-app-padding" class="bs row" style="display: none; padding-bottom: 100px;">
                <div class="bs col-xs-12"></div>
            </div>
        </apex:outputPanel>        
        <script>
            if (Cigna.Util.isSalesforce1()) {
                $('#mobile-app-padding').css('display', 'block');
                $("a").attr("target","");
            }
        </script>
    </apex:form>
</apex:page>